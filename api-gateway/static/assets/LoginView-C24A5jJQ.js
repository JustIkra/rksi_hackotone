import{l as I,m as k,n as K,p as U,c as u,f as s,w as l,r as a,d as O,q as W,o as n,a as r,v as H,x as F,u as _,e as v,y as J,z as E,A as P,F as z,B as A,C as Q,E as X,D as Y,G as Z}from"./index-CLa57XdF.js";import{u as $}from"./useFieldErrorAnimation-DJ49irzx.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"login-container"},te={class:"auth-form-error__content"},oe={key:1,class:"auth-form-error__list"},se={class:"register-link"},le={__name:"LoginView",setup(ae){const C=O(),V=W(),w=I(),h=k(null),o=K({email:"",password:""}),b=["email","password"],{getFormItemClass:x,handleValidationErrors:B,handleFieldValidate:L,triggerForFields:q,markExternalErrors:S}=$(b),t=k([]),c=k(!1),D=()=>{c.value=!1,Z(()=>{c.value=!0,setTimeout(()=>{c.value=!1},360)})},G={email:[{required:!0,message:"Введите email",trigger:"blur"},{type:"email",message:"Некорректный email",trigger:"blur"}],password:[{required:!0,message:"Введите пароль",trigger:"blur"},{min:8,message:"Пароль должен быть не менее 8 символов",trigger:"blur"}]},M=(f,e)=>{L(f,e),e&&t.value.length&&(t.value=[])},y=async()=>{h.value&&(t.value=[],await h.value.validate(async(f,e)=>{if(!f){B(e);return}try{await w.login(o.email,o.password),X.success("Вход выполнен успешно");const i=V.query.redirect||"/participants";C.push(i)}catch(i){const m=i.normalizedError||Y(i,w.error||"Ошибка входа");t.value=m.messages;const d=Object.keys(m.fieldErrors),g=d.length?d:b;S(g),q(g),D()}}))};return U(()=>[o.email,o.password],()=>{t.value.length&&(t.value=[])}),(f,e)=>{const i=a("el-alert"),m=a("el-input"),d=a("el-form-item"),g=a("el-button"),N=a("router-link"),R=a("el-form"),T=a("el-card");return n(),u("div",re,[s(T,{class:"login-card",shadow:"never"},{default:l(()=>[e[7]||(e[7]=r("div",{class:"card-header"},[r("div",{class:"logo-icon"},[r("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[r("defs",null,[r("linearGradient",{id:"logoGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%"},[r("stop",{offset:"0%",style:{"stop-color":"#4F6AF0"}}),r("stop",{offset:"100%",style:{"stop-color":"#3D56D4"}})])]),r("rect",{width:"48",height:"48",rx:"12",fill:"url(#logoGradient)"}),r("path",{d:"M14 24L21 31L34 18",stroke:"white","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"})])]),r("h2",null,"Вход в систему"),r("p",null,"Цифровая модель универсальных компетенций")],-1)),_(V).query.message==="pending"?(n(),H(i,{key:0,title:"Ожидание одобрения",type:"warning",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},{default:l(()=>[...e[2]||(e[2]=[v(" Ваш аккаунт ожидает одобрения администратором. ",-1)])]),_:1})):F("",!0),s(R,{ref_key:"formRef",ref:h,model:o,rules:G,"label-position":"top",onSubmit:J(y,["prevent"]),onValidate:M},{default:l(()=>[s(d,{label:"Email",prop:"email",class:E(_(x)("email"))},{default:l(()=>[s(m,{modelValue:o.email,"onUpdate:modelValue":e[0]||(e[0]=p=>o.email=p),type:"email",placeholder:"Введите email",size:"large",autocomplete:"email"},null,8,["modelValue"])]),_:1},8,["class"]),s(d,{label:"Пароль",prop:"password",class:E(_(x)("password"))},{default:l(()=>[s(m,{modelValue:o.password,"onUpdate:modelValue":e[1]||(e[1]=p=>o.password=p),type:"password",placeholder:"Введите пароль",size:"large","show-password":"",autocomplete:"current-password",onKeyup:P(y,["enter"])},null,8,["modelValue"])]),_:1},8,["class"]),s(d,null,{default:l(()=>[s(g,{type:"primary",size:"large",style:{width:"100%"},loading:_(w).loading,onClick:y},{default:l(()=>[...e[3]||(e[3]=[v(" Войти ",-1)])]),_:1},8,["loading"])]),_:1}),t.value.length?(n(),u("div",{key:0,class:E(["auth-form-error",{"auth-field-animate":c.value}]),role:"alert"},[e[4]||(e[4]=r("span",{class:"auth-form-error__icon","aria-hidden":"true"}," ! ",-1)),r("div",te,[t.value.length===1?(n(),u(z,{key:0},[v(A(t.value[0]),1)],64)):(n(),u("ul",oe,[(n(!0),u(z,null,Q(t.value,(p,j)=>(n(),u("li",{key:j},A(p),1))),128))]))])],2)):F("",!0),r("div",se,[e[6]||(e[6]=r("span",null,"Нет аккаунта?",-1)),s(N,{to:"/register"},{default:l(()=>[...e[5]||(e[5]=[v(" Зарегистрироваться ",-1)])]),_:1})])]),_:1},8,["model"])]),_:1})])}}},ue=ee(le,[["__scopeId","data-v-5b400d1f"]]);export{ue as default};
