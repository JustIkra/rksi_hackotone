import{l as U,m as k,n as j,p as G,c as d,d as t,w as s,r as o,e as O,q as W,o as l,v as H,x as F,u as _,f as v,y as J,a as n,z as b,A as P,F as z,B as C,C as Q,E as X,D as Y,G as Z}from"./index-pq0ppcP1.js";import{u as $}from"./useFieldErrorAnimation-WuCrXC2X.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"login-container"},ae={class:"auth-form-error__content"},te={key:1,class:"auth-form-error__list"},se={class:"register-link"},oe={__name:"LoginView",setup(le){const A=O(),E=W(),w=U(),y=k(null),a=j({email:"",password:""}),V=["email","password"],{getFormItemClass:x,handleValidationErrors:q,handleFieldValidate:B,triggerForFields:S,markExternalErrors:L}=$(V),r=k([]),c=k(!1),N=()=>{c.value=!1,Z(()=>{c.value=!0,setTimeout(()=>{c.value=!1},360)})},R={email:[{required:!0,message:"Введите email",trigger:"blur"},{type:"email",message:"Некорректный email",trigger:"blur"}],password:[{required:!0,message:"Введите пароль",trigger:"blur"},{min:8,message:"Пароль должен быть не менее 8 символов",trigger:"blur"}]},T=(f,e)=>{B(f,e),e&&r.value.length&&(r.value=[])},h=async()=>{y.value&&(r.value=[],await y.value.validate(async(f,e)=>{if(!f){q(e);return}try{await w.login(a.email,a.password),X.success("Вход выполнен успешно");const i=E.query.redirect||"/participants";A.push(i)}catch(i){const m=i.normalizedError||Y(i,w.error||"Ошибка входа");r.value=m.messages;const u=Object.keys(m.fieldErrors),g=u.length?u:V;L(g),S(g),N()}}))};return G(()=>[a.email,a.password],()=>{r.value.length&&(r.value=[])}),(f,e)=>{const i=o("el-alert"),m=o("el-input"),u=o("el-form-item"),g=o("el-button"),M=o("router-link"),D=o("el-form"),I=o("el-card");return l(),d("div",re,[t(I,{class:"login-card"},{header:s(()=>[...e[2]||(e[2]=[n("div",{class:"card-header"},[n("h2",null,"Вход в систему"),n("p",null,"Цифровая модель универсальных компетенций")],-1)])]),default:s(()=>[_(E).query.message==="pending"?(l(),H(i,{key:0,title:"Ожидание одобрения",type:"warning",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},{default:s(()=>[...e[3]||(e[3]=[v(" Ваш аккаунт ожидает одобрения администратором. ",-1)])]),_:1})):F("",!0),t(D,{ref_key:"formRef",ref:y,model:a,rules:R,"label-position":"top",onSubmit:J(h,["prevent"]),onValidate:T},{default:s(()=>[t(u,{label:"Email",prop:"email",class:b(_(x)("email"))},{default:s(()=>[t(m,{modelValue:a.email,"onUpdate:modelValue":e[0]||(e[0]=p=>a.email=p),type:"email",placeholder:"Введите email",size:"large",autocomplete:"email"},null,8,["modelValue"])]),_:1},8,["class"]),t(u,{label:"Пароль",prop:"password",class:b(_(x)("password"))},{default:s(()=>[t(m,{modelValue:a.password,"onUpdate:modelValue":e[1]||(e[1]=p=>a.password=p),type:"password",placeholder:"Введите пароль",size:"large","show-password":"",autocomplete:"current-password",onKeyup:P(h,["enter"])},null,8,["modelValue"])]),_:1},8,["class"]),t(u,null,{default:s(()=>[t(g,{type:"primary",size:"large",style:{width:"100%"},loading:_(w).loading,onClick:h},{default:s(()=>[...e[4]||(e[4]=[v(" Войти ",-1)])]),_:1},8,["loading"])]),_:1}),r.value.length?(l(),d("div",{key:0,class:b(["auth-form-error",{"auth-field-animate":c.value}]),role:"alert"},[e[5]||(e[5]=n("span",{class:"auth-form-error__icon","aria-hidden":"true"}," ! ",-1)),n("div",ae,[r.value.length===1?(l(),d(z,{key:0},[v(C(r.value[0]),1)],64)):(l(),d("ul",te,[(l(!0),d(z,null,Q(r.value,(p,K)=>(l(),d("li",{key:K},C(p),1))),128))]))])],2)):F("",!0),n("div",se,[e[7]||(e[7]=n("span",null,"Нет аккаунта?",-1)),t(M,{to:"/register"},{default:s(()=>[...e[6]||(e[6]=[v(" Зарегистрироваться ",-1)])]),_:1})])]),_:1},8,["model"])]),_:1})])}}},de=ee(oe,[["__scopeId","data-v-5ebb8149"]]);export{de as default};
