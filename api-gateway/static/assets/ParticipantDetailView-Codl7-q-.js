import{O as Q,P as ct,m as b,Q as J,D as dt,p as ne,r as c,c as N,o,d as t,x as L,R as pt,w as e,u as m,S as ft,K as mt,z as Xe,B as C,F as ee,H as Fe,T as qe,v as _,f as v,a as d,C as ae,U as he,V as Ge,E as U,q as je,e as Je,I as Te,J as fe,W as _t,k as Re,X as Me,g as Ve,Y as vt,Z as Pe,_ as Le,h as Oe,$ as Ae,a0 as Ie,N as yt,L as gt,n as wt,a1 as ht,t as bt,a2 as Ue,G as kt}from"./index-DqrAiWow.js";import{A as Ct}from"./AppLayout-BQ_tQ49P.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{m as ge,f as $t,g as St}from"./metricNames-CJ-IklKi.js";import{f as Et,a as me,p as xt}from"./dateFormat-DIzvNI61.js";import{a as We,p as He,u as Dt}from"./useResponsive-DnJTGPJk.js";const ye={async upload(a,k){const r=new FormData;return r.append("file",k),(await Q.post(`/participants/${a}/reports`,r,{headers:{"Content-Type":"multipart/form-data"}})).data},async download(a){return await Q.get(`/reports/${a}/download`,{responseType:"blob"})},async getById(a){return(await Q.get(`/reports/${a}`)).data},async delete(a){return(await Q.delete(`/reports/${a}`)).data},async extract(a){return(await Q.post(`/reports/${a}/extract`)).data},async getMetrics(a){return(await Q.get(`/reports/${a}/metrics`)).data},async getList(a){return(await Q.get(`/participants/${a}/reports`)).data}},xe={async calculate(a,k){return(await Q.post(`/scoring/participants/${a}/calculate`,null,{params:{activity_code:k}})).data},async getHistory(a,k=10){return(await Q.get(`/scoring/participants/${a}/scores`,{params:{limit:k}})).data},async getById(a){return(await Q.get(`/scoring-results/${a}`)).data},async generateRecommendations(a){return(await Q.post(`/reports/${a}/recommendations`)).data},async getFinalReport(a,k,r="json"){const w={params:{activity_code:k,format:r}};r==="html"&&(w.responseType="text");const T=await Q.get(`/participants/${a}/final-report`,w);return T.data},async downloadFinalReportPdf(a,k,r=null){const w={activity_code:k,format:"pdf"};return r&&(w.scoring_result_id=r),await Q.get(`/participants/${a}/final-report`,{params:w,responseType:"blob"})}},Ke=ct("metrics",()=>{const a=b([]),k=b(!1),r=b(null),w=b(null),T=300*1e3,E=J(()=>w.value?Date.now()-w.value>T:!0),P=J(()=>a.value.length>0);async function x({force:y=!1,activeOnly:R=!1}={}){if(!y&&P.value&&!E.value)return a.value;if(k.value)return new Promise(M=>{const V=setInterval(()=>{k.value||(clearInterval(V),M(a.value))},50)});k.value=!0,r.value=null;try{const M=await ge.listMetricDefs(R);return a.value=M,w.value=Date.now(),M}catch(M){const V=dt(M,"Ошибка загрузки метрик");throw r.value=V.message,M.normalizedError=V,M}finally{k.value=!1}}function A(y){return a.value.find(R=>R.id===y)}function q(y){const R=A(y);return R?.name_ru||R?.name||y}function W(){w.value=null}function D(y){const R=a.value.findIndex(M=>M.id===y.id);R!==-1&&(a.value[R]=y)}function $(y){a.value=a.value.filter(R=>R.id!==y)}function O(y){a.value.push(y)}return{metricDefs:a,loading:k,error:r,isStale:E,hasData:P,fetchMetricDefs:x,getMetricDefById:A,getMetricName:q,invalidateCache:W,updateInCache:D,removeFromCache:$,addToCache:O}});function we(a,k=1){if(a==null||a==="")return"";const r=typeof a=="string"?parseFloat(a):a;return isNaN(r)?"":r.toLocaleString("ru-RU",{minimumFractionDigits:k,maximumFractionDigits:k})}function ie(a){if(a==null||a==="")return null;const r=String(a).trim().replace(",","."),w=parseFloat(r);return isNaN(w)?null:w}function Rt(a){return ie(a)}function Ze(a,k=1){return we(a,k)}const Mt={key:0,class:"error-message"},Vt={__name:"MetricInput",props:{modelValue:{type:[Number,String],default:null},min:{type:Number,default:1},max:{type:Number,default:10},step:{type:Number,default:.1},precision:{type:Number,default:1},placeholder:{type:String,default:"Введите значение"},disabled:{type:Boolean,default:!1},showControls:{type:Boolean,default:!0}},emits:["update:modelValue","change","blur"],setup(a,{emit:k}){const r=a,w=k,T=b(null),E=b(""),P=b(!1),x=b(!1),A=b(""),q=J(()=>ie(E.value)),W=J(()=>{const p=q.value;return p===null||p<=r.min}),D=J(()=>{const p=q.value;return p===null||p>=r.max}),$=p=>{if(p==null||p===""){E.value="";return}P.value?E.value=String(p).replace(".",","):E.value=we(p,r.precision)},O=p=>{if(p==null||p==="")return x.value=!1,A.value="",!0;const S=ie(p);return S===null?(x.value=!0,A.value="Некорректное число",!1):S<r.min?(x.value=!0,A.value=`Значение должно быть не меньше ${we(r.min,r.precision)}`,!1):S>r.max?(x.value=!0,A.value=`Значение должно быть не больше ${we(r.max,r.precision)}`,!1):(x.value=!1,A.value="",!0)},y=p=>{const S=p.replace(/[^\d,.-]/g,"");let f=!1;const B=S.split("").filter(F=>F===","||F==="."?f?!1:(f=!0,!0):!0).join("").replace(".",",");E.value=B;const j=ie(B);j!==null?w("update:modelValue",j):(B===""||B==="-")&&w("update:modelValue",null)},R=()=>{P.value=!1;const p=ie(E.value);if(O(E.value)){if(p!==null){const S=Math.round(p*Math.pow(10,r.precision))/Math.pow(10,r.precision),f=Math.max(r.min,Math.min(r.max,S));w("update:modelValue",f),$(f),w("change",f)}}else if(p!==null&&(p<r.min||p>r.max)){const S=Math.max(r.min,Math.min(r.max,p));w("update:modelValue",S),$(S),w("change",S),x.value=!1,A.value=""}w("blur")},M=()=>{P.value=!0,q.value!==null&&(E.value=String(q.value).replace(".",","))},V=()=>{const p=q.value||0,S=Math.min(r.max,p+r.step),f=Math.round(S*Math.pow(10,r.precision))/Math.pow(10,r.precision);w("update:modelValue",f),w("change",f),$(f)},u=()=>{const p=q.value||0,S=Math.max(r.min,p-r.step),f=Math.round(S*Math.pow(10,r.precision))/Math.pow(10,r.precision);w("update:modelValue",f),w("change",f),$(f)};return ne(()=>r.modelValue,p=>{$(p)},{immediate:!0}),$(r.modelValue),(p,S)=>{const f=c("el-button"),B=c("el-button-group"),j=c("el-input");return o(),N(ee,null,[t(j,{ref_key:"inputRef",ref:T,modelValue:E.value,"onUpdate:modelValue":S[0]||(S[0]=F=>E.value=F),placeholder:a.placeholder,disabled:a.disabled,class:Xe({"is-invalid":x.value}),onInput:y,onBlur:R,onFocus:M},pt({_:2},[a.showControls?{name:"append",fn:e(()=>[t(B,null,{default:e(()=>[t(f,{icon:m(ft),disabled:a.disabled||W.value,onClick:u},null,8,["icon","disabled"]),t(f,{icon:m(mt),disabled:a.disabled||D.value,onClick:V},null,8,["icon","disabled"])]),_:1})]),key:"0"}:void 0]),1032,["modelValue","placeholder","disabled","class"]),x.value?(o(),N("div",Mt,C(A.value),1)):L("",!0)],64)}}},At=ue(Vt,[["__scopeId","data-v-f31d5553"]]),It={class:"card-header"},Ft={class:"card-header-left"},Tt={class:"card-header-actions"},Nt={class:"metrics-filter"},zt={class:"metrics-stats"},Pt={class:"metrics-count"},Lt={key:0,class:"metric-description"},Ot={key:0,class:"metrics-info"},Ut={class:"info-row"},Bt={key:0,class:"info-row"},Xt={__name:"MetricsEditor",props:{reportId:{type:String,required:!0},reportStatus:{type:String,default:null},reportExtractWarning:{type:String,default:null}},emits:["metrics-updated"],setup(a,{emit:k}){const r=a,w=k,T=b(!1),E=b(!1),P=b(!1),x=b(null),A=b(!1),q=b(0),W=b(0),D=b([]),$=b([]),O=b({metrics:{}}),y=b({}),R=b("metrics"),M=b(null),V=J(()=>{if(!D.value||D.value.length===0)return[];if(A.value)return D.value;const g=new Set($.value.filter(i=>{const s=parseFloat(String(i.value).replace(",","."));return!isNaN(s)&&s>0}).map(i=>i.metric_def_id));return D.value.filter(i=>{const s=g.has(i.id),X=O.value.metrics[i.id],Z=X!=null&&X!==""&&parseFloat(String(X).replace(",","."))>0;return s||Z})}),u=J(()=>!$.value||$.value.length===0?[]:[...new Set($.value.map(g=>g.source))]),p=J(()=>{if(!$.value||$.value.length===0)return null;const g=$.value.map(i=>i.updated_at||i.created_at).filter(Boolean).map(i=>new Date(i));return g.length===0?null:new Date(Math.max(...g))}),S=async()=>{T.value=!0,x.value=null;try{const g=await ge.getMetricTemplate(r.reportId);q.value=g.filled_count||0,W.value=g.missing_count||0;const i=g.items||[];$.value=i.filter(s=>s.value!==null).map(s=>({metric_def_id:s.metric_def.id,value:s.value,source:s.source,confidence:s.confidence,notes:s.notes,updated_at:s.updated_at})),D.value=i.map(s=>({id:s.metric_def.id,code:s.metric_def.code,name:s.metric_def.name,name_ru:s.metric_def.name_ru,unit:s.metric_def.unit,min_value:s.metric_def.min_value,max_value:s.metric_def.max_value,description:s.metric_def.description})),O.value.metrics={},i.forEach(s=>{const X=s.metric_def.id;s.value!==null?O.value.metrics[X]=ie(s.value):O.value.metrics[X]=null}),y.value=JSON.parse(JSON.stringify(O.value.metrics))}catch(g){console.error("Failed to load metrics:",g),x.value="Не удалось загрузить метрики"}finally{T.value=!1}},f=async()=>{await S(),U.success("Метрики обновлены")},B=()=>{M.value||(M.value=setInterval(async()=>{await S()},5e3))},j=()=>{M.value&&(clearInterval(M.value),M.value=null)},F=()=>{P.value=!0,A.value=!0,y.value=JSON.parse(JSON.stringify(O.value.metrics))},te=()=>{O.value.metrics=JSON.parse(JSON.stringify(y.value)),P.value=!1,x.value=null},H=async()=>{E.value=!0,x.value=null;try{const g=[],i=[];for(const[K,le]of Object.entries(O.value.metrics)){const se=y.value[K],pe=se!=null&&se!=="";if(le!=null&&le!==""){const oe=Rt(le);oe!==null&&g.push({metric_def_id:K,value:oe,source:"MANUAL",notes:null})}else pe&&i.push(K)}const X=(await Promise.allSettled(i.map(K=>ge.clearExtractedMetric(r.reportId,K)))).filter(K=>K.status==="fulfilled"||K.status==="rejected"&&K.reason?.response?.status===404).length;g.length>0&&await ge.bulkCreateExtractedMetrics(r.reportId,g);const Z=[];g.length>0&&Z.push(`сохранено: ${g.length}`),X>0&&Z.push(`сброшено: ${X}`),Z.length===0?U.info("Нет изменений для сохранения"):U.success(`Метрики обновлены (${Z.join(", ")})`),P.value=!1,await S(),w("metrics-updated")}catch(g){console.error("Failed to save metrics:",g);let i="Не удалось сохранить метрики";g.response?.data?.detail&&(typeof g.response.data.detail=="string"?i=g.response.data.detail:Array.isArray(g.response.data.detail)&&(i=g.response.data.detail.map(s=>s.msg||s.message).join(", "))),x.value=i,U.error(i)}finally{E.value=!1}},ce=g=>{switch(g){case"OCR":return"info";case"LLM":return"warning";case"MANUAL":return"success";default:return""}},Y=g=>{switch(g){case"OCR":return"OCR";case"LLM":return"Gemini Vision";case"MANUAL":return"Ручной ввод";default:return g}},de=Et;return Fe(async()=>{}),qe(()=>{j()}),ne(()=>r.reportId,async g=>{g&&await S()}),ne(()=>r.reportStatus,async(g,i)=>{i||await S(),g==="PROCESSING"?(B(),i&&i!=="PROCESSING"&&await S()):(j(),g==="EXTRACTED"&&i&&i!=="EXTRACTED"&&await S())},{immediate:!0}),(g,i)=>{const s=c("el-icon"),X=c("el-tag"),Z=c("el-button"),K=c("el-alert"),le=c("el-switch"),se=c("el-form-item"),pe=c("el-col"),oe=c("el-row"),be=c("el-form"),_e=c("el-divider"),ke=c("el-tab-pane"),Ce=c("el-tabs"),$e=c("el-card");return o(),_($e,{class:"metrics-editor"},{header:e(()=>[d("div",It,[d("div",Ft,[i[5]||(i[5]=d("span",null,"Метрики отчёта",-1)),a.reportStatus==="PROCESSING"?(o(),_(X,{key:0,type:"warning",size:"small",class:"status-tag"},{default:e(()=>[t(s,{class:"is-loading"},{default:e(()=>[t(m(he))]),_:1}),i[3]||(i[3]=v(" Извлечение... ",-1))]),_:1})):a.reportStatus==="EXTRACTED"?(o(),_(X,{key:1,type:"success",size:"small",class:"status-tag"},{default:e(()=>[...i[4]||(i[4]=[v(" Извлечено ",-1)])]),_:1})):L("",!0)]),d("div",Tt,[P.value?L("",!0):(o(),_(Z,{key:0,size:"small",loading:T.value,onClick:f},{default:e(()=>[t(s,null,{default:e(()=>[t(m(Ge))]),_:1}),i[6]||(i[6]=v(" Обновить ",-1))]),_:1},8,["loading"])),P.value?(o(),N(ee,{key:2},[t(Z,{size:"small",onClick:te},{default:e(()=>[...i[8]||(i[8]=[v(" Отмена ",-1)])]),_:1}),t(Z,{type:"primary",size:"small",loading:E.value,onClick:H},{default:e(()=>[...i[9]||(i[9]=[v(" Сохранить ",-1)])]),_:1},8,["loading"])],64)):(o(),_(Z,{key:1,type:"primary",size:"small",onClick:F},{default:e(()=>[...i[7]||(i[7]=[v(" Редактировать ",-1)])]),_:1}))])])]),default:e(()=>[x.value?(o(),_(K,{key:0,type:"error",title:x.value,closable:"",style:{"margin-bottom":"16px"},onClose:i[0]||(i[0]=G=>x.value=null)},null,8,["title"])):L("",!0),r.reportExtractWarning&&r.reportStatus==="EXTRACTED"?(o(),_(K,{key:1,type:"warning",title:r.reportExtractWarning,closable:!1,style:{"margin-bottom":"16px"}},null,8,["title"])):L("",!0),!$.value||$.value.length===0?(o(),_(K,{key:2,type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:e(()=>[...i[10]||(i[10]=[v(" Метрики для этого отчёта ещё не извлечены. Вы можете ввести их вручную. ",-1)])]),_:1})):L("",!0),t(Ce,{modelValue:R.value,"onUpdate:modelValue":i[2]||(i[2]=G=>R.value=G),type:"card"},{default:e(()=>[t(ke,{label:"Метрики",name:"metrics"},{default:e(()=>[d("div",Nt,[t(le,{modelValue:A.value,"onUpdate:modelValue":i[1]||(i[1]=G=>A.value=G),"active-text":"Показать все метрики","inactive-text":"Только заполненные"},null,8,["modelValue"]),d("div",zt,[t(X,{type:"success",size:"small"},{default:e(()=>[v(" Заполнено: "+C(q.value),1)]),_:1}),t(X,{type:"info",size:"small"},{default:e(()=>[v(" Не заполнено: "+C(W.value),1)]),_:1}),d("span",Pt," Показано: "+C(V.value.length)+" из "+C(D.value.length),1)])]),t(be,{ref:"formRef",model:O.value,"label-position":"top",disabled:!P.value},{default:e(()=>[t(oe,{gutter:20},{default:e(()=>[(o(!0),N(ee,null,ae(V.value,G=>(o(),_(pe,{key:G.id,xs:24,sm:12,md:8,lg:6},{default:e(()=>[t(se,{label:m($t)(G),prop:`metrics.${G.id}`},{default:e(()=>[t(At,{modelValue:O.value.metrics[G.id],"onUpdate:modelValue":ve=>O.value.metrics[G.id]=ve,min:G.min_value||1,max:G.max_value||10,precision:1,step:.1,disabled:!P.value,"show-controls":!0,placeholder:"Введите значение (например: 7,5)"},null,8,["modelValue","onUpdate:modelValue","min","max","disabled"]),G.description?(o(),N("div",Lt,C(G.description),1)):L("",!0)]),_:2},1032,["label","prop"])]),_:2},1024))),128))]),_:1})]),_:1},8,["model","disabled"]),$.value&&$.value.length>0?(o(),N("div",Ot,[t(_e),d("div",Ut,[i[11]||(i[11]=d("span",{class:"info-label"},"Источник данных:",-1)),(o(!0),N(ee,null,ae(u.value,G=>(o(),_(X,{key:G,type:ce(G),size:"small",style:{"margin-left":"8px"}},{default:e(()=>[v(C(Y(G)),1)]),_:2},1032,["type"]))),128))]),p.value?(o(),N("div",Bt,[i[12]||(i[12]=d("span",{class:"info-label"},"Последнее обновление:",-1)),d("span",null,C(m(de)(p.value)),1)])):L("",!0)])):L("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},qt=ue(Xt,[["__scopeId","data-v-ab75caac"]]),Gt={class:"report-list"},jt={class:"report-list__controls"},Jt={class:"controls-left"},Wt={class:"controls-right"},Ht={class:"filename"},Kt={class:"status-cell"},Zt={key:1,class:"report-list__cards"},Qt={class:"report-card__header"},Yt={class:"report-card__status"},ea={class:"report-card__body"},ta={class:"report-card__field"},aa={class:"field-value field-value--filename"},la={class:"report-card__field"},sa={class:"field-value"},na={class:"report-card__actions"},oa={__name:"ReportList",props:{reports:{type:Array,required:!0,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["view","edit","extract","download","delete","upload"],setup(a,{emit:k}){const r=a,w=k,T=je(),E=Je(),{isMobile:P}=We();Fe(()=>{T.query.status&&(x.value=T.query.status),T.query.sort&&(A.value=T.query.sort)});const x=b(""),A=b("desc"),q=[{label:"Загружен",value:"UPLOADED"},{label:"Извлечение метрик...",value:"PROCESSING"},{label:"Метрики извлечены",value:"EXTRACTED"},{label:"Ошибка",value:"FAILED"}];ne([x,A],([V,u])=>{const p={...T.query};V?p.status=V:delete p.status,u?p.sort=u:delete p.sort,E.replace({query:p})});const W=()=>{},D=()=>{A.value=A.value==="desc"?"asc":"desc"},$=J(()=>{let V=[...r.reports];return x.value&&(V=V.filter(u=>u.status===x.value)),V.sort((u,p)=>{const S=new Date(u.uploaded_at),f=new Date(p.uploaded_at);return A.value==="desc"?f-S:S-f}),V}),O=J(()=>x.value?"Нет отчётов с выбранным статусом":"Нет загруженных отчётов"),y=V=>({UPLOADED:"Загружен",PROCESSING:"Извлечение метрик...",EXTRACTED:"Метрики извлечены",FAILED:"Ошибка"})[V]||V,R=V=>({UPLOADED:"info",PROCESSING:"warning",EXTRACTED:"success",FAILED:"danger"})[V]||"info",M=async({action:V,report:u})=>{switch(V){case"view":w("view",u.id);break;case"edit":w("edit",u.id);break;case"extract":w("extract",u.id);break;case"download":w("download",u.id);break;case"delete":try{await yt.confirm("Вы уверены, что хотите удалить этот отчёт?","Подтверждение удаления",{confirmButtonText:"Удалить",cancelButtonText:"Отмена",type:"warning"}),w("delete",u.id)}catch{}break}};return(V,u)=>{const p=c("el-option"),S=c("el-select"),f=c("el-icon"),B=c("el-button"),j=c("el-table-column"),F=c("el-tag"),te=c("el-dropdown-item"),H=c("el-dropdown-menu"),ce=c("el-dropdown"),Y=c("el-table"),de=c("el-card"),g=c("el-empty"),i=Te("loading");return o(),N("div",Gt,[d("div",jt,[d("div",Jt,[t(S,{modelValue:x.value,"onUpdate:modelValue":u[0]||(u[0]=s=>x.value=s),placeholder:"Все статусы",clearable:"",style:{width:"200px"},onChange:W},{default:e(()=>[t(p,{label:"Все статусы",value:""}),(o(),N(ee,null,ae(q,s=>t(p,{key:s.value,label:s.label,value:s.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),d("div",Wt,[t(B,{type:A.value==="desc"?"primary":"default",size:"small",onClick:D},{default:e(()=>[t(f,null,{default:e(()=>[t(m(_t))]),_:1}),v(" "+C(A.value==="desc"?"Новые сверху":"Старые сверху"),1)]),_:1},8,["type"])])]),m(P)?fe((o(),N("div",Zt,[(o(!0),N(ee,null,ae($.value,s=>(o(),_(de,{key:s.id,class:"report-card",shadow:"hover"},{header:e(()=>[d("div",Qt,[d("div",Yt,[s.status==="PROCESSING"?(o(),_(f,{key:0,class:"status-icon status-icon--spinning"},{default:e(()=>[t(m(he))]),_:1})):s.status==="EXTRACTED"?(o(),_(f,{key:1,class:"status-icon status-icon--success"},{default:e(()=>[t(m(Re))]),_:1})):s.status==="FAILED"?(o(),_(f,{key:2,class:"status-icon status-icon--error"},{default:e(()=>[t(m(Me))]),_:1})):(o(),_(f,{key:3,class:"status-icon status-icon--info"},{default:e(()=>[t(m(Ve))]),_:1})),t(F,{type:R(s.status),size:"small"},{default:e(()=>[v(C(y(s.status)),1)]),_:2},1032,["type"])])])]),footer:e(()=>[d("div",na,[s.status==="EXTRACTED"?(o(),_(B,{key:0,type:"success",size:"small",onClick:X=>M({action:"edit",report:s})},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Pe))]),_:1}),u[10]||(u[10]=v(" Редактировать ",-1))]),_:1},8,["onClick"])):L("",!0),s.status==="PROCESSING"||s.status==="EXTRACTED"?(o(),_(B,{key:1,type:"info",size:"small",onClick:X=>M({action:"view",report:s})},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Le))]),_:1}),u[11]||(u[11]=v(" Просмотр ",-1))]),_:1},8,["onClick"])):L("",!0),t(B,{type:"primary",size:"small",onClick:X=>M({action:"extract",report:s})},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Oe))]),_:1}),v(" "+C(s.status==="FAILED"?"Повторить":s.status==="PROCESSING"?"Перезапустить":s.status==="EXTRACTED"?"Переизвлечь":"Извлечь"),1)]),_:2},1032,["onClick"]),t(B,{size:"small",onClick:X=>M({action:"download",report:s})},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Ae))]),_:1}),u[12]||(u[12]=v(" Скачать ",-1))]),_:1},8,["onClick"]),t(B,{type:"danger",size:"small",onClick:X=>M({action:"delete",report:s})},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Ie))]),_:1})]),_:1},8,["onClick"])])]),default:e(()=>[d("div",ea,[d("div",ta,[u[8]||(u[8]=d("span",{class:"field-label"},"Файл:",-1)),d("span",aa,C(s.file_ref?.filename||"Без названия"),1)]),d("div",la,[u[9]||(u[9]=d("span",{class:"field-label"},"Дата загрузки:",-1)),d("span",sa,C(m(me)(s.uploaded_at)),1)])])]),_:2},1024))),128)),!$.value.length&&!a.loading?(o(),_(g,{key:0,description:O.value,"image-size":120},{default:e(()=>[x.value?L("",!0):(o(),_(B,{key:0,type:"primary",onClick:u[1]||(u[1]=s=>V.$emit("upload"))},{default:e(()=>[...u[13]||(u[13]=[v(" Загрузить отчёт ",-1)])]),_:1}))]),_:1},8,["description"])):L("",!0)])),[[i,a.loading]]):fe((o(),_(Y,{key:0,data:$.value,class:"report-list__table",stripe:"","empty-text":O.value},{default:e(()=>[t(j,{prop:"file_ref.filename",label:"Название файла","min-width":"200"},{default:e(({row:s})=>[d("span",Ht,C(s.file_ref?.filename||"Без названия"),1)]),_:1}),t(j,{prop:"status",label:"Статус",width:"200"},{default:e(({row:s})=>[d("div",Kt,[s.status==="PROCESSING"?(o(),_(f,{key:0,class:"status-icon status-icon--spinning"},{default:e(()=>[t(m(he))]),_:1})):s.status==="EXTRACTED"?(o(),_(f,{key:1,class:"status-icon status-icon--success"},{default:e(()=>[t(m(Re))]),_:1})):s.status==="FAILED"?(o(),_(f,{key:2,class:"status-icon status-icon--error"},{default:e(()=>[t(m(Me))]),_:1})):(o(),_(f,{key:3,class:"status-icon status-icon--info"},{default:e(()=>[t(m(Ve))]),_:1})),t(F,{type:R(s.status),size:"default"},{default:e(()=>[v(C(y(s.status)),1)]),_:2},1032,["type"])])]),_:1}),t(j,{prop:"uploaded_at",label:"Дата загрузки",width:"180",sortable:""},{default:e(({row:s})=>[v(C(m(me)(s.uploaded_at)),1)]),_:1}),t(j,{label:"Действия",width:"200",fixed:"right",align:"right"},{default:e(({row:s})=>[t(ce,{trigger:"click",onCommand:M},{dropdown:e(()=>[t(H,null,{default:e(()=>[s.status==="EXTRACTED"?(o(),_(te,{key:0,command:{action:"edit",report:s}},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Pe))]),_:1}),u[4]||(u[4]=v(" Редактировать метрики ",-1))]),_:1},8,["command"])):L("",!0),s.status==="PROCESSING"||s.status==="EXTRACTED"?(o(),_(te,{key:1,command:{action:"view",report:s}},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Le))]),_:1}),u[5]||(u[5]=v(" Просмотр метрик ",-1))]),_:1},8,["command"])):L("",!0),t(te,{command:{action:"extract",report:s}},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Oe))]),_:1}),v(" "+C(s.status==="FAILED"?"Повторить извлечение":s.status==="PROCESSING"?"Перезапустить извлечение":s.status==="EXTRACTED"?"Переизвлечь метрики":"Извлечь метрики"),1)]),_:2},1032,["command"]),t(te,{divided:"",command:{action:"download",report:s}},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Ae))]),_:1}),u[6]||(u[6]=v(" Скачать ",-1))]),_:1},8,["command"]),t(te,{command:{action:"delete",report:s},class:"dropdown-item--danger"},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Ie))]),_:1}),u[7]||(u[7]=v(" Удалить ",-1))]),_:1},8,["command"])]),_:2},1024)]),default:e(()=>[t(B,{type:"primary",size:"small"},{default:e(()=>[u[3]||(u[3]=v(" Действия ",-1)),t(f,{class:"el-icon--right"},{default:e(()=>[t(m(vt))]),_:1})]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data","empty-text"])),[[i,a.loading]]),!$.value.length&&!a.loading&&!m(P)?(o(),_(g,{key:2,description:O.value,"image-size":120},{default:e(()=>[x.value?L("",!0):(o(),_(B,{key:0,type:"primary",onClick:u[2]||(u[2]=s=>V.$emit("upload"))},{default:e(()=>[...u[14]||(u[14]=[v(" Загрузить отчёт ",-1)])]),_:1}))]),_:1},8,["description"])):L("",!0)])}}},ra=ue(oa,[["__scopeId","data-v-49005412"]]),ia={class:"metrics-drawer"},ua={class:"drawer-actions"},ca={key:1},da={key:1},pa={__name:"ParticipantMetricsDrawer",props:{modelValue:{type:Boolean,required:!0},participantId:{type:String,required:!0},participantName:{type:String,required:!0}},emits:["update:modelValue"],setup(a,{emit:k}){const r=a,w=k,T=Ke(),E=b(!1),P=b([]),x=J(()=>T.metricDefs),A=J(()=>"Метрики ещё не извлечены. Загрузите и обработайте отчёты."),q=y=>{w("update:modelValue",y)},W=async()=>{try{await T.fetchMetricDefs({activeOnly:!0})}catch(y){console.error("Error loading metric definitions:",y)}},D=async()=>{E.value=!0;try{const y=await He.getMetrics(r.participantId);P.value=y.metrics||[]}catch(y){console.error("Error loading participant metrics:",y),U.error("Ошибка загрузки метрик участника")}finally{E.value=!1}},$=y=>{if(!y)return"—";const R=x.value?.find(V=>V.code===y);return St(R,y,{warn:()=>{}})},O=y=>y>=.8?"var(--el-color-success)":y>=.6?"var(--el-color-warning)":"var(--el-color-danger)";return ne(()=>r.participantId,async y=>{y&&r.modelValue&&(await W(),await D())}),ne(()=>r.modelValue,async y=>{y&&r.participantId&&(await W(),await D())}),(y,R)=>{const M=c("el-icon"),V=c("el-button"),u=c("el-table-column"),p=c("el-tag"),S=c("el-table"),f=c("el-empty"),B=c("el-drawer"),j=Te("loading");return o(),_(B,{"model-value":a.modelValue,title:`Метрики участника: ${a.participantName}`,size:"70%",direction:"rtl","onUpdate:modelValue":q},{default:e(()=>[fe((o(),N("div",ia,[d("div",ua,[t(V,{type:"primary",size:"small",onClick:D},{default:e(()=>[t(M,null,{default:e(()=>[t(m(Ge))]),_:1}),R[0]||(R[0]=v(" Обновить ",-1))]),_:1})]),t(S,{data:P.value,stripe:"","empty-text":A.value},{default:e(()=>[t(u,{prop:"metric_code",label:"Код метрики",width:"200"}),t(u,{label:"Название метрики","min-width":"250"},{default:e(({row:F})=>[v(C($(F.metric_code)),1)]),_:1}),t(u,{prop:"value",label:"Значение",width:"120"},{default:e(({row:F})=>[t(p,{type:"success"},{default:e(()=>[v(C(m(Ze)(F.value)),1)]),_:2},1024)]),_:1}),t(u,{prop:"confidence",label:"Уверенность",width:"150"},{default:e(({row:F})=>[F.confidence!==null?(o(),N("span",{key:0,style:gt({color:O(F.confidence)})},C((F.confidence*100).toFixed(0))+"% ",5)):(o(),N("span",ca,"—"))]),_:1}),t(u,{prop:"updated_at",label:"Обновлено",width:"180"},{default:e(({row:F})=>[v(C(m(me)(F.updated_at)),1)]),_:1}),t(u,{prop:"last_source_report_id",label:"Источник"},{default:e(({row:F})=>[F.last_source_report_id?(o(),_(p,{key:0,size:"small"},{default:e(()=>[...R[1]||(R[1]=[v(" Из отчёта ",-1)])]),_:1})):(o(),N("span",da,"—"))]),_:1})]),_:1},8,["data","empty-text"]),!P.value.length&&!E.value?(o(),_(f,{key:0,description:A.value},null,8,["description"])):L("",!0)])),[[j,E.value]])]),_:1},8,["model-value","title"])}}},fa=ue(pa,[["__scopeId","data-v-ce564aa7"]]),ma={class:"scoring-result"},_a={class:"score-value"},va={class:"score-number"},ya={class:"score-details"},ga={class:"score-section"},wa={key:0},ha={class:"score-section"},ba={key:0},ka={key:0,class:"final-report-actions"},Ca={__name:"ScoringResultCard",props:{result:{type:Object,required:!0}},emits:["download-pdf"],setup(a){const k=a,r=J(()=>{const T=k.result.score_pct;return T>=70?"success":T>=40?"warning":"exception"}),w=(T,E=1)=>Ze(T,E);return(T,E)=>{const P=c("el-progress"),x=c("el-empty"),A=c("el-icon"),q=c("el-button"),W=c("el-card");return o(),_(W,{class:"scoring-card"},{default:e(()=>[d("h4",null,C(a.result.prof_activity_name),1),d("div",ma,[d("div",_a,[d("span",va,C(a.result.score_pct)+"%",1),t(P,{percentage:a.result.score_pct,status:r.value},null,8,["percentage","status"])]),d("div",ya,[d("div",ga,[E[1]||(E[1]=d("h5",null,"Сильные стороны:",-1)),a.result.strengths&&a.result.strengths.length?(o(),N("ul",wa,[(o(!0),N(ee,null,ae(a.result.strengths,(D,$)=>(o(),N("li",{key:$},[d("strong",null,C(D.metric_name),1),v(" — "+C(w(D.value))+" (вес "+C(w(D.weight,2))+") ",1)]))),128))])):(o(),_(x,{key:1,description:"Нет данных","image-size":60}))]),d("div",ha,[E[2]||(E[2]=d("h5",null,"Зоны развития:",-1)),a.result.dev_areas&&a.result.dev_areas.length?(o(),N("ul",ba,[(o(!0),N(ee,null,ae(a.result.dev_areas,(D,$)=>(o(),N("li",{key:$},[d("strong",null,C(D.metric_name),1),v(" — "+C(w(D.value))+" (вес "+C(w(D.weight,2))+") ",1)]))),128))])):(o(),_(x,{key:1,description:"Нет данных","image-size":60}))])]),a.result.prof_activity_code?(o(),N("div",ka,[t(q,{type:"primary",size:"small",onClick:E[0]||(E[0]=D=>T.$emit("download-pdf",a.result))},{default:e(()=>[t(A,null,{default:e(()=>[t(m(Ae))]),_:1}),E[3]||(E[3]=v(" Скачать PDF ",-1))]),_:1})])):L("",!0)])]),_:1})}}},$a=ue(Ca,[["__scopeId","data-v-d4c54e9d"]]),Sa={class:"participant-detail"},Ea={class:"card-header"},xa={class:"header-actions"},Da={class:"section-header"},Ra={key:0,class:"batch-files-list"},Ma={class:"batch-files-header"},Va={class:"batch-file-info"},Aa={class:"batch-file-name"},Ia={class:"batch-file-size"},Fa={key:0,class:"batch-file-error"},Ta={class:"activity-code-hint"},Be=20*1024*1024,De=10,Na={__name:"ParticipantDetailView",setup(a){const k=Je(),r=je(),w=Dt(),T=Ke(),E=b(!1),P=b(!1),{isMobile:x}=We(),A=b(!1),q=b(!1),W=b(!1),D=J(()=>w.currentParticipant),$=b([]),O=b([]),y=b([]),R=b(null);J(()=>T.metricDefs);const M=b(null),V=J(()=>$.value.some(l=>l.status==="PROCESSING")),u=J(()=>R.value&&$.value.find(n=>n.id===R.value)?.status||null),p=J(()=>R.value&&$.value.find(n=>n.id===R.value)?.extract_warning||null),S=b(!1),f=b(!1),B=b(!1),j=b(!1),F=b(null),te=b([]),H=b([]);let ce=0;const Y=wt({activityCode:""}),de=async()=>{E.value=!0;try{await w.getParticipant(r.params.id)}catch{U.error("Участник не найден"),k.push("/participants")}finally{E.value=!1}},g=async({silent:l=!1}={})=>{l||(P.value=!0);try{const n=await He.getReports(r.params.id);$.value=n.items||[]}catch(n){console.error("Error loading reports:",n),U.error("Ошибка загрузки списка отчётов")}finally{l||(P.value=!1)}},i=l=>{if(!l)return l;const n=Array.isArray(l.recommendations)?l.recommendations:[];let z=l.recommendations_status||l.recommendationsStatus||null;z||(z=n.length>0?"ready":"pending");const I=Number(l.score_pct),re=Number.isNaN(I)?l.score_pct:I;return{...l,score_pct:re,recommendations:n,recommendations_status:z,recommendations_error:l.recommendations_error||l.recommendationsError||null}},s=async()=>{try{const l=await xe.getHistory(r.params.id),n=Array.isArray(l.items)?l.items:[];O.value=n.map(i)}catch(l){console.error("Error loading scoring results:",l)}},X=async()=>{A.value=!0;try{const l=await xt.list();y.value=l||[]}catch{U.error("Ошибка загрузки профессиональных областей")}finally{A.value=!1}},Z=async()=>{try{await T.fetchMetricDefs({activeOnly:!0})}catch(l){console.error("Error loading metric definitions:",l)}},K=l=>l<1024?l+" B":l<1024*1024?(l/1024).toFixed(1)+" KB":(l/(1024*1024)).toFixed(1)+" MB",le=l=>l.name.toLowerCase().endsWith(".docx")?l.size>Be?`Размер файла превышает ${K(Be)}`:null:"Только файлы формата .docx",se=(l,n)=>{const z=l.raw;if(H.value.length>=De){U.warning(`Максимальное количество файлов: ${De}`),F.value&&F.value.clearFiles();return}const I=le(z);if(I){U.error(I),F.value&&F.value.clearFiles();return}H.value.push({id:++ce,file:z,name:z.name,size:z.size,status:"pending",progress:0,error:null,reportId:null}),F.value&&F.value.clearFiles()},pe=l=>{H.value=H.value.filter(n=>n.id!==l)},oe=async l=>{l.status="uploading",l.progress=0;try{const n=await ye.upload(r.params.id,l.file);l.status="success",l.reportId=n.id}catch(n){l.status="error",l.error=n.response?.data?.detail||"Ошибка загрузки"}},be=async()=>{const l=H.value.filter(n=>n.status==="pending");if(l.length===0){U.warning("Нет файлов для загрузки");return}q.value=!0;try{await Promise.allSettled(l.map(I=>oe(I)));const n=H.value.filter(I=>I.status==="success").length,z=H.value.filter(I=>I.status==="error").length;z===0?(U.success(`Загружено ${n} отчётов`),S.value=!1,_e()):U.warning(`Загружено: ${n}, ошибок: ${z}`),await g()}finally{q.value=!1}},_e=()=>{H.value=[],te.value=[],F.value&&F.value.clearFiles()},ke=async l=>{try{const n=await ye.download(l),z=window.URL.createObjectURL(new Blob([n.data])),I=document.createElement("a");I.href=z,I.setAttribute("download",`report_${l}.docx`),document.body.appendChild(I),I.click(),I.remove(),window.URL.revokeObjectURL(z),U.success("Отчёт скачан")}catch{U.error("Ошибка скачивания отчёта")}},Ce=async l=>{try{await ye.extract(l),U.success("Извлечение метрик запущено"),await g()}catch{U.error("Ошибка запуска извлечения метрик")}},$e=()=>{M.value||(M.value=setInterval(async()=>{try{await g({silent:!0})}catch(l){console.error("Auto-refresh error:",l)}},3e3))},G=()=>{M.value&&(clearInterval(M.value),M.value=null)};ne(V,l=>{l?$e():G()});const ve=async l=>{R.value=l,await kt(),B.value=!0},Qe=async()=>{U.success("Метрики обновлены"),await g({silent:!0})},Ye=async l=>{try{await ye.delete(l),U.success("Отчёт удалён"),await g()}catch{U.error("Ошибка удаления отчёта")}},et=async()=>{if(!Y.activityCode){U.warning("Выберите профессиональную область");return}W.value=!0;try{const l=await xe.calculate(r.params.id,Y.activityCode),n=i({id:l.scoring_result_id,participant_id:r.params.id,prof_activity_code:l.prof_activity_code||Y.activityCode,prof_activity_name:l.prof_activity_name,score_pct:parseFloat(l.score_pct),strengths:l.strengths||[],dev_areas:l.dev_areas||[],recommendations:l.recommendations||[],recommendations_status:l.recommendations_status||((l.recommendations||[]).length>0?"ready":"pending"),recommendations_error:l.recommendations_error||null,created_at:new Date().toISOString()});O.value.unshift(n),U.success("Расчёт пригодности выполнен"),f.value=!1,Y.activityCode=""}catch(l){console.error("Scoring calculation error:",l);const n=l.response?.data?.detail||"Ошибка расчёта пригодности";U.error(n)}finally{W.value=!1}},tt=async l=>{if(!l.prof_activity_code){U.warning("Код профессиональной деятельности не найден");return}try{const n=await xe.downloadFinalReportPdf(r.params.id,l.prof_activity_code,l.id),z=window.URL.createObjectURL(new Blob([n.data])),I=document.createElement("a");I.href=z,I.setAttribute("download",`final_report_${l.prof_activity_code}_${new Date().toISOString().split("T")[0]}.pdf`),document.body.appendChild(I),I.click(),I.remove(),window.URL.revokeObjectURL(z),U.success("Отчёт PDF скачан")}catch(n){const z=n.response?.data?.detail||"Ошибка загрузки PDF отчёта";U.error(z)}};return Fe(async()=>{await Promise.all([de(),g(),s(),X(),Z()])}),qe(()=>{G()}),(l,n)=>{const z=c("el-button"),I=c("el-icon"),re=c("el-descriptions-item"),at=c("el-descriptions"),Se=c("el-card"),lt=c("el-timeline-item"),st=c("el-timeline"),nt=c("el-upload"),Ee=c("el-dialog"),ot=c("el-option"),rt=c("el-select"),it=c("el-form-item"),Ne=c("el-alert"),ut=c("el-form"),ze=Te("loading");return o(),_(Ct,null,{default:e(()=>[fe((o(),N("div",Sa,[D.value?(o(),_(Se,{key:0,class:"detail-card"},{header:e(()=>[d("div",Ea,[d("h2",null,C(D.value.full_name),1),d("div",xa,[t(z,{onClick:n[0]||(n[0]=h=>m(k).back())},{default:e(()=>[...n[12]||(n[12]=[v(" Назад ",-1)])]),_:1}),t(z,{type:"info",onClick:n[1]||(n[1]=h=>j.value=!0)},{default:e(()=>[t(I,null,{default:e(()=>[t(m(ht))]),_:1}),n[13]||(n[13]=v(" Метрики ",-1))]),_:1}),t(z,{type:"primary",onClick:n[2]||(n[2]=h=>f.value=!0)},{default:e(()=>[t(I,null,{default:e(()=>[t(m(bt))]),_:1}),n[14]||(n[14]=v(" Рассчитать пригодность ",-1))]),_:1})])])]),default:e(()=>[t(at,{column:m(x)?1:2,border:""},{default:e(()=>[t(re,{label:"ФИО"},{default:e(()=>[v(C(D.value.full_name),1)]),_:1}),t(re,{label:"Дата рождения"},{default:e(()=>[v(C(D.value.birth_date||"Не указана"),1)]),_:1}),t(re,{label:"Внешний ID"},{default:e(()=>[v(C(D.value.external_id||"Не указан"),1)]),_:1}),t(re,{label:"Дата создания"},{default:e(()=>[v(C(m(me)(D.value.created_at)),1)]),_:1})]),_:1},8,["column"])]),_:1})):L("",!0),t(Se,{class:"section-card"},{header:e(()=>[d("div",Da,[n[16]||(n[16]=d("h3",null,"Отчёты",-1)),t(z,{type:"primary",onClick:n[3]||(n[3]=h=>S.value=!0)},{default:e(()=>[t(I,null,{default:e(()=>[t(m(Ue))]),_:1}),n[15]||(n[15]=v(" Загрузить отчёт ",-1))]),_:1})])]),default:e(()=>[t(ra,{reports:$.value,loading:P.value,onView:ve,onEdit:ve,onExtract:Ce,onDownload:ke,onDelete:Ye,onUpload:n[4]||(n[4]=h=>S.value=!0)},null,8,["reports","loading"])]),_:1}),O.value.length>0?(o(),_(Se,{key:1,class:"section-card"},{header:e(()=>[...n[17]||(n[17]=[d("h3",null,"История оценок пригодности",-1)])]),default:e(()=>[t(st,null,{default:e(()=>[(o(!0),N(ee,null,ae(O.value,h=>(o(),_(lt,{key:h.id,timestamp:m(me)(h.created_at),placement:"top"},{default:e(()=>[t($a,{result:h,onDownloadPdf:tt},null,8,["result"])]),_:2},1032,["timestamp"]))),128))]),_:1})]),_:1})):L("",!0),t(Ee,{modelValue:S.value,"onUpdate:modelValue":n[6]||(n[6]=h=>S.value=h),title:"Загрузить отчёты",width:m(x)?"95%":"600px","destroy-on-close":"",onClose:_e},{footer:e(()=>[t(z,{onClick:n[5]||(n[5]=h=>S.value=!1)},{default:e(()=>[...n[20]||(n[20]=[v(" Отмена ",-1)])]),_:1}),t(z,{type:"primary",loading:q.value,disabled:!H.value.some(h=>h.status==="pending"),onClick:be},{default:e(()=>[v(" Загрузить все ("+C(H.value.filter(h=>h.status==="pending").length)+") ",1)]),_:1},8,["loading","disabled"])]),default:e(()=>[t(nt,{ref_key:"uploadRef",ref:F,"auto-upload":!1,multiple:"",accept:".docx","on-change":se,"show-file-list":!1,drag:""},{tip:e(()=>[...n[18]||(n[18]=[d("div",{class:"el-upload__tip"}," Только .docx файлы, макс. 20 МБ, до 10 файлов ",-1)])]),default:e(()=>[t(I,{class:"el-icon--upload"},{default:e(()=>[t(m(Ue))]),_:1}),n[19]||(n[19]=d("div",{class:"el-upload__text"},[v(" Перетащите файлы сюда или "),d("em",null,"нажмите для выбора")],-1))]),_:1},512),H.value.length?(o(),N("div",Ra,[d("div",Ma," Выбрано файлов: "+C(H.value.length)+"/"+C(De),1),(o(!0),N(ee,null,ae(H.value,h=>(o(),N("div",{key:h.id,class:Xe(["batch-file-item","batch-file-item--"+h.status])},[h.status==="pending"?(o(),_(I,{key:0,class:"batch-file-icon"},{default:e(()=>[t(m(Ve))]),_:1})):h.status==="uploading"?(o(),_(I,{key:1,class:"batch-file-icon is-loading"},{default:e(()=>[t(m(he))]),_:1})):h.status==="success"?(o(),_(I,{key:2,class:"batch-file-icon batch-file-icon--success"},{default:e(()=>[t(m(Re))]),_:1})):h.status==="error"?(o(),_(I,{key:3,class:"batch-file-icon batch-file-icon--error"},{default:e(()=>[t(m(Me))]),_:1})):L("",!0),d("div",Va,[d("span",Aa,C(h.name),1),d("span",Ia,C(K(h.size)),1),h.error?(o(),N("span",Fa,C(h.error),1)):L("",!0)]),h.status==="pending"||h.status==="error"?(o(),_(z,{key:4,type:"danger",icon:m(Ie),circle:"",size:"small",onClick:za=>pe(h.id)},null,8,["icon","onClick"])):L("",!0)],2))),128))])):L("",!0)]),_:1},8,["modelValue","width"]),t(Ee,{modelValue:f.value,"onUpdate:modelValue":n[9]||(n[9]=h=>f.value=h),title:"Рассчитать профессиональную пригодность",width:m(x)?"95%":"500px","destroy-on-close":""},{footer:e(()=>[t(z,{onClick:n[8]||(n[8]=h=>f.value=!1)},{default:e(()=>[...n[21]||(n[21]=[v(" Отмена ",-1)])]),_:1}),t(z,{type:"primary",loading:W.value,disabled:!Y.activityCode||$.value.length===0,onClick:et},{default:e(()=>[...n[22]||(n[22]=[v(" Рассчитать ",-1)])]),_:1},8,["loading","disabled"])]),default:e(()=>[t(ut,{model:Y,"label-position":"top"},{default:e(()=>[t(it,{label:"Профессиональная область",required:""},{default:e(()=>[fe((o(),_(rt,{modelValue:Y.activityCode,"onUpdate:modelValue":n[7]||(n[7]=h=>Y.activityCode=h),placeholder:"Выберите область",style:{width:"100%"}},{default:e(()=>[(o(!0),N(ee,null,ae(y.value,h=>(o(),_(ot,{key:h.code,label:h.name,value:h.code},{default:e(()=>[d("span",null,C(h.name),1),d("span",Ta,C(h.code),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])),[[ze,A.value]])]),_:1}),t(Ne,{title:"Убедитесь, что у участника загружены и обработаны отчёты с метриками",type:"info",closable:!1,"show-icon":""}),$.value.length===0?(o(),_(Ne,{key:0,title:"У участника нет загруженных отчётов",type:"warning",closable:!1,"show-icon":"",style:{"margin-top":"12px"}})):L("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","width"]),t(Ee,{modelValue:B.value,"onUpdate:modelValue":n[10]||(n[10]=h=>B.value=h),title:"Метрики отчёта",width:"90%",top:"5vh","destroy-on-close":""},{default:e(()=>[R.value?(o(),_(qt,{key:0,"report-id":R.value,"report-status":u.value,"report-extract-warning":p.value,onMetricsUpdated:Qe},null,8,["report-id","report-status","report-extract-warning"])):L("",!0)]),_:1},8,["modelValue"]),t(fa,{modelValue:j.value,"onUpdate:modelValue":n[11]||(n[11]=h=>j.value=h),"participant-id":D.value?.id,"participant-name":D.value?.full_name},null,8,["modelValue","participant-id","participant-name"])])),[[ze,E.value]])]),_:1})}}},qa=ue(Na,[["__scopeId","data-v-08dc28d3"]]);export{qa as default};
