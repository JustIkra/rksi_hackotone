import{O as W,m as y,P as ee,p as ie,r as f,c as S,o as s,d as e,x as F,Q as mt,w as t,u as c,R as _t,K as vt,z as je,B as w,F as Y,H as Je,S as at,v as g,f as v,a as u,C as se,T as he,U as yt,V as gt,W as wt,X as ht,L as lt,Y as bt,Z as st,E as T,q as nt,e as ot,I as He,J as be,_ as kt,k as Ue,$ as Be,g as Xe,a0 as Ct,a1 as Ze,a2 as Qe,h as Ye,a3 as Ge,a4 as qe,N as $t,n as Et,a5 as St,t as xt,a6 as et,G as Rt}from"./index-BtALiBmK.js";import{A as Mt}from"./AppLayout-kQjWe9-A.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{f as Vt,m as we,g as Dt}from"./metricNames-UP-KfrpK.js";import{f as It,a as ke,p as At}from"./dateFormat-DXrTaU_c.js";import{a as rt,p as it,u as Ft}from"./useResponsive-BFrnjB2S.js";const ye={async upload(o,$){const n=new FormData;return n.append("file",$),(await W.post(`/participants/${o}/reports`,n,{headers:{"Content-Type":"multipart/form-data"}})).data},async download(o){return await W.get(`/reports/${o}/download`,{responseType:"blob"})},async getById(o){return(await W.get(`/reports/${o}`)).data},async delete(o){return(await W.delete(`/reports/${o}`)).data},async extract(o){return(await W.post(`/reports/${o}/extract`)).data},async getMetrics(o){return(await W.get(`/reports/${o}/metrics`)).data},async getList(o){return(await W.get(`/participants/${o}/reports`)).data},async getReportImages(o){return(await W.get(`/reports/${o}/images`)).data}},Oe={async calculate(o,$){return(await W.post(`/scoring/participants/${o}/calculate`,null,{params:{activity_code:$}})).data},async getHistory(o,$=10){return(await W.get(`/scoring/participants/${o}/scores`,{params:{limit:$}})).data},async getById(o){return(await W.get(`/scoring-results/${o}`)).data},async generateRecommendations(o){return(await W.post(`/reports/${o}/recommendations`)).data},async getFinalReport(o,$,n="json"){const x={params:{activity_code:$,format:n}};n==="html"&&(x.responseType="text");const L=await W.get(`/participants/${o}/final-report`,x);return L.data},async downloadFinalReportPdf(o,$,n=null){const x={activity_code:$,format:"pdf"};return n&&(x.scoring_result_id=n),await W.get(`/participants/${o}/final-report`,{params:x,responseType:"blob"})}};function xe(o,$=1){if(o==null||o==="")return"";const n=typeof o=="string"?parseFloat(o):o;return isNaN(n)?"":n.toLocaleString("ru-RU",{minimumFractionDigits:$,maximumFractionDigits:$})}function me(o){if(o==null||o==="")return null;const n=String(o).trim().replace(",","."),x=parseFloat(n);return isNaN(x)?null:x}function Nt(o){return me(o)}function ge(o,$=1){return xe(o,$)}const Tt={key:0,class:"error-message"},zt={__name:"MetricInput",props:{modelValue:{type:[Number,String],default:null},min:{type:Number,default:1},max:{type:Number,default:10},step:{type:Number,default:.1},precision:{type:Number,default:1},placeholder:{type:String,default:"Введите значение"},disabled:{type:Boolean,default:!1},showControls:{type:Boolean,default:!0}},emits:["update:modelValue","change","blur"],setup(o,{emit:$}){const n=o,x=$,L=y(null),O=y(""),B=y(!1),C=y(!1),z=y(""),J=ee(()=>me(O.value)),q=ee(()=>{const d=J.value;return d===null||d<=n.min}),j=ee(()=>{const d=J.value;return d===null||d>=n.max}),I=d=>{if(d==null||d===""){O.value="";return}B.value?O.value=String(d).replace(".",","):O.value=xe(d,n.precision)},k=d=>{if(d==null||d==="")return C.value=!1,z.value="",!0;const V=me(d);return V===null?(C.value=!0,z.value="Некорректное число",!1):V<n.min?(C.value=!0,z.value=`Значение должно быть не меньше ${xe(n.min,n.precision)}`,!1):V>n.max?(C.value=!0,z.value=`Значение должно быть не больше ${xe(n.max,n.precision)}`,!1):(C.value=!1,z.value="",!0)},H=d=>{const V=d.replace(/[^\d,.-]/g,"");let _=!1;const A=V.split("").filter(te=>te===","||te==="."?_?!1:(_=!0,!0):!0).join("").replace(".",",");O.value=A;const R=me(A);R!==null?x("update:modelValue",R):(A===""||A==="-")&&x("update:modelValue",null)},K=()=>{B.value=!1;const d=me(O.value);if(k(O.value)){if(d!==null){const V=Math.round(d*Math.pow(10,n.precision))/Math.pow(10,n.precision),_=Math.max(n.min,Math.min(n.max,V));x("update:modelValue",_),I(_),x("change",_)}}else if(d!==null&&(d<n.min||d>n.max)){const V=Math.max(n.min,Math.min(n.max,d));x("update:modelValue",V),I(V),x("change",V),C.value=!1,z.value=""}x("blur")},P=()=>{B.value=!0,J.value!==null&&(O.value=String(J.value).replace(".",","))},M=()=>{const d=J.value||0,V=Math.min(n.max,d+n.step),_=Math.round(V*Math.pow(10,n.precision))/Math.pow(10,n.precision);x("update:modelValue",_),x("change",_),I(_)},r=()=>{const d=J.value||0,V=Math.max(n.min,d-n.step),_=Math.round(V*Math.pow(10,n.precision))/Math.pow(10,n.precision);x("update:modelValue",_),x("change",_),I(_)};return ie(()=>n.modelValue,d=>{I(d)},{immediate:!0}),I(n.modelValue),(d,V)=>{const _=f("el-button"),A=f("el-button-group"),R=f("el-input");return s(),S(Y,null,[e(R,{ref_key:"inputRef",ref:L,modelValue:O.value,"onUpdate:modelValue":V[0]||(V[0]=te=>O.value=te),placeholder:o.placeholder,disabled:o.disabled,class:je({"is-invalid":C.value}),onInput:H,onBlur:K,onFocus:P},mt({_:2},[o.showControls?{name:"append",fn:t(()=>[e(A,null,{default:t(()=>[e(_,{icon:c(_t),disabled:o.disabled||q.value,onClick:r},null,8,["icon","disabled"]),e(_,{icon:c(vt),disabled:o.disabled||j.value,onClick:M},null,8,["icon","disabled"])]),_:1})]),key:"0"}:void 0]),1032,["modelValue","placeholder","disabled","class"]),C.value?(s(),S("div",Tt,w(z.value),1)):F("",!0)],64)}}},Lt=Ce(zt,[["__scopeId","data-v-f31d5553"]]),Ot={class:"card-header"},Pt={class:"card-header-left"},Ut={class:"card-header-actions"},Bt={class:"metrics-filter"},Xt={class:"metrics-stats"},Gt={class:"metrics-count"},qt={key:0,class:"metric-description"},jt={key:0,class:"metrics-info"},Jt={class:"info-row"},Ht={key:0,class:"info-row"},Kt={key:0,class:"loading-container"},Wt={key:1,class:"no-images"},Zt={key:2,class:"images-container"},Qt={class:"image-controls"},Yt={class:"image-slide"},ea=["src","alt"],ta={class:"image-info"},aa={class:"image-filename"},la={key:0,class:"image-page"},sa={__name:"MetricsEditor",props:{reportId:{type:String,required:!0},reportStatus:{type:String,default:null}},emits:["metrics-updated"],setup(o,{emit:$}){const n=o,x=$,L=y(!1),O=y(!1),B=y(!1),C=y(null),z=y(!1),J=y(0),q=y(0),j=y([]),I=y([]),k=y({metrics:{}}),H=y({}),K=y("metrics"),P=y([]),M=y(!1),r=y(1),d=y(!1),V=y(null),_=y(500),A=y(null),R=ee(()=>{if(!j.value||j.value.length===0)return[];if(z.value)return j.value;const b=new Set(I.value.filter(i=>{const h=parseFloat(String(i.value).replace(",","."));return!isNaN(h)&&h>0}).map(i=>i.metric_def_id));return j.value.filter(i=>{const h=b.has(i.id),G=k.value.metrics[i.id],X=G!=null&&G!==""&&parseFloat(String(G).replace(",","."))>0;return h||X})}),te=ee(()=>!I.value||I.value.length===0?[]:[...new Set(I.value.map(b=>b.source))]),U=ee(()=>{if(!I.value||I.value.length===0)return null;const b=I.value.map(i=>i.updated_at||i.created_at).filter(Boolean).map(i=>new Date(i));return b.length===0?null:new Date(Math.max(...b))}),ae=async()=>{L.value=!0,C.value=null;try{const b=await we.getMetricTemplate(n.reportId);J.value=b.filled_count||0,q.value=b.missing_count||0;const i=b.items||[];I.value=i.filter(h=>h.value!==null).map(h=>({metric_def_id:h.metric_def.id,value:h.value,source:h.source,confidence:h.confidence,notes:h.notes,updated_at:h.updated_at})),j.value=i.map(h=>({id:h.metric_def.id,code:h.metric_def.code,name:h.metric_def.name,name_ru:h.metric_def.name_ru,unit:h.metric_def.unit,min_value:h.metric_def.min_value,max_value:h.metric_def.max_value,description:h.metric_def.description})),k.value.metrics={},i.forEach(h=>{const G=h.metric_def.id;h.value!==null?k.value.metrics[G]=me(h.value):k.value.metrics[G]=null}),H.value=JSON.parse(JSON.stringify(k.value.metrics))}catch(b){console.error("Failed to load metrics:",b),C.value="Не удалось загрузить метрики"}finally{L.value=!1}},Q=async()=>{await ae(),T.success("Метрики обновлены")},_e=()=>{A.value||(A.value=setInterval(async()=>{await ae()},5e3))},de=()=>{A.value&&(clearInterval(A.value),A.value=null)},le=()=>{B.value=!0,z.value=!0,H.value=JSON.parse(JSON.stringify(k.value.metrics))},ue=()=>{k.value.metrics=JSON.parse(JSON.stringify(H.value)),B.value=!1,C.value=null},m=async()=>{O.value=!0,C.value=null;try{const b=[],i=[];for(const[X,Z]of Object.entries(k.value.metrics)){const ce=H.value[X],ve=ce!=null&&ce!=="";if(Z!=null&&Z!==""){const pe=Nt(Z);pe!==null&&b.push({metric_def_id:X,value:pe,source:"MANUAL",notes:null})}else ve&&i.push(X)}let h=0;for(const X of i)try{await we.clearExtractedMetric(n.reportId,X),h++}catch(Z){Z.response?.status!==404&&console.error("Failed to delete metric:",X,Z)}b.length>0&&await we.bulkCreateExtractedMetrics(n.reportId,b);const G=[];b.length>0&&G.push(`сохранено: ${b.length}`),h>0&&G.push(`сброшено: ${h}`),G.length===0?T.info("Нет изменений для сохранения"):T.success(`Метрики обновлены (${G.join(", ")})`),B.value=!1,await ae(),x("metrics-updated")}catch(b){console.error("Failed to save metrics:",b);let i="Не удалось сохранить метрики";b.response?.data?.detail&&(typeof b.response.data.detail=="string"?i=b.response.data.detail:Array.isArray(b.response.data.detail)&&(i=b.response.data.detail.map(h=>h.msg||h.message).join(", "))),C.value=i,T.error(i)}finally{O.value=!1}},oe=b=>{switch(b){case"OCR":return"info";case"LLM":return"warning";case"MANUAL":return"success";default:return""}},Re=b=>{switch(b){case"OCR":return"OCR";case"LLM":return"Gemini Vision";case"MANUAL":return"Ручной ввод";default:return b}},$e=It,Me=async()=>{M.value=!0,C.value=null;try{P.value=await ye.getReportImages(n.reportId)}catch(b){console.error("Failed to load report images:",b),C.value="Не удалось загрузить изображения отчёта",T.error("Не удалось загрузить изображения отчёта")}finally{M.value=!1}},Ve=()=>{r.value<2&&(r.value=Math.min(2,r.value+.25))},De=()=>{r.value>.5&&(r.value=Math.max(.5,r.value-.25))},Ie=()=>{r.value=1},Ee=()=>{d.value=!d.value,d.value?_.value=window.innerHeight-100:_.value=500};return Je(async()=>{}),at(()=>{de()}),ie(()=>n.reportId,async b=>{b&&(await ae(),P.value=[])}),ie(()=>n.reportStatus,async(b,i)=>{i||await ae(),b==="PROCESSING"?(_e(),i&&i!=="PROCESSING"&&await ae()):(de(),b==="EXTRACTED"&&i&&i!=="EXTRACTED"&&await ae())},{immediate:!0}),ie(K,async b=>{b==="images"&&P.value.length===0&&!M.value&&await Me()}),(b,i)=>{const h=f("el-icon"),G=f("el-tag"),X=f("el-button"),Z=f("el-alert"),ce=f("el-switch"),ve=f("el-form-item"),pe=f("el-col"),Ae=f("el-row"),a=f("el-form"),l=f("el-divider"),D=f("el-tab-pane"),E=f("el-empty"),re=f("el-button-group"),Fe=f("el-carousel-item"),fe=f("el-carousel"),Ne=f("el-tabs"),Se=f("el-card");return s(),g(Se,{class:"metrics-editor"},{header:t(()=>[u("div",Ot,[u("div",Pt,[i[5]||(i[5]=u("span",null,"Метрики отчёта",-1)),o.reportStatus==="PROCESSING"?(s(),g(G,{key:0,type:"warning",size:"small",class:"status-tag"},{default:t(()=>[e(h,{class:"is-loading"},{default:t(()=>[e(c(he))]),_:1}),i[3]||(i[3]=v(" Извлечение... ",-1))]),_:1})):o.reportStatus==="EXTRACTED"?(s(),g(G,{key:1,type:"success",size:"small",class:"status-tag"},{default:t(()=>[...i[4]||(i[4]=[v(" Извлечено ",-1)])]),_:1})):F("",!0)]),u("div",Ut,[B.value?F("",!0):(s(),g(X,{key:0,size:"small",loading:L.value,onClick:Q},{default:t(()=>[e(h,null,{default:t(()=>[e(c(st))]),_:1}),i[6]||(i[6]=v(" Обновить ",-1))]),_:1},8,["loading"])),B.value?(s(),S(Y,{key:2},[e(X,{size:"small",onClick:ue},{default:t(()=>[...i[8]||(i[8]=[v(" Отмена ",-1)])]),_:1}),e(X,{type:"primary",size:"small",loading:O.value,onClick:m},{default:t(()=>[...i[9]||(i[9]=[v(" Сохранить ",-1)])]),_:1},8,["loading"])],64)):(s(),g(X,{key:1,type:"primary",size:"small",onClick:le},{default:t(()=>[...i[7]||(i[7]=[v(" Редактировать ",-1)])]),_:1}))])])]),default:t(()=>[C.value?(s(),g(Z,{key:0,type:"error",title:C.value,closable:"",style:{"margin-bottom":"16px"},onClose:i[0]||(i[0]=N=>C.value=null)},null,8,["title"])):F("",!0),!I.value||I.value.length===0?(s(),g(Z,{key:1,type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:t(()=>[...i[10]||(i[10]=[v(" Метрики для этого отчёта ещё не извлечены. Вы можете ввести их вручную. ",-1)])]),_:1})):F("",!0),e(Ne,{modelValue:K.value,"onUpdate:modelValue":i[2]||(i[2]=N=>K.value=N),type:"card"},{default:t(()=>[e(D,{label:"Метрики",name:"metrics"},{default:t(()=>[u("div",Bt,[e(ce,{modelValue:z.value,"onUpdate:modelValue":i[1]||(i[1]=N=>z.value=N),"active-text":"Показать все метрики","inactive-text":"Только заполненные"},null,8,["modelValue"]),u("div",Xt,[e(G,{type:"success",size:"small"},{default:t(()=>[v(" Заполнено: "+w(J.value),1)]),_:1}),e(G,{type:"info",size:"small"},{default:t(()=>[v(" Не заполнено: "+w(q.value),1)]),_:1}),u("span",Gt," Показано: "+w(R.value.length)+" из "+w(j.value.length),1)])]),e(a,{ref:"formRef",model:k.value,"label-position":"top",disabled:!B.value},{default:t(()=>[e(Ae,{gutter:20},{default:t(()=>[(s(!0),S(Y,null,se(R.value,N=>(s(),g(pe,{key:N.id,xs:24,sm:12,md:8,lg:6},{default:t(()=>[e(ve,{label:c(Vt)(N),prop:`metrics.${N.id}`},{default:t(()=>[e(Lt,{modelValue:k.value.metrics[N.id],"onUpdate:modelValue":Te=>k.value.metrics[N.id]=Te,min:N.min_value||1,max:N.max_value||10,precision:1,step:.1,disabled:!B.value,"show-controls":!0,placeholder:"Введите значение (например: 7,5)"},null,8,["modelValue","onUpdate:modelValue","min","max","disabled"]),N.description?(s(),S("div",qt,w(N.description),1)):F("",!0)]),_:2},1032,["label","prop"])]),_:2},1024))),128))]),_:1})]),_:1},8,["model","disabled"]),I.value&&I.value.length>0?(s(),S("div",jt,[e(l),u("div",Jt,[i[11]||(i[11]=u("span",{class:"info-label"},"Источник данных:",-1)),(s(!0),S(Y,null,se(te.value,N=>(s(),g(G,{key:N,type:oe(N),size:"small",style:{"margin-left":"8px"}},{default:t(()=>[v(w(Re(N)),1)]),_:2},1032,["type"]))),128))]),U.value?(s(),S("div",Ht,[i[12]||(i[12]=u("span",{class:"info-label"},"Последнее обновление:",-1)),u("span",null,w(c($e)(U.value)),1)])):F("",!0)])):F("",!0)]),_:1}),e(D,{label:"Изображения отчёта",name:"images"},{default:t(()=>[M.value?(s(),S("div",Kt,[e(h,{class:"is-loading"},{default:t(()=>[e(c(he))]),_:1}),i[13]||(i[13]=u("span",{style:{"margin-left":"8px"}},"Загрузка изображений...",-1))])):P.value.length===0?(s(),S("div",Wt,[e(E,{description:"Изображения отсутствуют"},{image:t(()=>[e(h,{size:60,color:"var(--el-color-info)"},{default:t(()=>[e(c(yt))]),_:1})]),_:1})])):(s(),S("div",Zt,[u("div",Qt,[e(re,null,{default:t(()=>[e(X,{disabled:r.value<=.5,onClick:De},{default:t(()=>[e(h,null,{default:t(()=>[e(c(gt))]),_:1})]),_:1},8,["disabled"]),e(X,{onClick:Ie},{default:t(()=>[v(w(Math.round(r.value*100))+"% ",1)]),_:1}),e(X,{disabled:r.value>=2,onClick:Ve},{default:t(()=>[e(h,null,{default:t(()=>[e(c(wt))]),_:1})]),_:1},8,["disabled"])]),_:1}),e(X,{style:{"margin-left":"12px"},onClick:Ee},{default:t(()=>[e(h,null,{default:t(()=>[e(c(ht))]),_:1}),i[14]||(i[14]=v(" Полноэкранный режим ",-1))]),_:1})]),u("div",{ref_key:"carouselContainer",ref:V,class:je(["carousel-wrapper",{fullscreen:d.value}])},[e(fe,{height:_.value+"px",arrow:"always","indicator-position":"outside"},{default:t(()=>[(s(!0),S(Y,null,se(P.value,N=>(s(),g(Fe,{key:N.id},{default:t(()=>[u("div",Yt,[u("div",{class:"image-wrapper",style:lt({transform:`scale(${r.value})`})},[u("img",{src:N.data_url,alt:N.filename,class:"report-image"},null,8,ea)],4),u("div",ta,[u("span",aa,w(N.filename),1),N.page_number?(s(),S("span",la," Страница "+w(N.page_number),1)):F("",!0)])])]),_:2},1024))),128))]),_:1},8,["height"]),d.value?(s(),g(X,{key:0,class:"exit-fullscreen",circle:"",onClick:Ee},{default:t(()=>[e(h,null,{default:t(()=>[e(c(bt))]),_:1})]),_:1})):F("",!0)],2)]))]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},na=Ce(sa,[["__scopeId","data-v-8aeca2ab"]]),oa={class:"report-list"},ra={class:"report-list__controls"},ia={class:"controls-left"},ua={class:"controls-right"},ca={class:"filename"},da={class:"status-cell"},pa={key:1,class:"report-list__cards"},fa={class:"report-card__header"},ma={class:"report-card__status"},_a={class:"report-card__body"},va={class:"report-card__field"},ya={class:"field-value field-value--filename"},ga={class:"report-card__field"},wa={class:"field-value"},ha={class:"report-card__actions"},ba={__name:"ReportList",props:{reports:{type:Array,required:!0,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["view","edit","extract","download","delete","upload"],setup(o,{emit:$}){const n=o,x=$,L=nt(),O=ot(),{isMobile:B}=rt();Je(()=>{L.query.status&&(C.value=L.query.status),L.query.sort&&(z.value=L.query.sort)});const C=y(""),z=y("desc"),J=[{label:"Загружен",value:"UPLOADED"},{label:"Извлечение метрик...",value:"PROCESSING"},{label:"Метрики извлечены",value:"EXTRACTED"},{label:"Ошибка",value:"FAILED"}];ie([C,z],([M,r])=>{const d={...L.query};M?d.status=M:delete d.status,r?d.sort=r:delete d.sort,O.replace({query:d})});const q=()=>{},j=()=>{z.value=z.value==="desc"?"asc":"desc"},I=ee(()=>{let M=[...n.reports];return C.value&&(M=M.filter(r=>r.status===C.value)),M.sort((r,d)=>{const V=new Date(r.uploaded_at),_=new Date(d.uploaded_at);return z.value==="desc"?_-V:V-_}),M}),k=ee(()=>C.value?"Нет отчётов с выбранным статусом":"Нет загруженных отчётов"),H=M=>({UPLOADED:"Загружен",PROCESSING:"Извлечение метрик...",EXTRACTED:"Метрики извлечены",FAILED:"Ошибка"})[M]||M,K=M=>({UPLOADED:"info",PROCESSING:"warning",EXTRACTED:"success",FAILED:"danger"})[M]||"info",P=async({action:M,report:r})=>{switch(M){case"view":x("view",r.id);break;case"edit":x("edit",r.id);break;case"extract":x("extract",r.id);break;case"download":x("download",r.id);break;case"delete":try{await $t.confirm("Вы уверены, что хотите удалить этот отчёт?","Подтверждение удаления",{confirmButtonText:"Удалить",cancelButtonText:"Отмена",type:"warning"}),x("delete",r.id)}catch{}break}};return(M,r)=>{const d=f("el-option"),V=f("el-select"),_=f("el-icon"),A=f("el-button"),R=f("el-table-column"),te=f("el-tag"),U=f("el-dropdown-item"),ae=f("el-dropdown-menu"),Q=f("el-dropdown"),_e=f("el-table"),de=f("el-card"),le=f("el-empty"),ue=He("loading");return s(),S("div",oa,[u("div",ra,[u("div",ia,[e(V,{modelValue:C.value,"onUpdate:modelValue":r[0]||(r[0]=m=>C.value=m),placeholder:"Все статусы",clearable:"",style:{width:"200px"},onChange:q},{default:t(()=>[e(d,{label:"Все статусы",value:""}),(s(),S(Y,null,se(J,m=>e(d,{key:m.value,label:m.label,value:m.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),u("div",ua,[e(A,{type:z.value==="desc"?"primary":"default",size:"small",onClick:j},{default:t(()=>[e(_,null,{default:t(()=>[e(c(kt))]),_:1}),v(" "+w(z.value==="desc"?"Новые сверху":"Старые сверху"),1)]),_:1},8,["type"])])]),c(B)?be((s(),S("div",pa,[(s(!0),S(Y,null,se(I.value,m=>(s(),g(de,{key:m.id,class:"report-card",shadow:"hover"},{header:t(()=>[u("div",fa,[u("div",ma,[m.status==="PROCESSING"?(s(),g(_,{key:0,class:"status-icon status-icon--spinning"},{default:t(()=>[e(c(he))]),_:1})):m.status==="EXTRACTED"?(s(),g(_,{key:1,class:"status-icon status-icon--success"},{default:t(()=>[e(c(Ue))]),_:1})):m.status==="FAILED"?(s(),g(_,{key:2,class:"status-icon status-icon--error"},{default:t(()=>[e(c(Be))]),_:1})):(s(),g(_,{key:3,class:"status-icon status-icon--info"},{default:t(()=>[e(c(Xe))]),_:1})),e(te,{type:K(m.status),size:"small"},{default:t(()=>[v(w(H(m.status)),1)]),_:2},1032,["type"])])])]),footer:t(()=>[u("div",ha,[m.status==="EXTRACTED"?(s(),g(A,{key:0,type:"success",size:"small",onClick:oe=>P({action:"edit",report:m})},{default:t(()=>[e(_,null,{default:t(()=>[e(c(Ze))]),_:1}),r[10]||(r[10]=v(" Редактировать ",-1))]),_:1},8,["onClick"])):F("",!0),m.status==="PROCESSING"||m.status==="EXTRACTED"?(s(),g(A,{key:1,type:"info",size:"small",onClick:oe=>P({action:"view",report:m})},{default:t(()=>[e(_,null,{default:t(()=>[e(c(Qe))]),_:1}),r[11]||(r[11]=v(" Просмотр ",-1))]),_:1},8,["onClick"])):F("",!0),e(A,{type:"primary",size:"small",onClick:oe=>P({action:"extract",report:m})},{default:t(()=>[e(_,null,{default:t(()=>[e(c(Ye))]),_:1}),v(" "+w(m.status==="FAILED"?"Повторить":m.status==="PROCESSING"?"Перезапустить":m.status==="EXTRACTED"?"Переизвлечь":"Извлечь"),1)]),_:2},1032,["onClick"]),e(A,{size:"small",onClick:oe=>P({action:"download",report:m})},{default:t(()=>[e(_,null,{default:t(()=>[e(c(Ge))]),_:1}),r[12]||(r[12]=v(" Скачать ",-1))]),_:1},8,["onClick"]),e(A,{type:"danger",size:"small",onClick:oe=>P({action:"delete",report:m})},{default:t(()=>[e(_,null,{default:t(()=>[e(c(qe))]),_:1})]),_:1},8,["onClick"])])]),default:t(()=>[u("div",_a,[u("div",va,[r[8]||(r[8]=u("span",{class:"field-label"},"Файл:",-1)),u("span",ya,w(m.file_ref?.filename||"Без названия"),1)]),u("div",ga,[r[9]||(r[9]=u("span",{class:"field-label"},"Дата загрузки:",-1)),u("span",wa,w(c(ke)(m.uploaded_at)),1)])])]),_:2},1024))),128)),!I.value.length&&!o.loading?(s(),g(le,{key:0,description:k.value,"image-size":120},{default:t(()=>[C.value?F("",!0):(s(),g(A,{key:0,type:"primary",onClick:r[1]||(r[1]=m=>M.$emit("upload"))},{default:t(()=>[...r[13]||(r[13]=[v(" Загрузить отчёт ",-1)])]),_:1}))]),_:1},8,["description"])):F("",!0)])),[[ue,o.loading]]):be((s(),g(_e,{key:0,data:I.value,class:"report-list__table",stripe:"","empty-text":k.value},{default:t(()=>[e(R,{prop:"file_ref.filename",label:"Название файла","min-width":"200"},{default:t(({row:m})=>[u("span",ca,w(m.file_ref?.filename||"Без названия"),1)]),_:1}),e(R,{prop:"status",label:"Статус",width:"200"},{default:t(({row:m})=>[u("div",da,[m.status==="PROCESSING"?(s(),g(_,{key:0,class:"status-icon status-icon--spinning"},{default:t(()=>[e(c(he))]),_:1})):m.status==="EXTRACTED"?(s(),g(_,{key:1,class:"status-icon status-icon--success"},{default:t(()=>[e(c(Ue))]),_:1})):m.status==="FAILED"?(s(),g(_,{key:2,class:"status-icon status-icon--error"},{default:t(()=>[e(c(Be))]),_:1})):(s(),g(_,{key:3,class:"status-icon status-icon--info"},{default:t(()=>[e(c(Xe))]),_:1})),e(te,{type:K(m.status),size:"default"},{default:t(()=>[v(w(H(m.status)),1)]),_:2},1032,["type"])])]),_:1}),e(R,{prop:"uploaded_at",label:"Дата загрузки",width:"180",sortable:""},{default:t(({row:m})=>[v(w(c(ke)(m.uploaded_at)),1)]),_:1}),e(R,{label:"Действия",width:"200",fixed:"right",align:"right"},{default:t(({row:m})=>[e(Q,{trigger:"click",onCommand:P},{dropdown:t(()=>[e(ae,null,{default:t(()=>[m.status==="EXTRACTED"?(s(),g(U,{key:0,command:{action:"edit",report:m}},{default:t(()=>[e(_,null,{default:t(()=>[e(c(Ze))]),_:1}),r[4]||(r[4]=v(" Редактировать метрики ",-1))]),_:1},8,["command"])):F("",!0),m.status==="PROCESSING"||m.status==="EXTRACTED"?(s(),g(U,{key:1,command:{action:"view",report:m}},{default:t(()=>[e(_,null,{default:t(()=>[e(c(Qe))]),_:1}),r[5]||(r[5]=v(" Просмотр метрик ",-1))]),_:1},8,["command"])):F("",!0),e(U,{command:{action:"extract",report:m}},{default:t(()=>[e(_,null,{default:t(()=>[e(c(Ye))]),_:1}),v(" "+w(m.status==="FAILED"?"Повторить извлечение":m.status==="PROCESSING"?"Перезапустить извлечение":m.status==="EXTRACTED"?"Переизвлечь метрики":"Извлечь метрики"),1)]),_:2},1032,["command"]),e(U,{divided:"",command:{action:"download",report:m}},{default:t(()=>[e(_,null,{default:t(()=>[e(c(Ge))]),_:1}),r[6]||(r[6]=v(" Скачать ",-1))]),_:1},8,["command"]),e(U,{command:{action:"delete",report:m},class:"dropdown-item--danger"},{default:t(()=>[e(_,null,{default:t(()=>[e(c(qe))]),_:1}),r[7]||(r[7]=v(" Удалить ",-1))]),_:1},8,["command"])]),_:2},1024)]),default:t(()=>[e(A,{type:"primary",size:"small"},{default:t(()=>[r[3]||(r[3]=v(" Действия ",-1)),e(_,{class:"el-icon--right"},{default:t(()=>[e(c(Ct))]),_:1})]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data","empty-text"])),[[ue,o.loading]]),!I.value.length&&!o.loading&&!c(B)?(s(),g(le,{key:2,description:k.value,"image-size":120},{default:t(()=>[C.value?F("",!0):(s(),g(A,{key:0,type:"primary",onClick:r[2]||(r[2]=m=>M.$emit("upload"))},{default:t(()=>[...r[14]||(r[14]=[v(" Загрузить отчёт ",-1)])]),_:1}))]),_:1},8,["description"])):F("",!0)])}}},ka=Ce(ba,[["__scopeId","data-v-49005412"]]),Ca={class:"metrics-drawer"},$a={class:"drawer-actions"},Ea={key:1},Sa={key:1},xa={__name:"ParticipantMetricsDrawer",props:{modelValue:{type:Boolean,required:!0},participantId:{type:String,required:!0},participantName:{type:String,required:!0}},emits:["update:modelValue"],setup(o,{emit:$}){const n=o,x=$,L=y(!1),O=y([]),B=y([]),C=ee(()=>"Метрики ещё не извлечены. Загрузите и обработайте отчёты."),z=k=>{x("update:modelValue",k)},J=async()=>{try{const k=await we.listMetricDefs(!0);B.value=k.items||[]}catch(k){console.error("Error loading metric definitions:",k)}},q=async()=>{L.value=!0;try{const k=await it.getMetrics(n.participantId);O.value=k.metrics||[]}catch(k){console.error("Error loading participant metrics:",k),T.error("Ошибка загрузки метрик участника")}finally{L.value=!1}},j=k=>{if(!k)return"—";const H=B.value.find(P=>P.code===k);return Dt(H,k,{warn:()=>{}})},I=k=>k>=.8?"var(--el-color-success)":k>=.6?"var(--el-color-warning)":"var(--el-color-danger)";return ie(()=>n.participantId,async k=>{k&&n.modelValue&&(await J(),await q())}),ie(()=>n.modelValue,async k=>{k&&n.participantId&&(await J(),await q())}),(k,H)=>{const K=f("el-icon"),P=f("el-button"),M=f("el-table-column"),r=f("el-tag"),d=f("el-table"),V=f("el-empty"),_=f("el-drawer"),A=He("loading");return s(),g(_,{"model-value":o.modelValue,title:`Метрики участника: ${o.participantName}`,size:"70%",direction:"rtl","onUpdate:modelValue":z},{default:t(()=>[be((s(),S("div",Ca,[u("div",$a,[e(P,{type:"primary",size:"small",onClick:q},{default:t(()=>[e(K,null,{default:t(()=>[e(c(st))]),_:1}),H[0]||(H[0]=v(" Обновить ",-1))]),_:1})]),e(d,{data:O.value,stripe:"","empty-text":C.value},{default:t(()=>[e(M,{prop:"metric_code",label:"Код метрики",width:"200"}),e(M,{label:"Название метрики","min-width":"250"},{default:t(({row:R})=>[v(w(j(R.metric_code)),1)]),_:1}),e(M,{prop:"value",label:"Значение",width:"120"},{default:t(({row:R})=>[e(r,{type:"success"},{default:t(()=>[v(w(c(ge)(R.value)),1)]),_:2},1024)]),_:1}),e(M,{prop:"confidence",label:"Уверенность",width:"150"},{default:t(({row:R})=>[R.confidence!==null?(s(),S("span",{key:0,style:lt({color:I(R.confidence)})},w((R.confidence*100).toFixed(0))+"% ",5)):(s(),S("span",Ea,"—"))]),_:1}),e(M,{prop:"updated_at",label:"Обновлено",width:"180"},{default:t(({row:R})=>[v(w(c(ke)(R.updated_at)),1)]),_:1}),e(M,{prop:"last_source_report_id",label:"Источник"},{default:t(({row:R})=>[R.last_source_report_id?(s(),g(r,{key:0,size:"small"},{default:t(()=>[...H[1]||(H[1]=[v(" Из отчёта ",-1)])]),_:1})):(s(),S("span",Sa,"—"))]),_:1})]),_:1},8,["data","empty-text"]),!O.value.length&&!L.value?(s(),g(V,{key:0,description:C.value},null,8,["description"])):F("",!0)])),[[A,L.value]])]),_:1},8,["model-value","title"])}}},Ra=Ce(xa,[["__scopeId","data-v-1043d8e9"]]),Ma={class:"participant-detail"},Va={class:"card-header"},Da={class:"header-actions"},Ia={class:"section-header"},Aa={class:"scoring-result"},Fa={class:"score-value"},Na={class:"score-number"},Ta={class:"score-details"},za={class:"score-section"},La={key:0},Oa={class:"score-section"},Pa={key:0},Ua={key:0,class:"final-report-actions"},Ba={key:0,class:"batch-files-list"},Xa={class:"batch-files-header"},Ga={class:"batch-file-info"},qa={class:"batch-file-name"},ja={class:"batch-file-size"},Ja={key:0,class:"batch-file-error"},Ha={class:"activity-code-hint"},tt=20*1024*1024,Pe=10,Ka={__name:"ParticipantDetailView",setup(o){const $=ot(),n=nt(),x=Ft(),L=y(!1),O=y(!1),{isMobile:B}=rt(),C=y(!1),z=y(!1),J=y(!1),q=ee(()=>x.currentParticipant),j=y([]),I=y([]),k=y([]),H=y([]),K=y(null),P=y(null),M=ee(()=>j.value.some(a=>a.status==="PROCESSING")),r=ee(()=>K.value&&j.value.find(l=>l.id===K.value)?.status||null),d=y(!1),V=y(!1),_=y(!1),A=y(!1),R=y(null),te=y([]),U=y([]);let ae=0;const Q=Et({activityCode:""}),_e=a=>a>=80?"success":a>=60?"":"warning",de=async()=>{L.value=!0;try{await x.getParticipant(n.params.id)}catch{T.error("Участник не найден"),$.push("/participants")}finally{L.value=!1}},le=async({silent:a=!1}={})=>{a||(O.value=!0);try{const l=await it.getReports(n.params.id);j.value=l.items||[]}catch(l){console.error("Error loading reports:",l),T.error("Ошибка загрузки списка отчётов")}finally{a||(O.value=!1)}},ue=a=>{if(!a)return a;const l=Array.isArray(a.recommendations)?a.recommendations:[];let D=a.recommendations_status||a.recommendationsStatus||null;D||(D=l.length>0?"ready":"pending");const E=Number(a.score_pct),re=Number.isNaN(E)?a.score_pct:E;return{...a,score_pct:re,recommendations:l,recommendations_status:D,recommendations_error:a.recommendations_error||a.recommendationsError||null}},m=async()=>{try{const a=await Oe.getHistory(n.params.id),l=Array.isArray(a.items)?a.items:[];I.value=l.map(ue)}catch(a){console.error("Error loading scoring results:",a)}},oe=async()=>{C.value=!0;try{const a=await At.list();k.value=a||[]}catch{T.error("Ошибка загрузки профессиональных областей")}finally{C.value=!1}},Re=async()=>{try{const a=await we.listMetricDefs(!0);H.value=a.items||[]}catch(a){console.error("Error loading metric definitions:",a)}},$e=a=>a<1024?a+" B":a<1024*1024?(a/1024).toFixed(1)+" KB":(a/(1024*1024)).toFixed(1)+" MB",Me=a=>a.name.toLowerCase().endsWith(".docx")?a.size>tt?`Размер файла превышает ${$e(tt)}`:null:"Только файлы формата .docx",Ve=(a,l)=>{const D=a.raw;if(U.value.length>=Pe){T.warning(`Максимальное количество файлов: ${Pe}`),R.value&&R.value.clearFiles();return}const E=Me(D);if(E){T.error(E),R.value&&R.value.clearFiles();return}U.value.push({id:++ae,file:D,name:D.name,size:D.size,status:"pending",progress:0,error:null,reportId:null}),R.value&&R.value.clearFiles()},De=a=>{U.value=U.value.filter(l=>l.id!==a)},Ie=async a=>{a.status="uploading",a.progress=0;try{const l=await ye.upload(n.params.id,a.file);a.status="success",a.reportId=l.id}catch(l){a.status="error",a.error=l.response?.data?.detail||"Ошибка загрузки"}},Ee=async()=>{const a=U.value.filter(l=>l.status==="pending");if(a.length===0){T.warning("Нет файлов для загрузки");return}z.value=!0;try{await Promise.allSettled(a.map(E=>Ie(E)));const l=U.value.filter(E=>E.status==="success").length,D=U.value.filter(E=>E.status==="error").length;D===0?(T.success(`Загружено ${l} отчётов`),d.value=!1,b()):T.warning(`Загружено: ${l}, ошибок: ${D}`),await le()}finally{z.value=!1}},b=()=>{U.value=[],te.value=[],R.value&&R.value.clearFiles()},i=async a=>{try{const l=await ye.download(a),D=window.URL.createObjectURL(new Blob([l.data])),E=document.createElement("a");E.href=D,E.setAttribute("download",`report_${a}.docx`),document.body.appendChild(E),E.click(),E.remove(),window.URL.revokeObjectURL(D),T.success("Отчёт скачан")}catch{T.error("Ошибка скачивания отчёта")}},h=async a=>{try{await ye.extract(a),T.success("Извлечение метрик запущено"),await le()}catch{T.error("Ошибка запуска извлечения метрик")}},G=()=>{P.value||(P.value=setInterval(async()=>{try{await le({silent:!0})}catch(a){console.error("Auto-refresh error:",a)}},3e3))},X=()=>{P.value&&(clearInterval(P.value),P.value=null)};ie(M,a=>{a?G():X()});const Z=async a=>{K.value=a,await Rt(),_.value=!0},ce=async()=>{T.success("Метрики обновлены"),await le({silent:!0})},ve=async a=>{try{await ye.delete(a),T.success("Отчёт удалён"),await le()}catch{T.error("Ошибка удаления отчёта")}},pe=async()=>{if(!Q.activityCode){T.warning("Выберите профессиональную область");return}J.value=!0;try{const a=await Oe.calculate(n.params.id,Q.activityCode),l=ue({id:a.scoring_result_id,participant_id:n.params.id,prof_activity_code:a.prof_activity_code||Q.activityCode,prof_activity_name:a.prof_activity_name,score_pct:parseFloat(a.score_pct),strengths:a.strengths||[],dev_areas:a.dev_areas||[],recommendations:a.recommendations||[],recommendations_status:a.recommendations_status||((a.recommendations||[]).length>0?"ready":"pending"),recommendations_error:a.recommendations_error||null,created_at:new Date().toISOString()});I.value.unshift(l),T.success("Расчёт пригодности выполнен"),V.value=!1,Q.activityCode=""}catch(a){console.error("Scoring calculation error:",a);const l=a.response?.data?.detail||"Ошибка расчёта пригодности";T.error(l)}finally{J.value=!1}},Ae=async a=>{if(!a.prof_activity_code){T.warning("Код профессиональной деятельности не найден");return}try{const l=await Oe.downloadFinalReportPdf(n.params.id,a.prof_activity_code,a.id),D=window.URL.createObjectURL(new Blob([l.data])),E=document.createElement("a");E.href=D,E.setAttribute("download",`final_report_${a.prof_activity_code}_${new Date().toISOString().split("T")[0]}.pdf`),document.body.appendChild(E),E.click(),E.remove(),window.URL.revokeObjectURL(D),T.success("Отчёт PDF скачан")}catch(l){const D=l.response?.data?.detail||"Ошибка загрузки PDF отчёта";T.error(D)}};return Je(async()=>{await de(),await le(),await m(),await oe(),await Re()}),at(()=>{X()}),(a,l)=>{const D=f("el-button"),E=f("el-icon"),re=f("el-descriptions-item"),Fe=f("el-descriptions"),fe=f("el-card"),Ne=f("el-progress"),Se=f("el-empty"),N=f("el-timeline-item"),Te=f("el-timeline"),ut=f("el-upload"),ze=f("el-dialog"),ct=f("el-option"),dt=f("el-select"),pt=f("el-form-item"),Ke=f("el-alert"),ft=f("el-form"),We=He("loading");return s(),g(Mt,null,{default:t(()=>[be((s(),S("div",Ma,[q.value?(s(),g(fe,{key:0,class:"detail-card"},{header:t(()=>[u("div",Va,[u("h2",null,w(q.value.full_name),1),u("div",Da,[e(D,{onClick:l[0]||(l[0]=p=>c($).back())},{default:t(()=>[...l[12]||(l[12]=[v(" Назад ",-1)])]),_:1}),e(D,{type:"info",onClick:l[1]||(l[1]=p=>A.value=!0)},{default:t(()=>[e(E,null,{default:t(()=>[e(c(St))]),_:1}),l[13]||(l[13]=v(" Метрики ",-1))]),_:1}),e(D,{type:"primary",onClick:l[2]||(l[2]=p=>V.value=!0)},{default:t(()=>[e(E,null,{default:t(()=>[e(c(xt))]),_:1}),l[14]||(l[14]=v(" Рассчитать пригодность ",-1))]),_:1})])])]),default:t(()=>[e(Fe,{column:c(B)?1:2,border:""},{default:t(()=>[e(re,{label:"ФИО"},{default:t(()=>[v(w(q.value.full_name),1)]),_:1}),e(re,{label:"Дата рождения"},{default:t(()=>[v(w(q.value.birth_date||"Не указана"),1)]),_:1}),e(re,{label:"Внешний ID"},{default:t(()=>[v(w(q.value.external_id||"Не указан"),1)]),_:1}),e(re,{label:"Дата создания"},{default:t(()=>[v(w(c(ke)(q.value.created_at)),1)]),_:1})]),_:1},8,["column"])]),_:1})):F("",!0),e(fe,{class:"section-card"},{header:t(()=>[u("div",Ia,[l[16]||(l[16]=u("h3",null,"Отчёты",-1)),e(D,{type:"primary",onClick:l[3]||(l[3]=p=>d.value=!0)},{default:t(()=>[e(E,null,{default:t(()=>[e(c(et))]),_:1}),l[15]||(l[15]=v(" Загрузить отчёт ",-1))]),_:1})])]),default:t(()=>[e(ka,{reports:j.value,loading:O.value,onView:Z,onEdit:Z,onExtract:h,onDownload:i,onDelete:ve,onUpload:l[4]||(l[4]=p=>d.value=!0)},null,8,["reports","loading"])]),_:1}),I.value.length>0?(s(),g(fe,{key:1,class:"section-card"},{header:t(()=>[...l[17]||(l[17]=[u("h3",null,"История оценок пригодности",-1)])]),default:t(()=>[e(Te,null,{default:t(()=>[(s(!0),S(Y,null,se(I.value,p=>(s(),g(N,{key:p.id,timestamp:c(ke)(p.created_at),placement:"top"},{default:t(()=>[e(fe,null,{default:t(()=>[u("h4",null,w(p.prof_activity_name),1),u("div",Aa,[u("div",Fa,[u("span",Na,w(p.score_pct)+"%",1),e(Ne,{percentage:p.score_pct,status:_e(p.score_pct)},null,8,["percentage","status"])]),u("div",Ta,[u("div",za,[l[18]||(l[18]=u("h5",null,"Сильные стороны:",-1)),p.strengths&&p.strengths.length?(s(),S("ul",La,[(s(!0),S(Y,null,se(p.strengths,(ne,Le)=>(s(),S("li",{key:Le},[u("strong",null,w(ne.metric_name),1),v(" — "+w(c(ge)(ne.value))+" (вес "+w(c(ge)(ne.weight,2))+") ",1)]))),128))])):(s(),g(Se,{key:1,description:"Нет данных","image-size":60}))]),u("div",Oa,[l[19]||(l[19]=u("h5",null,"Зоны развития:",-1)),p.dev_areas&&p.dev_areas.length?(s(),S("ul",Pa,[(s(!0),S(Y,null,se(p.dev_areas,(ne,Le)=>(s(),S("li",{key:Le},[u("strong",null,w(ne.metric_name),1),v(" — "+w(c(ge)(ne.value))+" (вес "+w(c(ge)(ne.weight,2))+") ",1)]))),128))])):(s(),g(Se,{key:1,description:"Нет данных","image-size":60}))])]),p.prof_activity_code?(s(),S("div",Ua,[e(D,{type:"primary",size:"small",onClick:ne=>Ae(p)},{default:t(()=>[e(E,null,{default:t(()=>[e(c(Ge))]),_:1}),l[20]||(l[20]=v(" Скачать PDF ",-1))]),_:1},8,["onClick"])])):F("",!0)])]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})]),_:1})):F("",!0),e(ze,{modelValue:d.value,"onUpdate:modelValue":l[6]||(l[6]=p=>d.value=p),title:"Загрузить отчёты",width:c(B)?"95%":"600px",onClose:b},{footer:t(()=>[e(D,{onClick:l[5]||(l[5]=p=>d.value=!1)},{default:t(()=>[...l[23]||(l[23]=[v(" Отмена ",-1)])]),_:1}),e(D,{type:"primary",loading:z.value,disabled:!U.value.some(p=>p.status==="pending"),onClick:Ee},{default:t(()=>[v(" Загрузить все ("+w(U.value.filter(p=>p.status==="pending").length)+") ",1)]),_:1},8,["loading","disabled"])]),default:t(()=>[e(ut,{ref_key:"uploadRef",ref:R,"auto-upload":!1,multiple:"",accept:".docx","on-change":Ve,"show-file-list":!1,drag:""},{tip:t(()=>[...l[21]||(l[21]=[u("div",{class:"el-upload__tip"}," Только .docx файлы, макс. 20 МБ, до 10 файлов ",-1)])]),default:t(()=>[e(E,{class:"el-icon--upload"},{default:t(()=>[e(c(et))]),_:1}),l[22]||(l[22]=u("div",{class:"el-upload__text"},[v(" Перетащите файлы сюда или "),u("em",null,"нажмите для выбора")],-1))]),_:1},512),U.value.length?(s(),S("div",Ba,[u("div",Xa," Выбрано файлов: "+w(U.value.length)+"/"+w(Pe),1),(s(!0),S(Y,null,se(U.value,p=>(s(),S("div",{key:p.id,class:je(["batch-file-item","batch-file-item--"+p.status])},[p.status==="pending"?(s(),g(E,{key:0,class:"batch-file-icon"},{default:t(()=>[e(c(Xe))]),_:1})):p.status==="uploading"?(s(),g(E,{key:1,class:"batch-file-icon is-loading"},{default:t(()=>[e(c(he))]),_:1})):p.status==="success"?(s(),g(E,{key:2,class:"batch-file-icon batch-file-icon--success"},{default:t(()=>[e(c(Ue))]),_:1})):p.status==="error"?(s(),g(E,{key:3,class:"batch-file-icon batch-file-icon--error"},{default:t(()=>[e(c(Be))]),_:1})):F("",!0),u("div",Ga,[u("span",qa,w(p.name),1),u("span",ja,w($e(p.size)),1),p.error?(s(),S("span",Ja,w(p.error),1)):F("",!0)]),p.status==="pending"||p.status==="error"?(s(),g(D,{key:4,type:"danger",icon:c(qe),circle:"",size:"small",onClick:ne=>De(p.id)},null,8,["icon","onClick"])):F("",!0)],2))),128))])):F("",!0)]),_:1},8,["modelValue","width"]),e(ze,{modelValue:V.value,"onUpdate:modelValue":l[9]||(l[9]=p=>V.value=p),title:"Рассчитать профессиональную пригодность",width:c(B)?"95%":"500px"},{footer:t(()=>[e(D,{onClick:l[8]||(l[8]=p=>V.value=!1)},{default:t(()=>[...l[24]||(l[24]=[v(" Отмена ",-1)])]),_:1}),e(D,{type:"primary",loading:J.value,disabled:!Q.activityCode||j.value.length===0,onClick:pe},{default:t(()=>[...l[25]||(l[25]=[v(" Рассчитать ",-1)])]),_:1},8,["loading","disabled"])]),default:t(()=>[e(ft,{model:Q,"label-position":"top"},{default:t(()=>[e(pt,{label:"Профессиональная область",required:""},{default:t(()=>[be((s(),g(dt,{modelValue:Q.activityCode,"onUpdate:modelValue":l[7]||(l[7]=p=>Q.activityCode=p),placeholder:"Выберите область",style:{width:"100%"}},{default:t(()=>[(s(!0),S(Y,null,se(k.value,p=>(s(),g(ct,{key:p.code,label:p.name,value:p.code},{default:t(()=>[u("span",null,w(p.name),1),u("span",Ha,w(p.code),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])),[[We,C.value]])]),_:1}),e(Ke,{title:"Убедитесь, что у участника загружены и обработаны отчёты с метриками",type:"info",closable:!1,"show-icon":""}),j.value.length===0?(s(),g(Ke,{key:0,title:"У участника нет загруженных отчётов",type:"warning",closable:!1,"show-icon":"",style:{"margin-top":"12px"}})):F("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","width"]),e(ze,{modelValue:_.value,"onUpdate:modelValue":l[10]||(l[10]=p=>_.value=p),title:"Метрики отчёта",width:"90%",top:"5vh"},{default:t(()=>[K.value?(s(),g(na,{key:0,"report-id":K.value,"report-status":r.value,onMetricsUpdated:ce},null,8,["report-id","report-status"])):F("",!0)]),_:1},8,["modelValue"]),e(Ra,{modelValue:A.value,"onUpdate:modelValue":l[11]||(l[11]=p=>A.value=p),"participant-id":q.value?.id,"participant-name":q.value?.full_name},null,8,["modelValue","participant-id","participant-name"])])),[[We,L.value]])]),_:1})}}},al=Ce(Ka,[["__scopeId","data-v-2f0e8358"]]);export{al as default};
