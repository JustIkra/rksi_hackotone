import{O as Q,P as ut,m as h,Q as K,D as ct,p as ne,r as d,c as N,o,d as t,x as O,R as dt,w as e,u as m,S as pt,K as ft,z as Xe,B as C,F as ee,H as Fe,T as qe,v as y,f as _,a as p,C as ae,U as he,V as Ge,E as L,q as je,e as Je,I as Ne,J as fe,W as mt,k as Re,X as Me,g as Ve,Y as _t,Z as Pe,_ as Le,h as Oe,$ as Ie,a0 as Ae,N as vt,L as yt,n as gt,a1 as wt,t as ht,a2 as Ue,G as bt}from"./index-BBTXwqdy.js";import{A as kt}from"./AppLayout-BJyjYLgC.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{m as ge,f as Ct,g as $t}from"./metricNames-aRpK301c.js";import{f as St,a as me,p as Et}from"./dateFormat-D1akWrUl.js";import{a as He,p as Ke,u as xt}from"./useResponsive-BZktQSiV.js";const ye={async upload(a,b){const r=new FormData;return r.append("file",b),(await Q.post(`/participants/${a}/reports`,r,{headers:{"Content-Type":"multipart/form-data"}})).data},async download(a){return await Q.get(`/reports/${a}/download`,{responseType:"blob"})},async getById(a){return(await Q.get(`/reports/${a}`)).data},async delete(a){return(await Q.delete(`/reports/${a}`)).data},async extract(a){return(await Q.post(`/reports/${a}/extract`)).data},async getMetrics(a){return(await Q.get(`/reports/${a}/metrics`)).data},async getList(a){return(await Q.get(`/participants/${a}/reports`)).data}},xe={async calculate(a,b){return(await Q.post(`/scoring/participants/${a}/calculate`,null,{params:{activity_code:b}})).data},async getHistory(a,b=10){return(await Q.get(`/scoring/participants/${a}/scores`,{params:{limit:b}})).data},async getById(a){return(await Q.get(`/scoring-results/${a}`)).data},async generateRecommendations(a){return(await Q.post(`/reports/${a}/recommendations`)).data},async getFinalReport(a,b,r="json"){const g={params:{activity_code:b,format:r}};r==="html"&&(g.responseType="text");const F=await Q.get(`/participants/${a}/final-report`,g);return F.data},async downloadFinalReportPdf(a,b,r=null){const g={activity_code:b,format:"pdf"};return r&&(g.scoring_result_id=r),await Q.get(`/participants/${a}/final-report`,{params:g,responseType:"blob"})}},We=ut("metrics",()=>{const a=h([]),b=h(!1),r=h(null),g=h(null),F=300*1e3,$=K(()=>g.value?Date.now()-g.value>F:!0),z=K(()=>a.value.length>0);async function x({force:v=!1,activeOnly:I=!1}={}){if(!v&&z.value&&!$.value)return a.value;if(b.value)return new Promise(R=>{const M=setInterval(()=>{b.value||(clearInterval(M),R(a.value))},50)});b.value=!0,r.value=null;try{const R=await ge.listMetricDefs(I);return a.value=R,g.value=Date.now(),R}catch(R){const M=ct(R,"Ошибка загрузки метрик");throw r.value=M.message,R.normalizedError=M,R}finally{b.value=!1}}function V(v){return a.value.find(I=>I.id===v)}function G(v){const I=V(v);return I?.name_ru||I?.name||v}function H(){g.value=null}function D(v){const I=a.value.findIndex(R=>R.id===v.id);I!==-1&&(a.value[I]=v)}function S(v){a.value=a.value.filter(I=>I.id!==v)}function P(v){a.value.push(v)}return{metricDefs:a,loading:b,error:r,isStale:$,hasData:z,fetchMetricDefs:x,getMetricDefById:V,getMetricName:G,invalidateCache:H,updateInCache:D,removeFromCache:S,addToCache:P}});function we(a,b=1){if(a==null||a==="")return"";const r=typeof a=="string"?parseFloat(a):a;return isNaN(r)?"":r.toLocaleString("ru-RU",{minimumFractionDigits:b,maximumFractionDigits:b})}function ie(a){if(a==null||a==="")return null;const r=String(a).trim().replace(",","."),g=parseFloat(r);return isNaN(g)?null:g}function Dt(a){return ie(a)}function Ze(a,b=1){return we(a,b)}const Rt={key:0,class:"error-message"},Mt={__name:"MetricInput",props:{modelValue:{type:[Number,String],default:null},min:{type:Number,default:1},max:{type:Number,default:10},step:{type:Number,default:.1},precision:{type:Number,default:1},placeholder:{type:String,default:"Введите значение"},disabled:{type:Boolean,default:!1},showControls:{type:Boolean,default:!0}},emits:["update:modelValue","change","blur"],setup(a,{emit:b}){const r=a,g=b,F=h(null),$=h(""),z=h(!1),x=h(!1),V=h(""),G=K(()=>ie($.value)),H=K(()=>{const c=G.value;return c===null||c<=r.min}),D=K(()=>{const c=G.value;return c===null||c>=r.max}),S=c=>{if(c==null||c===""){$.value="";return}z.value?$.value=String(c).replace(".",","):$.value=we(c,r.precision)},P=c=>{if(c==null||c==="")return x.value=!1,V.value="",!0;const E=ie(c);return E===null?(x.value=!0,V.value="Некорректное число",!1):E<r.min?(x.value=!0,V.value=`Значение должно быть не меньше ${we(r.min,r.precision)}`,!1):E>r.max?(x.value=!0,V.value=`Значение должно быть не больше ${we(r.max,r.precision)}`,!1):(x.value=!1,V.value="",!0)},v=c=>{const E=c.replace(/[^\d,.-]/g,"");let f=!1;const U=E.split("").filter(X=>X===","||X==="."?f?!1:(f=!0,!0):!0).join("").replace(".",",");$.value=U;const B=ie(U);B!==null?g("update:modelValue",B):(U===""||U==="-")&&g("update:modelValue",null)},I=()=>{z.value=!1;const c=ie($.value);if(P($.value)){if(c!==null){const E=Math.round(c*Math.pow(10,r.precision))/Math.pow(10,r.precision),f=Math.max(r.min,Math.min(r.max,E));g("update:modelValue",f),S(f),g("change",f)}}else if(c!==null&&(c<r.min||c>r.max)){const E=Math.max(r.min,Math.min(r.max,c));g("update:modelValue",E),S(E),g("change",E),x.value=!1,V.value=""}g("blur")},R=()=>{z.value=!0,G.value!==null&&($.value=String(G.value).replace(".",","))},M=()=>{const c=G.value||0,E=Math.min(r.max,c+r.step),f=Math.round(E*Math.pow(10,r.precision))/Math.pow(10,r.precision);g("update:modelValue",f),g("change",f),S(f)},u=()=>{const c=G.value||0,E=Math.max(r.min,c-r.step),f=Math.round(E*Math.pow(10,r.precision))/Math.pow(10,r.precision);g("update:modelValue",f),g("change",f),S(f)};return ne(()=>r.modelValue,c=>{S(c)},{immediate:!0}),S(r.modelValue),(c,E)=>{const f=d("el-button"),U=d("el-button-group"),B=d("el-input");return o(),N(ee,null,[t(B,{ref_key:"inputRef",ref:F,modelValue:$.value,"onUpdate:modelValue":E[0]||(E[0]=X=>$.value=X),placeholder:a.placeholder,disabled:a.disabled,class:Xe({"is-invalid":x.value}),onInput:v,onBlur:I,onFocus:R},dt({_:2},[a.showControls?{name:"append",fn:e(()=>[t(U,null,{default:e(()=>[t(f,{icon:m(pt),disabled:a.disabled||H.value,onClick:u},null,8,["icon","disabled"]),t(f,{icon:m(ft),disabled:a.disabled||D.value,onClick:M},null,8,["icon","disabled"])]),_:1})]),key:"0"}:void 0]),1032,["modelValue","placeholder","disabled","class"]),x.value?(o(),N("div",Rt,C(V.value),1)):O("",!0)],64)}}},Vt=ue(Mt,[["__scopeId","data-v-f31d5553"]]),It={class:"card-header"},At={class:"card-header-left"},Ft={class:"card-header-actions"},Nt={class:"metrics-filter"},Tt={class:"metrics-stats"},zt={class:"metrics-count"},Pt={key:0,class:"metric-description"},Lt={key:0,class:"metrics-info"},Ot={class:"info-row"},Ut={key:0,class:"info-row"},Bt={__name:"MetricsEditor",props:{reportId:{type:String,required:!0},reportStatus:{type:String,default:null}},emits:["metrics-updated"],setup(a,{emit:b}){const r=a,g=b,F=h(!1),$=h(!1),z=h(!1),x=h(null),V=h(!1),G=h(0),H=h(0),D=h([]),S=h([]),P=h({metrics:{}}),v=h({}),I=h("metrics"),R=h(null),M=K(()=>{if(!D.value||D.value.length===0)return[];if(V.value)return D.value;const k=new Set(S.value.filter(i=>{const l=parseFloat(String(i.value).replace(",","."));return!isNaN(l)&&l>0}).map(i=>i.metric_def_id));return D.value.filter(i=>{const l=k.has(i.id),q=P.value.metrics[i.id],W=q!=null&&q!==""&&parseFloat(String(q).replace(",","."))>0;return l||W})}),u=K(()=>!S.value||S.value.length===0?[]:[...new Set(S.value.map(k=>k.source))]),c=K(()=>{if(!S.value||S.value.length===0)return null;const k=S.value.map(i=>i.updated_at||i.created_at).filter(Boolean).map(i=>new Date(i));return k.length===0?null:new Date(Math.max(...k))}),E=async()=>{F.value=!0,x.value=null;try{const k=await ge.getMetricTemplate(r.reportId);G.value=k.filled_count||0,H.value=k.missing_count||0;const i=k.items||[];S.value=i.filter(l=>l.value!==null).map(l=>({metric_def_id:l.metric_def.id,value:l.value,source:l.source,confidence:l.confidence,notes:l.notes,updated_at:l.updated_at})),D.value=i.map(l=>({id:l.metric_def.id,code:l.metric_def.code,name:l.metric_def.name,name_ru:l.metric_def.name_ru,unit:l.metric_def.unit,min_value:l.metric_def.min_value,max_value:l.metric_def.max_value,description:l.metric_def.description})),P.value.metrics={},i.forEach(l=>{const q=l.metric_def.id;l.value!==null?P.value.metrics[q]=ie(l.value):P.value.metrics[q]=null}),v.value=JSON.parse(JSON.stringify(P.value.metrics))}catch(k){console.error("Failed to load metrics:",k),x.value="Не удалось загрузить метрики"}finally{F.value=!1}},f=async()=>{await E(),L.success("Метрики обновлены")},U=()=>{R.value||(R.value=setInterval(async()=>{await E()},5e3))},B=()=>{R.value&&(clearInterval(R.value),R.value=null)},X=()=>{z.value=!0,V.value=!0,v.value=JSON.parse(JSON.stringify(P.value.metrics))},j=()=>{P.value.metrics=JSON.parse(JSON.stringify(v.value)),z.value=!1,x.value=null},ce=async()=>{$.value=!0,x.value=null;try{const k=[],i=[];for(const[Z,le]of Object.entries(P.value.metrics)){const se=v.value[Z],pe=se!=null&&se!=="";if(le!=null&&le!==""){const oe=Dt(le);oe!==null&&k.push({metric_def_id:Z,value:oe,source:"MANUAL",notes:null})}else pe&&i.push(Z)}const q=(await Promise.allSettled(i.map(Z=>ge.clearExtractedMetric(r.reportId,Z)))).filter(Z=>Z.status==="fulfilled"||Z.status==="rejected"&&Z.reason?.response?.status===404).length;k.length>0&&await ge.bulkCreateExtractedMetrics(r.reportId,k);const W=[];k.length>0&&W.push(`сохранено: ${k.length}`),q>0&&W.push(`сброшено: ${q}`),W.length===0?L.info("Нет изменений для сохранения"):L.success(`Метрики обновлены (${W.join(", ")})`),z.value=!1,await E(),g("metrics-updated")}catch(k){console.error("Failed to save metrics:",k);let i="Не удалось сохранить метрики";k.response?.data?.detail&&(typeof k.response.data.detail=="string"?i=k.response.data.detail:Array.isArray(k.response.data.detail)&&(i=k.response.data.detail.map(l=>l.msg||l.message).join(", "))),x.value=i,L.error(i)}finally{$.value=!1}},Y=k=>{switch(k){case"OCR":return"info";case"LLM":return"warning";case"MANUAL":return"success";default:return""}},de=k=>{switch(k){case"OCR":return"OCR";case"LLM":return"Gemini Vision";case"MANUAL":return"Ручной ввод";default:return k}},te=St;return Fe(async()=>{}),qe(()=>{B()}),ne(()=>r.reportId,async k=>{k&&await E()}),ne(()=>r.reportStatus,async(k,i)=>{i||await E(),k==="PROCESSING"?(U(),i&&i!=="PROCESSING"&&await E()):(B(),k==="EXTRACTED"&&i&&i!=="EXTRACTED"&&await E())},{immediate:!0}),(k,i)=>{const l=d("el-icon"),q=d("el-tag"),W=d("el-button"),Z=d("el-alert"),le=d("el-switch"),se=d("el-form-item"),pe=d("el-col"),oe=d("el-row"),_e=d("el-form"),be=d("el-divider"),ke=d("el-tab-pane"),Ce=d("el-tabs"),ve=d("el-card");return o(),y(ve,{class:"metrics-editor"},{header:e(()=>[p("div",It,[p("div",At,[i[5]||(i[5]=p("span",null,"Метрики отчёта",-1)),a.reportStatus==="PROCESSING"?(o(),y(q,{key:0,type:"warning",size:"small",class:"status-tag"},{default:e(()=>[t(l,{class:"is-loading"},{default:e(()=>[t(m(he))]),_:1}),i[3]||(i[3]=_(" Извлечение... ",-1))]),_:1})):a.reportStatus==="EXTRACTED"?(o(),y(q,{key:1,type:"success",size:"small",class:"status-tag"},{default:e(()=>[...i[4]||(i[4]=[_(" Извлечено ",-1)])]),_:1})):O("",!0)]),p("div",Ft,[z.value?O("",!0):(o(),y(W,{key:0,size:"small",loading:F.value,onClick:f},{default:e(()=>[t(l,null,{default:e(()=>[t(m(Ge))]),_:1}),i[6]||(i[6]=_(" Обновить ",-1))]),_:1},8,["loading"])),z.value?(o(),N(ee,{key:2},[t(W,{size:"small",onClick:j},{default:e(()=>[...i[8]||(i[8]=[_(" Отмена ",-1)])]),_:1}),t(W,{type:"primary",size:"small",loading:$.value,onClick:ce},{default:e(()=>[...i[9]||(i[9]=[_(" Сохранить ",-1)])]),_:1},8,["loading"])],64)):(o(),y(W,{key:1,type:"primary",size:"small",onClick:X},{default:e(()=>[...i[7]||(i[7]=[_(" Редактировать ",-1)])]),_:1}))])])]),default:e(()=>[x.value?(o(),y(Z,{key:0,type:"error",title:x.value,closable:"",style:{"margin-bottom":"16px"},onClose:i[0]||(i[0]=J=>x.value=null)},null,8,["title"])):O("",!0),!S.value||S.value.length===0?(o(),y(Z,{key:1,type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:e(()=>[...i[10]||(i[10]=[_(" Метрики для этого отчёта ещё не извлечены. Вы можете ввести их вручную. ",-1)])]),_:1})):O("",!0),t(Ce,{modelValue:I.value,"onUpdate:modelValue":i[2]||(i[2]=J=>I.value=J),type:"card"},{default:e(()=>[t(ke,{label:"Метрики",name:"metrics"},{default:e(()=>[p("div",Nt,[t(le,{modelValue:V.value,"onUpdate:modelValue":i[1]||(i[1]=J=>V.value=J),"active-text":"Показать все метрики","inactive-text":"Только заполненные"},null,8,["modelValue"]),p("div",Tt,[t(q,{type:"success",size:"small"},{default:e(()=>[_(" Заполнено: "+C(G.value),1)]),_:1}),t(q,{type:"info",size:"small"},{default:e(()=>[_(" Не заполнено: "+C(H.value),1)]),_:1}),p("span",zt," Показано: "+C(M.value.length)+" из "+C(D.value.length),1)])]),t(_e,{ref:"formRef",model:P.value,"label-position":"top",disabled:!z.value},{default:e(()=>[t(oe,{gutter:20},{default:e(()=>[(o(!0),N(ee,null,ae(M.value,J=>(o(),y(pe,{key:J.id,xs:24,sm:12,md:8,lg:6},{default:e(()=>[t(se,{label:m(Ct)(J),prop:`metrics.${J.id}`},{default:e(()=>[t(Vt,{modelValue:P.value.metrics[J.id],"onUpdate:modelValue":$e=>P.value.metrics[J.id]=$e,min:J.min_value||1,max:J.max_value||10,precision:1,step:.1,disabled:!z.value,"show-controls":!0,placeholder:"Введите значение (например: 7,5)"},null,8,["modelValue","onUpdate:modelValue","min","max","disabled"]),J.description?(o(),N("div",Pt,C(J.description),1)):O("",!0)]),_:2},1032,["label","prop"])]),_:2},1024))),128))]),_:1})]),_:1},8,["model","disabled"]),S.value&&S.value.length>0?(o(),N("div",Lt,[t(be),p("div",Ot,[i[11]||(i[11]=p("span",{class:"info-label"},"Источник данных:",-1)),(o(!0),N(ee,null,ae(u.value,J=>(o(),y(q,{key:J,type:Y(J),size:"small",style:{"margin-left":"8px"}},{default:e(()=>[_(C(de(J)),1)]),_:2},1032,["type"]))),128))]),c.value?(o(),N("div",Ut,[i[12]||(i[12]=p("span",{class:"info-label"},"Последнее обновление:",-1)),p("span",null,C(m(te)(c.value)),1)])):O("",!0)])):O("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},Xt=ue(Bt,[["__scopeId","data-v-77ac0db7"]]),qt={class:"report-list"},Gt={class:"report-list__controls"},jt={class:"controls-left"},Jt={class:"controls-right"},Ht={class:"filename"},Kt={class:"status-cell"},Wt={key:1,class:"report-list__cards"},Zt={class:"report-card__header"},Qt={class:"report-card__status"},Yt={class:"report-card__body"},ea={class:"report-card__field"},ta={class:"field-value field-value--filename"},aa={class:"report-card__field"},la={class:"field-value"},sa={class:"report-card__actions"},na={__name:"ReportList",props:{reports:{type:Array,required:!0,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["view","edit","extract","download","delete","upload"],setup(a,{emit:b}){const r=a,g=b,F=je(),$=Je(),{isMobile:z}=He();Fe(()=>{F.query.status&&(x.value=F.query.status),F.query.sort&&(V.value=F.query.sort)});const x=h(""),V=h("desc"),G=[{label:"Загружен",value:"UPLOADED"},{label:"Извлечение метрик...",value:"PROCESSING"},{label:"Метрики извлечены",value:"EXTRACTED"},{label:"Ошибка",value:"FAILED"}];ne([x,V],([M,u])=>{const c={...F.query};M?c.status=M:delete c.status,u?c.sort=u:delete c.sort,$.replace({query:c})});const H=()=>{},D=()=>{V.value=V.value==="desc"?"asc":"desc"},S=K(()=>{let M=[...r.reports];return x.value&&(M=M.filter(u=>u.status===x.value)),M.sort((u,c)=>{const E=new Date(u.uploaded_at),f=new Date(c.uploaded_at);return V.value==="desc"?f-E:E-f}),M}),P=K(()=>x.value?"Нет отчётов с выбранным статусом":"Нет загруженных отчётов"),v=M=>({UPLOADED:"Загружен",PROCESSING:"Извлечение метрик...",EXTRACTED:"Метрики извлечены",FAILED:"Ошибка"})[M]||M,I=M=>({UPLOADED:"info",PROCESSING:"warning",EXTRACTED:"success",FAILED:"danger"})[M]||"info",R=async({action:M,report:u})=>{switch(M){case"view":g("view",u.id);break;case"edit":g("edit",u.id);break;case"extract":g("extract",u.id);break;case"download":g("download",u.id);break;case"delete":try{await vt.confirm("Вы уверены, что хотите удалить этот отчёт?","Подтверждение удаления",{confirmButtonText:"Удалить",cancelButtonText:"Отмена",type:"warning"}),g("delete",u.id)}catch{}break}};return(M,u)=>{const c=d("el-option"),E=d("el-select"),f=d("el-icon"),U=d("el-button"),B=d("el-table-column"),X=d("el-tag"),j=d("el-dropdown-item"),ce=d("el-dropdown-menu"),Y=d("el-dropdown"),de=d("el-table"),te=d("el-card"),k=d("el-empty"),i=Ne("loading");return o(),N("div",qt,[p("div",Gt,[p("div",jt,[t(E,{modelValue:x.value,"onUpdate:modelValue":u[0]||(u[0]=l=>x.value=l),placeholder:"Все статусы",clearable:"",style:{width:"200px"},onChange:H},{default:e(()=>[t(c,{label:"Все статусы",value:""}),(o(),N(ee,null,ae(G,l=>t(c,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),p("div",Jt,[t(U,{type:V.value==="desc"?"primary":"default",size:"small",onClick:D},{default:e(()=>[t(f,null,{default:e(()=>[t(m(mt))]),_:1}),_(" "+C(V.value==="desc"?"Новые сверху":"Старые сверху"),1)]),_:1},8,["type"])])]),m(z)?fe((o(),N("div",Wt,[(o(!0),N(ee,null,ae(S.value,l=>(o(),y(te,{key:l.id,class:"report-card",shadow:"hover"},{header:e(()=>[p("div",Zt,[p("div",Qt,[l.status==="PROCESSING"?(o(),y(f,{key:0,class:"status-icon status-icon--spinning"},{default:e(()=>[t(m(he))]),_:1})):l.status==="EXTRACTED"?(o(),y(f,{key:1,class:"status-icon status-icon--success"},{default:e(()=>[t(m(Re))]),_:1})):l.status==="FAILED"?(o(),y(f,{key:2,class:"status-icon status-icon--error"},{default:e(()=>[t(m(Me))]),_:1})):(o(),y(f,{key:3,class:"status-icon status-icon--info"},{default:e(()=>[t(m(Ve))]),_:1})),t(X,{type:I(l.status),size:"small"},{default:e(()=>[_(C(v(l.status)),1)]),_:2},1032,["type"])])])]),footer:e(()=>[p("div",sa,[l.status==="EXTRACTED"?(o(),y(U,{key:0,type:"success",size:"small",onClick:q=>R({action:"edit",report:l})},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Pe))]),_:1}),u[10]||(u[10]=_(" Редактировать ",-1))]),_:1},8,["onClick"])):O("",!0),l.status==="PROCESSING"||l.status==="EXTRACTED"?(o(),y(U,{key:1,type:"info",size:"small",onClick:q=>R({action:"view",report:l})},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Le))]),_:1}),u[11]||(u[11]=_(" Просмотр ",-1))]),_:1},8,["onClick"])):O("",!0),t(U,{type:"primary",size:"small",onClick:q=>R({action:"extract",report:l})},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Oe))]),_:1}),_(" "+C(l.status==="FAILED"?"Повторить":l.status==="PROCESSING"?"Перезапустить":l.status==="EXTRACTED"?"Переизвлечь":"Извлечь"),1)]),_:2},1032,["onClick"]),t(U,{size:"small",onClick:q=>R({action:"download",report:l})},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Ie))]),_:1}),u[12]||(u[12]=_(" Скачать ",-1))]),_:1},8,["onClick"]),t(U,{type:"danger",size:"small",onClick:q=>R({action:"delete",report:l})},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Ae))]),_:1})]),_:1},8,["onClick"])])]),default:e(()=>[p("div",Yt,[p("div",ea,[u[8]||(u[8]=p("span",{class:"field-label"},"Файл:",-1)),p("span",ta,C(l.file_ref?.filename||"Без названия"),1)]),p("div",aa,[u[9]||(u[9]=p("span",{class:"field-label"},"Дата загрузки:",-1)),p("span",la,C(m(me)(l.uploaded_at)),1)])])]),_:2},1024))),128)),!S.value.length&&!a.loading?(o(),y(k,{key:0,description:P.value,"image-size":120},{default:e(()=>[x.value?O("",!0):(o(),y(U,{key:0,type:"primary",onClick:u[1]||(u[1]=l=>M.$emit("upload"))},{default:e(()=>[...u[13]||(u[13]=[_(" Загрузить отчёт ",-1)])]),_:1}))]),_:1},8,["description"])):O("",!0)])),[[i,a.loading]]):fe((o(),y(de,{key:0,data:S.value,class:"report-list__table",stripe:"","empty-text":P.value},{default:e(()=>[t(B,{prop:"file_ref.filename",label:"Название файла","min-width":"200"},{default:e(({row:l})=>[p("span",Ht,C(l.file_ref?.filename||"Без названия"),1)]),_:1}),t(B,{prop:"status",label:"Статус",width:"200"},{default:e(({row:l})=>[p("div",Kt,[l.status==="PROCESSING"?(o(),y(f,{key:0,class:"status-icon status-icon--spinning"},{default:e(()=>[t(m(he))]),_:1})):l.status==="EXTRACTED"?(o(),y(f,{key:1,class:"status-icon status-icon--success"},{default:e(()=>[t(m(Re))]),_:1})):l.status==="FAILED"?(o(),y(f,{key:2,class:"status-icon status-icon--error"},{default:e(()=>[t(m(Me))]),_:1})):(o(),y(f,{key:3,class:"status-icon status-icon--info"},{default:e(()=>[t(m(Ve))]),_:1})),t(X,{type:I(l.status),size:"default"},{default:e(()=>[_(C(v(l.status)),1)]),_:2},1032,["type"])])]),_:1}),t(B,{prop:"uploaded_at",label:"Дата загрузки",width:"180",sortable:""},{default:e(({row:l})=>[_(C(m(me)(l.uploaded_at)),1)]),_:1}),t(B,{label:"Действия",width:"200",fixed:"right",align:"right"},{default:e(({row:l})=>[t(Y,{trigger:"click",onCommand:R},{dropdown:e(()=>[t(ce,null,{default:e(()=>[l.status==="EXTRACTED"?(o(),y(j,{key:0,command:{action:"edit",report:l}},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Pe))]),_:1}),u[4]||(u[4]=_(" Редактировать метрики ",-1))]),_:1},8,["command"])):O("",!0),l.status==="PROCESSING"||l.status==="EXTRACTED"?(o(),y(j,{key:1,command:{action:"view",report:l}},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Le))]),_:1}),u[5]||(u[5]=_(" Просмотр метрик ",-1))]),_:1},8,["command"])):O("",!0),t(j,{command:{action:"extract",report:l}},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Oe))]),_:1}),_(" "+C(l.status==="FAILED"?"Повторить извлечение":l.status==="PROCESSING"?"Перезапустить извлечение":l.status==="EXTRACTED"?"Переизвлечь метрики":"Извлечь метрики"),1)]),_:2},1032,["command"]),t(j,{divided:"",command:{action:"download",report:l}},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Ie))]),_:1}),u[6]||(u[6]=_(" Скачать ",-1))]),_:1},8,["command"]),t(j,{command:{action:"delete",report:l},class:"dropdown-item--danger"},{default:e(()=>[t(f,null,{default:e(()=>[t(m(Ae))]),_:1}),u[7]||(u[7]=_(" Удалить ",-1))]),_:1},8,["command"])]),_:2},1024)]),default:e(()=>[t(U,{type:"primary",size:"small"},{default:e(()=>[u[3]||(u[3]=_(" Действия ",-1)),t(f,{class:"el-icon--right"},{default:e(()=>[t(m(_t))]),_:1})]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data","empty-text"])),[[i,a.loading]]),!S.value.length&&!a.loading&&!m(z)?(o(),y(k,{key:2,description:P.value,"image-size":120},{default:e(()=>[x.value?O("",!0):(o(),y(U,{key:0,type:"primary",onClick:u[2]||(u[2]=l=>M.$emit("upload"))},{default:e(()=>[...u[14]||(u[14]=[_(" Загрузить отчёт ",-1)])]),_:1}))]),_:1},8,["description"])):O("",!0)])}}},oa=ue(na,[["__scopeId","data-v-49005412"]]),ra={class:"metrics-drawer"},ia={class:"drawer-actions"},ua={key:1},ca={key:1},da={__name:"ParticipantMetricsDrawer",props:{modelValue:{type:Boolean,required:!0},participantId:{type:String,required:!0},participantName:{type:String,required:!0}},emits:["update:modelValue"],setup(a,{emit:b}){const r=a,g=b,F=We(),$=h(!1),z=h([]),x=K(()=>F.metricDefs),V=K(()=>"Метрики ещё не извлечены. Загрузите и обработайте отчёты."),G=v=>{g("update:modelValue",v)},H=async()=>{try{await F.fetchMetricDefs({activeOnly:!0})}catch(v){console.error("Error loading metric definitions:",v)}},D=async()=>{$.value=!0;try{const v=await Ke.getMetrics(r.participantId);z.value=v.metrics||[]}catch(v){console.error("Error loading participant metrics:",v),L.error("Ошибка загрузки метрик участника")}finally{$.value=!1}},S=v=>{if(!v)return"—";const I=x.value?.find(M=>M.code===v);return $t(I,v,{warn:()=>{}})},P=v=>v>=.8?"var(--el-color-success)":v>=.6?"var(--el-color-warning)":"var(--el-color-danger)";return ne(()=>r.participantId,async v=>{v&&r.modelValue&&(await H(),await D())}),ne(()=>r.modelValue,async v=>{v&&r.participantId&&(await H(),await D())}),(v,I)=>{const R=d("el-icon"),M=d("el-button"),u=d("el-table-column"),c=d("el-tag"),E=d("el-table"),f=d("el-empty"),U=d("el-drawer"),B=Ne("loading");return o(),y(U,{"model-value":a.modelValue,title:`Метрики участника: ${a.participantName}`,size:"70%",direction:"rtl","onUpdate:modelValue":G},{default:e(()=>[fe((o(),N("div",ra,[p("div",ia,[t(M,{type:"primary",size:"small",onClick:D},{default:e(()=>[t(R,null,{default:e(()=>[t(m(Ge))]),_:1}),I[0]||(I[0]=_(" Обновить ",-1))]),_:1})]),t(E,{data:z.value,stripe:"","empty-text":V.value},{default:e(()=>[t(u,{prop:"metric_code",label:"Код метрики",width:"200"}),t(u,{label:"Название метрики","min-width":"250"},{default:e(({row:X})=>[_(C(S(X.metric_code)),1)]),_:1}),t(u,{prop:"value",label:"Значение",width:"120"},{default:e(({row:X})=>[t(c,{type:"success"},{default:e(()=>[_(C(m(Ze)(X.value)),1)]),_:2},1024)]),_:1}),t(u,{prop:"confidence",label:"Уверенность",width:"150"},{default:e(({row:X})=>[X.confidence!==null?(o(),N("span",{key:0,style:yt({color:P(X.confidence)})},C((X.confidence*100).toFixed(0))+"% ",5)):(o(),N("span",ua,"—"))]),_:1}),t(u,{prop:"updated_at",label:"Обновлено",width:"180"},{default:e(({row:X})=>[_(C(m(me)(X.updated_at)),1)]),_:1}),t(u,{prop:"last_source_report_id",label:"Источник"},{default:e(({row:X})=>[X.last_source_report_id?(o(),y(c,{key:0,size:"small"},{default:e(()=>[...I[1]||(I[1]=[_(" Из отчёта ",-1)])]),_:1})):(o(),N("span",ca,"—"))]),_:1})]),_:1},8,["data","empty-text"]),!z.value.length&&!$.value?(o(),y(f,{key:0,description:V.value},null,8,["description"])):O("",!0)])),[[B,$.value]])]),_:1},8,["model-value","title"])}}},pa=ue(da,[["__scopeId","data-v-ce564aa7"]]),fa={class:"scoring-result"},ma={class:"score-value"},_a={class:"score-number"},va={class:"score-details"},ya={class:"score-section"},ga={key:0},wa={class:"score-section"},ha={key:0},ba={key:0,class:"final-report-actions"},ka={__name:"ScoringResultCard",props:{result:{type:Object,required:!0}},emits:["download-pdf"],setup(a){const b=a,r=K(()=>{const F=b.result.score_pct;return F>=70?"success":F>=40?"warning":"exception"}),g=(F,$=1)=>Ze(F,$);return(F,$)=>{const z=d("el-progress"),x=d("el-empty"),V=d("el-icon"),G=d("el-button"),H=d("el-card");return o(),y(H,{class:"scoring-card"},{default:e(()=>[p("h4",null,C(a.result.prof_activity_name),1),p("div",fa,[p("div",ma,[p("span",_a,C(a.result.score_pct)+"%",1),t(z,{percentage:a.result.score_pct,status:r.value},null,8,["percentage","status"])]),p("div",va,[p("div",ya,[$[1]||($[1]=p("h5",null,"Сильные стороны:",-1)),a.result.strengths&&a.result.strengths.length?(o(),N("ul",ga,[(o(!0),N(ee,null,ae(a.result.strengths,(D,S)=>(o(),N("li",{key:S},[p("strong",null,C(D.metric_name),1),_(" — "+C(g(D.value))+" (вес "+C(g(D.weight,2))+") ",1)]))),128))])):(o(),y(x,{key:1,description:"Нет данных","image-size":60}))]),p("div",wa,[$[2]||($[2]=p("h5",null,"Зоны развития:",-1)),a.result.dev_areas&&a.result.dev_areas.length?(o(),N("ul",ha,[(o(!0),N(ee,null,ae(a.result.dev_areas,(D,S)=>(o(),N("li",{key:S},[p("strong",null,C(D.metric_name),1),_(" — "+C(g(D.value))+" (вес "+C(g(D.weight,2))+") ",1)]))),128))])):(o(),y(x,{key:1,description:"Нет данных","image-size":60}))])]),a.result.prof_activity_code?(o(),N("div",ba,[t(G,{type:"primary",size:"small",onClick:$[0]||($[0]=D=>F.$emit("download-pdf",a.result))},{default:e(()=>[t(V,null,{default:e(()=>[t(m(Ie))]),_:1}),$[3]||($[3]=_(" Скачать PDF ",-1))]),_:1})])):O("",!0)])]),_:1})}}},Ca=ue(ka,[["__scopeId","data-v-d4c54e9d"]]),$a={class:"participant-detail"},Sa={class:"card-header"},Ea={class:"header-actions"},xa={class:"section-header"},Da={key:0,class:"batch-files-list"},Ra={class:"batch-files-header"},Ma={class:"batch-file-info"},Va={class:"batch-file-name"},Ia={class:"batch-file-size"},Aa={key:0,class:"batch-file-error"},Fa={class:"activity-code-hint"},Be=20*1024*1024,De=10,Na={__name:"ParticipantDetailView",setup(a){const b=Je(),r=je(),g=xt(),F=We(),$=h(!1),z=h(!1),{isMobile:x}=He(),V=h(!1),G=h(!1),H=h(!1),D=K(()=>g.currentParticipant),S=h([]),P=h([]),v=h([]),I=h(null);K(()=>F.metricDefs);const R=h(null),M=K(()=>S.value.some(s=>s.status==="PROCESSING")),u=K(()=>I.value&&S.value.find(n=>n.id===I.value)?.status||null),c=h(!1),E=h(!1),f=h(!1),U=h(!1),B=h(null),X=h([]),j=h([]);let ce=0;const Y=gt({activityCode:""}),de=async()=>{$.value=!0;try{await g.getParticipant(r.params.id)}catch{L.error("Участник не найден"),b.push("/participants")}finally{$.value=!1}},te=async({silent:s=!1}={})=>{s||(z.value=!0);try{const n=await Ke.getReports(r.params.id);S.value=n.items||[]}catch(n){console.error("Error loading reports:",n),L.error("Ошибка загрузки списка отчётов")}finally{s||(z.value=!1)}},k=s=>{if(!s)return s;const n=Array.isArray(s.recommendations)?s.recommendations:[];let T=s.recommendations_status||s.recommendationsStatus||null;T||(T=n.length>0?"ready":"pending");const A=Number(s.score_pct),re=Number.isNaN(A)?s.score_pct:A;return{...s,score_pct:re,recommendations:n,recommendations_status:T,recommendations_error:s.recommendations_error||s.recommendationsError||null}},i=async()=>{try{const s=await xe.getHistory(r.params.id),n=Array.isArray(s.items)?s.items:[];P.value=n.map(k)}catch(s){console.error("Error loading scoring results:",s)}},l=async()=>{V.value=!0;try{const s=await Et.list();v.value=s||[]}catch{L.error("Ошибка загрузки профессиональных областей")}finally{V.value=!1}},q=async()=>{try{await F.fetchMetricDefs({activeOnly:!0})}catch(s){console.error("Error loading metric definitions:",s)}},W=s=>s<1024?s+" B":s<1024*1024?(s/1024).toFixed(1)+" KB":(s/(1024*1024)).toFixed(1)+" MB",Z=s=>s.name.toLowerCase().endsWith(".docx")?s.size>Be?`Размер файла превышает ${W(Be)}`:null:"Только файлы формата .docx",le=(s,n)=>{const T=s.raw;if(j.value.length>=De){L.warning(`Максимальное количество файлов: ${De}`),B.value&&B.value.clearFiles();return}const A=Z(T);if(A){L.error(A),B.value&&B.value.clearFiles();return}j.value.push({id:++ce,file:T,name:T.name,size:T.size,status:"pending",progress:0,error:null,reportId:null}),B.value&&B.value.clearFiles()},se=s=>{j.value=j.value.filter(n=>n.id!==s)},pe=async s=>{s.status="uploading",s.progress=0;try{const n=await ye.upload(r.params.id,s.file);s.status="success",s.reportId=n.id}catch(n){s.status="error",s.error=n.response?.data?.detail||"Ошибка загрузки"}},oe=async()=>{const s=j.value.filter(n=>n.status==="pending");if(s.length===0){L.warning("Нет файлов для загрузки");return}G.value=!0;try{await Promise.allSettled(s.map(A=>pe(A)));const n=j.value.filter(A=>A.status==="success").length,T=j.value.filter(A=>A.status==="error").length;T===0?(L.success(`Загружено ${n} отчётов`),c.value=!1,_e()):L.warning(`Загружено: ${n}, ошибок: ${T}`),await te()}finally{G.value=!1}},_e=()=>{j.value=[],X.value=[],B.value&&B.value.clearFiles()},be=async s=>{try{const n=await ye.download(s),T=window.URL.createObjectURL(new Blob([n.data])),A=document.createElement("a");A.href=T,A.setAttribute("download",`report_${s}.docx`),document.body.appendChild(A),A.click(),A.remove(),window.URL.revokeObjectURL(T),L.success("Отчёт скачан")}catch{L.error("Ошибка скачивания отчёта")}},ke=async s=>{try{await ye.extract(s),L.success("Извлечение метрик запущено"),await te()}catch{L.error("Ошибка запуска извлечения метрик")}},Ce=()=>{R.value||(R.value=setInterval(async()=>{try{await te({silent:!0})}catch(s){console.error("Auto-refresh error:",s)}},3e3))},ve=()=>{R.value&&(clearInterval(R.value),R.value=null)};ne(M,s=>{s?Ce():ve()});const J=async s=>{I.value=s,await bt(),f.value=!0},$e=async()=>{L.success("Метрики обновлены"),await te({silent:!0})},Qe=async s=>{try{await ye.delete(s),L.success("Отчёт удалён"),await te()}catch{L.error("Ошибка удаления отчёта")}},Ye=async()=>{if(!Y.activityCode){L.warning("Выберите профессиональную область");return}H.value=!0;try{const s=await xe.calculate(r.params.id,Y.activityCode),n=k({id:s.scoring_result_id,participant_id:r.params.id,prof_activity_code:s.prof_activity_code||Y.activityCode,prof_activity_name:s.prof_activity_name,score_pct:parseFloat(s.score_pct),strengths:s.strengths||[],dev_areas:s.dev_areas||[],recommendations:s.recommendations||[],recommendations_status:s.recommendations_status||((s.recommendations||[]).length>0?"ready":"pending"),recommendations_error:s.recommendations_error||null,created_at:new Date().toISOString()});P.value.unshift(n),L.success("Расчёт пригодности выполнен"),E.value=!1,Y.activityCode=""}catch(s){console.error("Scoring calculation error:",s);const n=s.response?.data?.detail||"Ошибка расчёта пригодности";L.error(n)}finally{H.value=!1}},et=async s=>{if(!s.prof_activity_code){L.warning("Код профессиональной деятельности не найден");return}try{const n=await xe.downloadFinalReportPdf(r.params.id,s.prof_activity_code,s.id),T=window.URL.createObjectURL(new Blob([n.data])),A=document.createElement("a");A.href=T,A.setAttribute("download",`final_report_${s.prof_activity_code}_${new Date().toISOString().split("T")[0]}.pdf`),document.body.appendChild(A),A.click(),A.remove(),window.URL.revokeObjectURL(T),L.success("Отчёт PDF скачан")}catch(n){const T=n.response?.data?.detail||"Ошибка загрузки PDF отчёта";L.error(T)}};return Fe(async()=>{await Promise.all([de(),te(),i(),l(),q()])}),qe(()=>{ve()}),(s,n)=>{const T=d("el-button"),A=d("el-icon"),re=d("el-descriptions-item"),tt=d("el-descriptions"),Se=d("el-card"),at=d("el-timeline-item"),lt=d("el-timeline"),st=d("el-upload"),Ee=d("el-dialog"),nt=d("el-option"),ot=d("el-select"),rt=d("el-form-item"),Te=d("el-alert"),it=d("el-form"),ze=Ne("loading");return o(),y(kt,null,{default:e(()=>[fe((o(),N("div",$a,[D.value?(o(),y(Se,{key:0,class:"detail-card"},{header:e(()=>[p("div",Sa,[p("h2",null,C(D.value.full_name),1),p("div",Ea,[t(T,{onClick:n[0]||(n[0]=w=>m(b).back())},{default:e(()=>[...n[12]||(n[12]=[_(" Назад ",-1)])]),_:1}),t(T,{type:"info",onClick:n[1]||(n[1]=w=>U.value=!0)},{default:e(()=>[t(A,null,{default:e(()=>[t(m(wt))]),_:1}),n[13]||(n[13]=_(" Метрики ",-1))]),_:1}),t(T,{type:"primary",onClick:n[2]||(n[2]=w=>E.value=!0)},{default:e(()=>[t(A,null,{default:e(()=>[t(m(ht))]),_:1}),n[14]||(n[14]=_(" Рассчитать пригодность ",-1))]),_:1})])])]),default:e(()=>[t(tt,{column:m(x)?1:2,border:""},{default:e(()=>[t(re,{label:"ФИО"},{default:e(()=>[_(C(D.value.full_name),1)]),_:1}),t(re,{label:"Дата рождения"},{default:e(()=>[_(C(D.value.birth_date||"Не указана"),1)]),_:1}),t(re,{label:"Внешний ID"},{default:e(()=>[_(C(D.value.external_id||"Не указан"),1)]),_:1}),t(re,{label:"Дата создания"},{default:e(()=>[_(C(m(me)(D.value.created_at)),1)]),_:1})]),_:1},8,["column"])]),_:1})):O("",!0),t(Se,{class:"section-card"},{header:e(()=>[p("div",xa,[n[16]||(n[16]=p("h3",null,"Отчёты",-1)),t(T,{type:"primary",onClick:n[3]||(n[3]=w=>c.value=!0)},{default:e(()=>[t(A,null,{default:e(()=>[t(m(Ue))]),_:1}),n[15]||(n[15]=_(" Загрузить отчёт ",-1))]),_:1})])]),default:e(()=>[t(oa,{reports:S.value,loading:z.value,onView:J,onEdit:J,onExtract:ke,onDownload:be,onDelete:Qe,onUpload:n[4]||(n[4]=w=>c.value=!0)},null,8,["reports","loading"])]),_:1}),P.value.length>0?(o(),y(Se,{key:1,class:"section-card"},{header:e(()=>[...n[17]||(n[17]=[p("h3",null,"История оценок пригодности",-1)])]),default:e(()=>[t(lt,null,{default:e(()=>[(o(!0),N(ee,null,ae(P.value,w=>(o(),y(at,{key:w.id,timestamp:m(me)(w.created_at),placement:"top"},{default:e(()=>[t(Ca,{result:w,onDownloadPdf:et},null,8,["result"])]),_:2},1032,["timestamp"]))),128))]),_:1})]),_:1})):O("",!0),t(Ee,{modelValue:c.value,"onUpdate:modelValue":n[6]||(n[6]=w=>c.value=w),title:"Загрузить отчёты",width:m(x)?"95%":"600px","destroy-on-close":"",onClose:_e},{footer:e(()=>[t(T,{onClick:n[5]||(n[5]=w=>c.value=!1)},{default:e(()=>[...n[20]||(n[20]=[_(" Отмена ",-1)])]),_:1}),t(T,{type:"primary",loading:G.value,disabled:!j.value.some(w=>w.status==="pending"),onClick:oe},{default:e(()=>[_(" Загрузить все ("+C(j.value.filter(w=>w.status==="pending").length)+") ",1)]),_:1},8,["loading","disabled"])]),default:e(()=>[t(st,{ref_key:"uploadRef",ref:B,"auto-upload":!1,multiple:"",accept:".docx","on-change":le,"show-file-list":!1,drag:""},{tip:e(()=>[...n[18]||(n[18]=[p("div",{class:"el-upload__tip"}," Только .docx файлы, макс. 20 МБ, до 10 файлов ",-1)])]),default:e(()=>[t(A,{class:"el-icon--upload"},{default:e(()=>[t(m(Ue))]),_:1}),n[19]||(n[19]=p("div",{class:"el-upload__text"},[_(" Перетащите файлы сюда или "),p("em",null,"нажмите для выбора")],-1))]),_:1},512),j.value.length?(o(),N("div",Da,[p("div",Ra," Выбрано файлов: "+C(j.value.length)+"/"+C(De),1),(o(!0),N(ee,null,ae(j.value,w=>(o(),N("div",{key:w.id,class:Xe(["batch-file-item","batch-file-item--"+w.status])},[w.status==="pending"?(o(),y(A,{key:0,class:"batch-file-icon"},{default:e(()=>[t(m(Ve))]),_:1})):w.status==="uploading"?(o(),y(A,{key:1,class:"batch-file-icon is-loading"},{default:e(()=>[t(m(he))]),_:1})):w.status==="success"?(o(),y(A,{key:2,class:"batch-file-icon batch-file-icon--success"},{default:e(()=>[t(m(Re))]),_:1})):w.status==="error"?(o(),y(A,{key:3,class:"batch-file-icon batch-file-icon--error"},{default:e(()=>[t(m(Me))]),_:1})):O("",!0),p("div",Ma,[p("span",Va,C(w.name),1),p("span",Ia,C(W(w.size)),1),w.error?(o(),N("span",Aa,C(w.error),1)):O("",!0)]),w.status==="pending"||w.status==="error"?(o(),y(T,{key:4,type:"danger",icon:m(Ae),circle:"",size:"small",onClick:Ta=>se(w.id)},null,8,["icon","onClick"])):O("",!0)],2))),128))])):O("",!0)]),_:1},8,["modelValue","width"]),t(Ee,{modelValue:E.value,"onUpdate:modelValue":n[9]||(n[9]=w=>E.value=w),title:"Рассчитать профессиональную пригодность",width:m(x)?"95%":"500px","destroy-on-close":""},{footer:e(()=>[t(T,{onClick:n[8]||(n[8]=w=>E.value=!1)},{default:e(()=>[...n[21]||(n[21]=[_(" Отмена ",-1)])]),_:1}),t(T,{type:"primary",loading:H.value,disabled:!Y.activityCode||S.value.length===0,onClick:Ye},{default:e(()=>[...n[22]||(n[22]=[_(" Рассчитать ",-1)])]),_:1},8,["loading","disabled"])]),default:e(()=>[t(it,{model:Y,"label-position":"top"},{default:e(()=>[t(rt,{label:"Профессиональная область",required:""},{default:e(()=>[fe((o(),y(ot,{modelValue:Y.activityCode,"onUpdate:modelValue":n[7]||(n[7]=w=>Y.activityCode=w),placeholder:"Выберите область",style:{width:"100%"}},{default:e(()=>[(o(!0),N(ee,null,ae(v.value,w=>(o(),y(nt,{key:w.code,label:w.name,value:w.code},{default:e(()=>[p("span",null,C(w.name),1),p("span",Fa,C(w.code),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])),[[ze,V.value]])]),_:1}),t(Te,{title:"Убедитесь, что у участника загружены и обработаны отчёты с метриками",type:"info",closable:!1,"show-icon":""}),S.value.length===0?(o(),y(Te,{key:0,title:"У участника нет загруженных отчётов",type:"warning",closable:!1,"show-icon":"",style:{"margin-top":"12px"}})):O("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","width"]),t(Ee,{modelValue:f.value,"onUpdate:modelValue":n[10]||(n[10]=w=>f.value=w),title:"Метрики отчёта",width:"90%",top:"5vh","destroy-on-close":""},{default:e(()=>[I.value?(o(),y(Xt,{key:0,"report-id":I.value,"report-status":u.value,onMetricsUpdated:$e},null,8,["report-id","report-status"])):O("",!0)]),_:1},8,["modelValue"]),t(pa,{modelValue:U.value,"onUpdate:modelValue":n[11]||(n[11]=w=>U.value=w),"participant-id":D.value?.id,"participant-name":D.value?.full_name},null,8,["modelValue","participant-id","participant-name"])])),[[ze,$.value]])]),_:1})}}},Xa=ue(Na,[["__scopeId","data-v-0b627b1b"]]);export{Xa as default};
