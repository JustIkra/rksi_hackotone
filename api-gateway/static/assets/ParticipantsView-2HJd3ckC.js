import{n as S,m as $,H as T,v as V,w as l,E as b,d as A,r as d,I as H,o as u,a as o,J,f as a,e as c,u as n,K,L as B,M as j,c as v,x as G,F as O,C as Q,B as z,N as W}from"./index-Cq7tpZKo.js";import{A as X}from"./AppLayout-wWzZ-0QO.js";import{u as Z,a as ee}from"./useResponsive-zcDJoYP8.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"participants-view"},le={class:"page-header"},ne={class:"header-content"},oe={class:"filter-card card"},ie={class:"table-card card"},se={class:"actions-group"},re={key:1,class:"participants-cards"},de={class:"participant-card__name"},pe={class:"participant-card__info"},ue={class:"participant-card__field"},_e={class:"field-value"},me={class:"participant-card__field"},ce={class:"field-value"},fe={class:"participant-card__actions"},ge={key:2,class:"pagination"},ve={key:3,class:"pagination pagination--mobile"},ye={__name:"ParticipantsView",setup(be){const Y=A(),s=Z(),{isMobile:f}=ee(),i=S({query:"",external_id:"",page:1,size:20}),g=$(!1),k=$(null),r=S({full_name:"",birth_date:"",external_id:""}),I={full_name:[{required:!0,message:"Введите ФИО",trigger:"blur"},{min:1,max:255,message:"От 1 до 255 символов",trigger:"blur"}]},p=async()=>{try{await s.searchParticipants(i)}catch{b.error("Ошибка загрузки участников")}},F=async()=>{k.value&&await k.value.validate(async _=>{if(_)try{await s.createParticipant(r),b.success("Участник создан"),g.value=!1,r.full_name="",r.birth_date="",r.external_id="",await p()}catch{b.error(s.error||"Ошибка создания участника")}})},h=_=>{Y.push(`/participants/${_}`)},D=_=>{W.confirm(`Вы уверены, что хотите удалить участника "${_.full_name}"?`,"Подтверждение удаления",{confirmButtonText:"Удалить",cancelButtonText:"Отмена",type:"warning"}).then(async()=>{try{await s.deleteParticipant(_.id),b.success("Участник удалён"),await p()}catch{b.error(s.error||"Ошибка удаления участника")}}).catch(()=>{})};return T(()=>{p()}),(_,e)=>{const U=d("el-icon"),m=d("el-button"),x=d("el-input"),y=d("el-form-item"),M=d("el-form"),C=d("el-table-column"),N=d("el-table"),R=d("el-empty"),P=d("el-pagination"),q=d("el-date-picker"),E=d("el-dialog"),L=H("loading");return u(),V(X,null,{default:l(()=>[o("div",ae,[o("div",le,[o("div",ne,[e[14]||(e[14]=o("h1",{class:"page-title"}," Участники ",-1)),a(m,{type:"primary",onClick:e[0]||(e[0]=t=>g.value=!0)},{default:l(()=>[a(U,null,{default:l(()=>[a(n(K))]),_:1}),e[13]||(e[13]=c(" Добавить участника ",-1))]),_:1})])]),o("div",oe,[a(M,{inline:!n(f),model:i},{default:l(()=>[a(y,{label:"Поиск"},{default:l(()=>[a(x,{modelValue:i.query,"onUpdate:modelValue":e[1]||(e[1]=t=>i.query=t),placeholder:"Введите имя",clearable:"",style:B(n(f)?"width: 100%":"width: 300px"),onChange:p},{prefix:l(()=>[a(U,null,{default:l(()=>[a(n(j))]),_:1})]),_:1},8,["modelValue","style"])]),_:1}),a(y,{label:"Внешний ID"},{default:l(()=>[a(x,{modelValue:i.external_id,"onUpdate:modelValue":e[2]||(e[2]=t=>i.external_id=t),placeholder:"Внешний ID",clearable:"",style:B(n(f)?"width: 100%":"width: 200px"),onChange:p},null,8,["modelValue","style"])]),_:1})]),_:1},8,["inline","model"])]),J((u(),v("div",ie,[n(f)?(u(),v("div",re,[(u(!0),v(O,null,Q(n(s).participants,t=>(u(),v("div",{key:t.id,class:"participant-card"},[o("div",de,z(t.full_name),1),o("div",pe,[o("div",ue,[e[17]||(e[17]=o("span",{class:"field-label"},"ID:",-1)),o("span",_e,z(t.external_id||"—"),1)]),o("div",me,[e[18]||(e[18]=o("span",{class:"field-label"},"Дата рождения:",-1)),o("span",ce,z(t.birth_date||"—"),1)])]),o("div",fe,[a(m,{type:"primary",onClick:w=>h(t.id)},{default:l(()=>[...e[19]||(e[19]=[c(" Открыть ",-1)])]),_:1},8,["onClick"]),a(m,{type:"danger",plain:"",onClick:w=>D(t)},{default:l(()=>[...e[20]||(e[20]=[c(" Удалить ",-1)])]),_:1},8,["onClick"])])]))),128)),!n(s).participants.length&&!n(s).loading?(u(),V(R,{key:0,description:"Нет участников","image-size":120},{default:l(()=>[a(m,{type:"primary",onClick:e[3]||(e[3]=t=>g.value=!0)},{default:l(()=>[...e[21]||(e[21]=[c(" Добавить участника ",-1)])]),_:1})]),_:1})):G("",!0)])):(u(),V(N,{key:0,data:n(s).participants,stripe:"","table-layout":"fixed"},{default:l(()=>[a(C,{prop:"full_name",label:"ФИО"}),a(C,{prop:"birth_date",label:"Дата рождения",width:"150"}),a(C,{prop:"external_id",label:"Внешний ID",width:"150"}),a(C,{label:"Действия",width:"200",align:"center"},{default:l(({row:t})=>[o("div",se,[a(m,{type:"primary",size:"small",onClick:w=>h(t.id)},{default:l(()=>[...e[15]||(e[15]=[c(" Открыть ",-1)])]),_:1},8,["onClick"]),a(m,{type:"danger",size:"small",plain:"",onClick:w=>D(t)},{default:l(()=>[...e[16]||(e[16]=[c(" Удалить ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),n(f)?(u(),v("div",ve,[a(P,{"current-page":i.page,"onUpdate:currentPage":e[6]||(e[6]=t=>i.page=t),"page-size":i.size,"onUpdate:pageSize":e[7]||(e[7]=t=>i.size=t),total:n(s).pagination.total,"page-sizes":[10,20,50],layout:"prev, pager, next",small:"",onCurrentChange:p,onSizeChange:p},null,8,["current-page","page-size","total"])])):(u(),v("div",ge,[a(P,{"current-page":i.page,"onUpdate:currentPage":e[4]||(e[4]=t=>i.page=t),"page-size":i.size,"onUpdate:pageSize":e[5]||(e[5]=t=>i.size=t),total:n(s).pagination.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onCurrentChange:p,onSizeChange:p},null,8,["current-page","page-size","total"])]))])),[[L,n(s).loading]]),a(E,{modelValue:g.value,"onUpdate:modelValue":e[12]||(e[12]=t=>g.value=t),title:"Добавить участника",width:n(f)?"95%":"500px"},{footer:l(()=>[a(m,{onClick:e[11]||(e[11]=t=>g.value=!1)},{default:l(()=>[...e[22]||(e[22]=[c(" Отмена ",-1)])]),_:1}),a(m,{type:"primary",loading:n(s).loading,onClick:F},{default:l(()=>[...e[23]||(e[23]=[c(" Создать ",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(M,{ref_key:"createFormRef",ref:k,model:r,rules:I,"label-position":"top"},{default:l(()=>[a(y,{label:"ФИО",prop:"full_name"},{default:l(()=>[a(x,{modelValue:r.full_name,"onUpdate:modelValue":e[8]||(e[8]=t=>r.full_name=t),placeholder:"Введите полное имя"},null,8,["modelValue"])]),_:1}),a(y,{label:"Дата рождения",prop:"birth_date"},{default:l(()=>[a(q,{modelValue:r.birth_date,"onUpdate:modelValue":e[9]||(e[9]=t=>r.birth_date=t),type:"date",placeholder:"Выберите дату",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(y,{label:"Внешний ID",prop:"external_id"},{default:l(()=>[a(x,{modelValue:r.external_id,"onUpdate:modelValue":e[10]||(e[10]=t=>r.external_id=t),placeholder:"Внешний идентификатор (необязательно)"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","width"])])]),_:1})}}},Ve=te(ye,[["__scopeId","data-v-d6c02f45"]]);export{Ve as default};
