import{m as h,n as Y,H as W,I as H,v as y,w as l,E as b,e as J,r,J as K,o as u,a as i,d as t,K as O,f as c,u as d,L as j,M as I,N as G,c as k,x as Q,F as X,C as Z,B as D,O as ee}from"./index-D2vGccO4.js";import{A as te}from"./AppLayout-KmPa5HSF.js";import{u as ae}from"./participants-Bzi4Yn4V.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={class:"participants-view"},oe={class:"header-content"},ie={class:"actions-group"},re={key:1,class:"participants-cards"},se={class:"participant-card__name"},de={class:"participant-card__info"},pe={class:"participant-card__field"},ue={class:"field-value"},_e={class:"participant-card__field"},me={class:"field-value"},ce={class:"participant-card__actions"},fe={key:2,class:"pagination"},ge={key:3,class:"pagination pagination--mobile"},ve={__name:"ParticipantsView",setup(ye){const E=J(),o=ae(),f=h(window.innerWidth<=768),U=()=>{f.value=window.innerWidth<=768},n=Y({query:"",external_id:"",page:1,size:20}),g=h(!1),V=h(null),s=Y({full_name:"",birth_date:"",external_id:""}),F={full_name:[{required:!0,message:"Введите ФИО",trigger:"blur"},{min:1,max:255,message:"От 1 до 255 символов",trigger:"blur"}]},p=async()=>{try{await o.searchParticipants(n)}catch{b.error("Ошибка загрузки участников")}},L=async()=>{V.value&&await V.value.validate(async _=>{if(_)try{await o.createParticipant(s),b.success("Участник создан"),g.value=!1,s.full_name="",s.birth_date="",s.external_id="",await p()}catch{b.error(o.error||"Ошибка создания участника")}})},M=_=>{E.push(`/participants/${_}`)},P=_=>{ee.confirm(`Вы уверены, что хотите удалить участника "${_.full_name}"?`,"Подтверждение удаления",{confirmButtonText:"Удалить",cancelButtonText:"Отмена",type:"warning"}).then(async()=>{try{await o.deleteParticipant(_.id),b.success("Участник удалён"),await p()}catch{b.error(o.error||"Ошибка удаления участника")}}).catch(()=>{})};return W(()=>{window.addEventListener("resize",U),p()}),H(()=>{window.removeEventListener("resize",U)}),(_,e)=>{const S=r("el-icon"),m=r("el-button"),w=r("el-card"),x=r("el-input"),v=r("el-form-item"),$=r("el-form"),C=r("el-table-column"),N=r("el-table"),q=r("el-empty"),B=r("el-pagination"),R=r("el-date-picker"),T=r("el-dialog"),A=K("loading");return u(),y(te,null,{default:l(()=>[i("div",ne,[t(w,{class:"header-card"},{default:l(()=>[i("div",oe,[e[14]||(e[14]=i("h1",null,"Участники",-1)),t(m,{type:"primary",onClick:e[0]||(e[0]=a=>g.value=!0)},{default:l(()=>[t(S,null,{default:l(()=>[t(d(j))]),_:1}),e[13]||(e[13]=c(" Добавить участника ",-1))]),_:1})])]),_:1}),t(w,{class:"search-card"},{default:l(()=>[t($,{inline:!f.value,model:n},{default:l(()=>[t(v,{label:"Поиск"},{default:l(()=>[t(x,{modelValue:n.query,"onUpdate:modelValue":e[1]||(e[1]=a=>n.query=a),placeholder:"Введите имя",clearable:"",style:I(f.value?"width: 100%":"width: 300px"),onChange:p},{prefix:l(()=>[t(S,null,{default:l(()=>[t(d(G))]),_:1})]),_:1},8,["modelValue","style"])]),_:1}),t(v,{label:"Внешний ID"},{default:l(()=>[t(x,{modelValue:n.external_id,"onUpdate:modelValue":e[2]||(e[2]=a=>n.external_id=a),placeholder:"Внешний ID",clearable:"",style:I(f.value?"width: 100%":"width: 200px"),onChange:p},null,8,["modelValue","style"])]),_:1})]),_:1},8,["inline","model"])]),_:1}),O((u(),y(w,{class:"table-card"},{default:l(()=>[f.value?(u(),k("div",re,[(u(!0),k(X,null,Z(d(o).participants,a=>(u(),y(w,{key:a.id,class:"participant-card",shadow:"hover"},{default:l(()=>[i("div",se,D(a.full_name),1),i("div",de,[i("div",pe,[e[17]||(e[17]=i("span",{class:"field-label"},"ID:",-1)),i("span",ue,D(a.external_id||"—"),1)]),i("div",_e,[e[18]||(e[18]=i("span",{class:"field-label"},"Дата рождения:",-1)),i("span",me,D(a.birth_date||"—"),1)])]),i("div",ce,[t(m,{type:"primary",onClick:z=>M(a.id)},{default:l(()=>[...e[19]||(e[19]=[c(" Открыть ",-1)])]),_:1},8,["onClick"]),t(m,{type:"danger",onClick:z=>P(a)},{default:l(()=>[...e[20]||(e[20]=[c(" Удалить ",-1)])]),_:1},8,["onClick"])])]),_:2},1024))),128)),!d(o).participants.length&&!d(o).loading?(u(),y(q,{key:0,description:"Нет участников","image-size":120},{default:l(()=>[t(m,{type:"primary",onClick:e[3]||(e[3]=a=>g.value=!0)},{default:l(()=>[...e[21]||(e[21]=[c(" Добавить участника ",-1)])]),_:1})]),_:1})):Q("",!0)])):(u(),y(N,{key:0,data:d(o).participants,stripe:""},{default:l(()=>[t(C,{prop:"full_name",label:"ФИО","min-width":"200"}),t(C,{prop:"birth_date",label:"Дата рождения",width:"150"}),t(C,{prop:"external_id",label:"Внешний ID",width:"150"}),t(C,{label:"Действия",width:"180",fixed:"right"},{default:l(({row:a})=>[i("div",ie,[t(m,{type:"primary",size:"small",onClick:z=>M(a.id)},{default:l(()=>[...e[15]||(e[15]=[c(" Открыть ",-1)])]),_:1},8,["onClick"]),t(m,{class:"actions-group__danger",type:"danger",size:"small",onClick:z=>P(a)},{default:l(()=>[...e[16]||(e[16]=[c(" Удалить ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),f.value?(u(),k("div",ge,[t(B,{"current-page":n.page,"onUpdate:currentPage":e[6]||(e[6]=a=>n.page=a),"page-size":n.size,"onUpdate:pageSize":e[7]||(e[7]=a=>n.size=a),total:d(o).pagination.total,"page-sizes":[10,20,50],layout:"prev, pager, next",small:"",onCurrentChange:p,onSizeChange:p},null,8,["current-page","page-size","total"])])):(u(),k("div",fe,[t(B,{"current-page":n.page,"onUpdate:currentPage":e[4]||(e[4]=a=>n.page=a),"page-size":n.size,"onUpdate:pageSize":e[5]||(e[5]=a=>n.size=a),total:d(o).pagination.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onCurrentChange:p,onSizeChange:p},null,8,["current-page","page-size","total"])]))]),_:1})),[[A,d(o).loading]]),t(T,{modelValue:g.value,"onUpdate:modelValue":e[12]||(e[12]=a=>g.value=a),title:"Добавить участника",width:f.value?"95%":"500px"},{footer:l(()=>[t(m,{onClick:e[11]||(e[11]=a=>g.value=!1)},{default:l(()=>[...e[22]||(e[22]=[c(" Отмена ",-1)])]),_:1}),t(m,{type:"primary",loading:d(o).loading,onClick:L},{default:l(()=>[...e[23]||(e[23]=[c(" Создать ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t($,{ref_key:"createFormRef",ref:V,model:s,rules:F,"label-position":"top"},{default:l(()=>[t(v,{label:"ФИО",prop:"full_name"},{default:l(()=>[t(x,{modelValue:s.full_name,"onUpdate:modelValue":e[8]||(e[8]=a=>s.full_name=a),placeholder:"Введите полное имя"},null,8,["modelValue"])]),_:1}),t(v,{label:"Дата рождения",prop:"birth_date"},{default:l(()=>[t(R,{modelValue:s.birth_date,"onUpdate:modelValue":e[9]||(e[9]=a=>s.birth_date=a),type:"date",placeholder:"Выберите дату",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(v,{label:"Внешний ID",prop:"external_id"},{default:l(()=>[t(x,{modelValue:s.external_id,"onUpdate:modelValue":e[10]||(e[10]=a=>s.external_id=a),placeholder:"Внешний идентификатор (необязательно)"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","width"])])]),_:1})}}},ke=le(ve,[["__scopeId","data-v-b7a4659a"]]);export{ke as default};
