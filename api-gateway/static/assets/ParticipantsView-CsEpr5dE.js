import{n as Y,m as I,H as J,v as D,w as l,E as b,d as K,r as d,I as j,o as r,a as n,J as G,f as a,e as p,u as o,K as O,L as F,M as Q,c as _,B as y,F as N,x as U,C as W,N as X}from"./index-CLa57XdF.js";import{A as Z}from"./AppLayout-CgNgEes3.js";import{u as ee}from"./participants-B8TgiyCd.js";import{u as te}from"./useResponsive-PLxFU8ar.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./participants-8uyslejd.js";const le={class:"participants-view"},ne={class:"page-header"},oe={class:"header-content"},ie={class:"filter-card card"},se={class:"table-card card"},re={class:"dept-name-text"},de={key:1,class:"no-org-text"},pe={class:"actions-group"},ue={key:1,class:"participants-cards"},_e={class:"participant-card__name"},me={class:"participant-card__info"},ce={class:"participant-card__field"},fe={class:"field-value"},ge={key:0,class:"participant-card__field"},ye={class:"field-value"},ve={key:1,class:"participant-card__field"},ke={class:"field-value"},Ce={class:"participant-card__actions"},be={key:2,class:"pagination"},xe={key:3,class:"pagination pagination--mobile"},ze={__name:"ParticipantsView",setup(Ve){const h=K(),s=ee(),{isMobile:v}=te(),i=Y({query:"",external_id:"",page:1,size:20}),k=I(!1),$=I(null),u=Y({full_name:"",birth_date:"",external_id:""}),R={full_name:[{required:!0,message:"Введите ФИО",trigger:"blur"},{min:1,max:255,message:"От 1 до 255 символов",trigger:"blur"}]},m=async()=>{try{await s.searchParticipants(i)}catch{b.error("Ошибка загрузки участников")}},q=async()=>{$.value&&await $.value.validate(async c=>{if(c)try{await s.createParticipant(u),b.success("Участник создан"),k.value=!1,u.full_name="",u.birth_date="",u.external_id="",await m()}catch{b.error(s.error||"Ошибка создания участника")}})},x=c=>{h.push(`/participants/${c}`)},M=c=>{X.confirm(`Вы уверены, что хотите удалить участника "${c.full_name}"?`,"Подтверждение удаления",{confirmButtonText:"Удалить",cancelButtonText:"Отмена",type:"warning"}).then(async()=>{try{await s.deleteParticipant(c.id),b.success("Участник удалён"),await m()}catch{b.error(s.error||"Ошибка удаления участника")}}).catch(()=>{})};return J(()=>{m()}),(c,e)=>{const P=d("el-icon"),f=d("el-button"),z=d("el-input"),C=d("el-form-item"),S=d("el-form"),V=d("el-link"),w=d("el-table-column"),E=d("el-table"),L=d("el-empty"),B=d("el-pagination"),T=d("el-date-picker"),A=d("el-dialog"),H=j("loading");return r(),D(Z,null,{default:l(()=>[n("div",le,[n("div",ne,[n("div",oe,[e[14]||(e[14]=n("h1",{class:"page-title"}," Участники ",-1)),a(f,{type:"primary",onClick:e[0]||(e[0]=t=>k.value=!0)},{default:l(()=>[a(P,null,{default:l(()=>[a(o(O))]),_:1}),e[13]||(e[13]=p(" Добавить участника ",-1))]),_:1})])]),n("div",ie,[a(S,{inline:!o(v),model:i},{default:l(()=>[a(C,{label:"Поиск"},{default:l(()=>[a(z,{modelValue:i.query,"onUpdate:modelValue":e[1]||(e[1]=t=>i.query=t),placeholder:"Введите имя",clearable:"",style:F(o(v)?"width: 100%":"width: 300px"),onChange:m},{prefix:l(()=>[a(P,null,{default:l(()=>[a(o(Q))]),_:1})]),_:1},8,["modelValue","style"])]),_:1}),a(C,{label:"Внешний ID"},{default:l(()=>[a(z,{modelValue:i.external_id,"onUpdate:modelValue":e[2]||(e[2]=t=>i.external_id=t),placeholder:"Внешний ID",clearable:"",style:F(o(v)?"width: 100%":"width: 200px"),onChange:m},null,8,["modelValue","style"])]),_:1})]),_:1},8,["inline","model"])]),G((r(),_("div",se,[o(v)?(r(),_("div",ue,[(r(!0),_(N,null,W(o(s).participants,t=>(r(),_("div",{key:t.id,class:"participant-card"},[n("div",_e,[a(V,{type:"primary",underline:!1,onClick:g=>x(t.id)},{default:l(()=>[p(y(t.full_name),1)]),_:2},1032,["onClick"])]),n("div",me,[n("div",ce,[e[18]||(e[18]=n("span",{class:"field-label"},"ID:",-1)),n("span",fe,y(t.external_id||"—"),1)]),t.department_info?(r(),_("div",ge,[e[19]||(e[19]=n("span",{class:"field-label"},"Организация:",-1)),n("span",ye,[a(V,{type:"default",underline:!1,onClick:g=>o(h).push(`/organizations/${t.department_info.organization_id}`)},{default:l(()=>[p(y(t.department_info.organization_name),1)]),_:2},1032,["onClick"])])])):U("",!0),t.department_info?(r(),_("div",ve,[e[20]||(e[20]=n("span",{class:"field-label"},"Отдел:",-1)),n("span",ke,y(t.department_info.name),1)])):U("",!0)]),n("div",Ce,[a(f,{type:"primary",onClick:g=>x(t.id)},{default:l(()=>[...e[21]||(e[21]=[p(" Открыть ",-1)])]),_:1},8,["onClick"]),a(f,{type:"danger",plain:"",onClick:g=>M(t)},{default:l(()=>[...e[22]||(e[22]=[p(" Удалить ",-1)])]),_:1},8,["onClick"])])]))),128)),!o(s).participants.length&&!o(s).loading?(r(),D(L,{key:0,description:"Нет участников","image-size":120},{default:l(()=>[a(f,{type:"primary",onClick:e[3]||(e[3]=t=>k.value=!0)},{default:l(()=>[...e[23]||(e[23]=[p(" Добавить участника ",-1)])]),_:1})]),_:1})):U("",!0)])):(r(),D(E,{key:0,data:o(s).participants,stripe:"","table-layout":"fixed"},{default:l(()=>[a(w,{label:"ФИО","min-width":"200"},{default:l(({row:t})=>[a(V,{type:"primary",underline:!1,onClick:g=>x(t.id)},{default:l(()=>[p(y(t.full_name),1)]),_:2},1032,["onClick"])]),_:1}),a(w,{label:"Организация / Отдел","min-width":"200"},{default:l(({row:t})=>[t.department_info?(r(),_(N,{key:0},[a(V,{type:"default",underline:!1,onClick:g=>o(h).push(`/organizations/${t.department_info.organization_id}`)},{default:l(()=>[p(y(t.department_info.organization_name),1)]),_:2},1032,["onClick"]),e[15]||(e[15]=n("span",{class:"org-separator"}," / ",-1)),n("span",re,y(t.department_info.name),1)],64)):(r(),_("span",de,"—"))]),_:1}),a(w,{prop:"external_id",label:"Внешний ID",width:"150"}),a(w,{label:"Действия",width:"200",align:"center"},{default:l(({row:t})=>[n("div",pe,[a(f,{type:"primary",size:"small",onClick:g=>x(t.id)},{default:l(()=>[...e[16]||(e[16]=[p(" Открыть ",-1)])]),_:1},8,["onClick"]),a(f,{type:"danger",size:"small",plain:"",onClick:g=>M(t)},{default:l(()=>[...e[17]||(e[17]=[p(" Удалить ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),o(v)?(r(),_("div",xe,[a(B,{"current-page":i.page,"onUpdate:currentPage":e[6]||(e[6]=t=>i.page=t),"page-size":i.size,"onUpdate:pageSize":e[7]||(e[7]=t=>i.size=t),total:o(s).pagination.total,"page-sizes":[10,20,50],layout:"prev, pager, next",small:"",onCurrentChange:m,onSizeChange:m},null,8,["current-page","page-size","total"])])):(r(),_("div",be,[a(B,{"current-page":i.page,"onUpdate:currentPage":e[4]||(e[4]=t=>i.page=t),"page-size":i.size,"onUpdate:pageSize":e[5]||(e[5]=t=>i.size=t),total:o(s).pagination.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onCurrentChange:m,onSizeChange:m},null,8,["current-page","page-size","total"])]))])),[[H,o(s).loading]]),a(A,{modelValue:k.value,"onUpdate:modelValue":e[12]||(e[12]=t=>k.value=t),title:"Добавить участника",width:o(v)?"95%":"500px"},{footer:l(()=>[a(f,{onClick:e[11]||(e[11]=t=>k.value=!1)},{default:l(()=>[...e[24]||(e[24]=[p(" Отмена ",-1)])]),_:1}),a(f,{type:"primary",loading:o(s).loading,onClick:q},{default:l(()=>[...e[25]||(e[25]=[p(" Создать ",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(S,{ref_key:"createFormRef",ref:$,model:u,rules:R,"label-position":"top"},{default:l(()=>[a(C,{label:"ФИО",prop:"full_name"},{default:l(()=>[a(z,{modelValue:u.full_name,"onUpdate:modelValue":e[8]||(e[8]=t=>u.full_name=t),placeholder:"Введите полное имя"},null,8,["modelValue"])]),_:1}),a(C,{label:"Дата рождения",prop:"birth_date"},{default:l(()=>[a(T,{modelValue:u.birth_date,"onUpdate:modelValue":e[9]||(e[9]=t=>u.birth_date=t),type:"date",placeholder:"Выберите дату",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(C,{label:"Внешний ID",prop:"external_id"},{default:l(()=>[a(z,{modelValue:u.external_id,"onUpdate:modelValue":e[10]||(e[10]=t=>u.external_id=t),placeholder:"Внешний идентификатор (необязательно)"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","width"])])]),_:1})}}},Pe=ae(ze,[["__scopeId","data-v-b717c933"]]);export{Pe as default};
