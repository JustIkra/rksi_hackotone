import{n as $,m as B,H as A,v as y,w as l,E as b,e as H,r as s,I as J,o as u,a as r,d as t,J as K,f as c,u as n,K as j,L as Y,M as G,c as k,x as O,F as Q,C as W,B as h,N as X}from"./index-B7EJ_Eo5.js";import{A as Z}from"./AppLayout-XNYhTtli.js";import{u as ee,a as te}from"./useResponsive-gag8PGrd.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"participants-view"},ne={class:"header-content"},oe={class:"actions-group"},ie={key:1,class:"participants-cards"},re={class:"participant-card__name"},se={class:"participant-card__info"},de={class:"participant-card__field"},pe={class:"field-value"},ue={class:"participant-card__field"},_e={class:"field-value"},me={class:"participant-card__actions"},ce={key:2,class:"pagination"},fe={key:3,class:"pagination pagination--mobile"},ge={__name:"ParticipantsView",setup(ve){const I=H(),i=ee(),{isMobile:f}=te(),o=$({query:"",external_id:"",page:1,size:20}),g=B(!1),V=B(null),d=$({full_name:"",birth_date:"",external_id:""}),F={full_name:[{required:!0,message:"Введите ФИО",trigger:"blur"},{min:1,max:255,message:"От 1 до 255 символов",trigger:"blur"}]},p=async()=>{try{await i.searchParticipants(o)}catch{b.error("Ошибка загрузки участников")}},N=async()=>{V.value&&await V.value.validate(async _=>{if(_)try{await i.createParticipant(d),b.success("Участник создан"),g.value=!1,d.full_name="",d.birth_date="",d.external_id="",await p()}catch{b.error(i.error||"Ошибка создания участника")}})},D=_=>{I.push(`/participants/${_}`)},U=_=>{X.confirm(`Вы уверены, что хотите удалить участника "${_.full_name}"?`,"Подтверждение удаления",{confirmButtonText:"Удалить",cancelButtonText:"Отмена",type:"warning"}).then(async()=>{try{await i.deleteParticipant(_.id),b.success("Участник удалён"),await p()}catch{b.error(i.error||"Ошибка удаления участника")}}).catch(()=>{})};return A(()=>{p()}),(_,e)=>{const M=s("el-icon"),m=s("el-button"),x=s("el-card"),w=s("el-input"),v=s("el-form-item"),P=s("el-form"),C=s("el-table-column"),R=s("el-table"),q=s("el-empty"),S=s("el-pagination"),E=s("el-date-picker"),L=s("el-dialog"),T=J("loading");return u(),y(Z,null,{default:l(()=>[r("div",le,[t(x,{class:"header-card"},{default:l(()=>[r("div",ne,[e[14]||(e[14]=r("h1",null,"Участники",-1)),t(m,{type:"primary",onClick:e[0]||(e[0]=a=>g.value=!0)},{default:l(()=>[t(M,null,{default:l(()=>[t(n(j))]),_:1}),e[13]||(e[13]=c(" Добавить участника ",-1))]),_:1})])]),_:1}),t(x,{class:"search-card"},{default:l(()=>[t(P,{inline:!n(f),model:o},{default:l(()=>[t(v,{label:"Поиск"},{default:l(()=>[t(w,{modelValue:o.query,"onUpdate:modelValue":e[1]||(e[1]=a=>o.query=a),placeholder:"Введите имя",clearable:"",style:Y(n(f)?"width: 100%":"width: 300px"),onChange:p},{prefix:l(()=>[t(M,null,{default:l(()=>[t(n(G))]),_:1})]),_:1},8,["modelValue","style"])]),_:1}),t(v,{label:"Внешний ID"},{default:l(()=>[t(w,{modelValue:o.external_id,"onUpdate:modelValue":e[2]||(e[2]=a=>o.external_id=a),placeholder:"Внешний ID",clearable:"",style:Y(n(f)?"width: 100%":"width: 200px"),onChange:p},null,8,["modelValue","style"])]),_:1})]),_:1},8,["inline","model"])]),_:1}),K((u(),y(x,{class:"table-card"},{default:l(()=>[n(f)?(u(),k("div",ie,[(u(!0),k(Q,null,W(n(i).participants,a=>(u(),y(x,{key:a.id,class:"participant-card",shadow:"hover"},{default:l(()=>[r("div",re,h(a.full_name),1),r("div",se,[r("div",de,[e[17]||(e[17]=r("span",{class:"field-label"},"ID:",-1)),r("span",pe,h(a.external_id||"—"),1)]),r("div",ue,[e[18]||(e[18]=r("span",{class:"field-label"},"Дата рождения:",-1)),r("span",_e,h(a.birth_date||"—"),1)])]),r("div",me,[t(m,{type:"primary",onClick:z=>D(a.id)},{default:l(()=>[...e[19]||(e[19]=[c(" Открыть ",-1)])]),_:1},8,["onClick"]),t(m,{type:"danger",onClick:z=>U(a)},{default:l(()=>[...e[20]||(e[20]=[c(" Удалить ",-1)])]),_:1},8,["onClick"])])]),_:2},1024))),128)),!n(i).participants.length&&!n(i).loading?(u(),y(q,{key:0,description:"Нет участников","image-size":120},{default:l(()=>[t(m,{type:"primary",onClick:e[3]||(e[3]=a=>g.value=!0)},{default:l(()=>[...e[21]||(e[21]=[c(" Добавить участника ",-1)])]),_:1})]),_:1})):O("",!0)])):(u(),y(R,{key:0,data:n(i).participants,stripe:""},{default:l(()=>[t(C,{prop:"full_name",label:"ФИО","min-width":"200"}),t(C,{prop:"birth_date",label:"Дата рождения",width:"150"}),t(C,{prop:"external_id",label:"Внешний ID",width:"150"}),t(C,{label:"Действия",width:"180",fixed:"right"},{default:l(({row:a})=>[r("div",oe,[t(m,{type:"primary",size:"small",onClick:z=>D(a.id)},{default:l(()=>[...e[15]||(e[15]=[c(" Открыть ",-1)])]),_:1},8,["onClick"]),t(m,{class:"actions-group__danger",type:"danger",size:"small",onClick:z=>U(a)},{default:l(()=>[...e[16]||(e[16]=[c(" Удалить ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),n(f)?(u(),k("div",fe,[t(S,{"current-page":o.page,"onUpdate:currentPage":e[6]||(e[6]=a=>o.page=a),"page-size":o.size,"onUpdate:pageSize":e[7]||(e[7]=a=>o.size=a),total:n(i).pagination.total,"page-sizes":[10,20,50],layout:"prev, pager, next",small:"",onCurrentChange:p,onSizeChange:p},null,8,["current-page","page-size","total"])])):(u(),k("div",ce,[t(S,{"current-page":o.page,"onUpdate:currentPage":e[4]||(e[4]=a=>o.page=a),"page-size":o.size,"onUpdate:pageSize":e[5]||(e[5]=a=>o.size=a),total:n(i).pagination.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onCurrentChange:p,onSizeChange:p},null,8,["current-page","page-size","total"])]))]),_:1})),[[T,n(i).loading]]),t(L,{modelValue:g.value,"onUpdate:modelValue":e[12]||(e[12]=a=>g.value=a),title:"Добавить участника",width:n(f)?"95%":"500px"},{footer:l(()=>[t(m,{onClick:e[11]||(e[11]=a=>g.value=!1)},{default:l(()=>[...e[22]||(e[22]=[c(" Отмена ",-1)])]),_:1}),t(m,{type:"primary",loading:n(i).loading,onClick:N},{default:l(()=>[...e[23]||(e[23]=[c(" Создать ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(P,{ref_key:"createFormRef",ref:V,model:d,rules:F,"label-position":"top"},{default:l(()=>[t(v,{label:"ФИО",prop:"full_name"},{default:l(()=>[t(w,{modelValue:d.full_name,"onUpdate:modelValue":e[8]||(e[8]=a=>d.full_name=a),placeholder:"Введите полное имя"},null,8,["modelValue"])]),_:1}),t(v,{label:"Дата рождения",prop:"birth_date"},{default:l(()=>[t(E,{modelValue:d.birth_date,"onUpdate:modelValue":e[9]||(e[9]=a=>d.birth_date=a),type:"date",placeholder:"Выберите дату",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(v,{label:"Внешний ID",prop:"external_id"},{default:l(()=>[t(w,{modelValue:d.external_id,"onUpdate:modelValue":e[10]||(e[10]=a=>d.external_id=a),placeholder:"Внешний идентификатор (необязательно)"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","width"])])]),_:1})}}},Ce=ae(ge,[["__scopeId","data-v-e6064260"]]);export{Ce as default};
