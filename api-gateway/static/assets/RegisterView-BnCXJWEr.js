import{l as T,m as k,n as U,p as q,c as d,f as o,w as n,r as u,d as L,o as m,a as l,y as j,x as I,z as f,u as c,A as K,e as E,F as x,B as N,C as O,E as W,D as H,G as J}from"./index-z4An-3zU.js";import{u as Q}from"./useFieldErrorAnimation-C04CDXDo.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"register-container"},Z={class:"auth-form-error__content"},$={key:1,class:"auth-form-error__list"},ee={class:"login-link"},re={__name:"RegisterView",setup(le){const F=L(),h=T(),y=k(null),r=U({fullName:"",email:"",password:"",confirmPassword:""}),b=["fullName","email","password","confirmPassword"],{getFormItemClass:g,handleValidationErrors:z,handleFieldValidate:P,triggerForFields:C,markExternalErrors:R}=Q(b),a=k([]),w=k(!1),A=()=>{w.value=!1,J(()=>{w.value=!0,setTimeout(()=>{w.value=!1},360)})},B={email:[{required:!0,message:"Введите email",trigger:"blur"},{type:"email",message:"Некорректный email",trigger:"blur"}],password:[{required:!0,message:"Введите пароль",trigger:"blur"},{min:8,message:"Пароль должен быть не менее 8 символов",trigger:"blur"}],confirmPassword:[{required:!0,validator:(p,e,s)=>{e===""?s(new Error("Подтвердите пароль")):e!==r.password?s(new Error("Пароли не совпадают")):s()},trigger:"blur"}]},S=(p,e)=>{P(p,e),e&&a.value.length&&(a.value=[])},V=async()=>{y.value&&(a.value=[],await y.value.validate(async(p,e)=>{if(!p){z(e);return}try{const s=r.fullName.trim()||null;await h.register(r.email,r.password,s),W.success({message:"Регистрация успешна! Ожидайте одобрения администратора.",duration:5e3}),F.push("/login?message=pending")}catch(s){const i=s.normalizedError||H(s,h.error||"Ошибка регистрации");a.value=i.messages;const _=Object.keys(i.fieldErrors),v=_.length?_:b;R(v),C(v),A()}}))};return q(()=>[r.fullName,r.email,r.password,r.confirmPassword],()=>{a.value.length&&(a.value=[])}),(p,e)=>{const s=u("el-input"),i=u("el-form-item"),_=u("el-button"),v=u("router-link"),D=u("el-form"),G=u("el-card");return m(),d("div",Y,[o(G,{class:"register-card",shadow:"never"},{default:n(()=>[e[8]||(e[8]=l("div",{class:"card-header"},[l("div",{class:"logo-icon"},[l("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[l("defs",null,[l("linearGradient",{id:"logoGradientReg",x1:"0%",y1:"0%",x2:"100%",y2:"100%"},[l("stop",{offset:"0%",style:{"stop-color":"#4F6AF0"}}),l("stop",{offset:"100%",style:{"stop-color":"#3D56D4"}})])]),l("rect",{width:"48",height:"48",rx:"12",fill:"url(#logoGradientReg)"}),l("path",{d:"M16 24L22 30L32 18",stroke:"white","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"})])]),l("h2",null,"Регистрация"),l("p",null,"Создайте аккаунт для работы с системой")],-1)),o(D,{ref_key:"formRef",ref:y,model:r,rules:B,"label-position":"top",onSubmit:j(V,["prevent"]),onValidate:S},{default:n(()=>[o(i,{label:"ФИО",prop:"fullName",class:f(c(g)("fullName"))},{default:n(()=>[o(s,{modelValue:r.fullName,"onUpdate:modelValue":e[0]||(e[0]=t=>r.fullName=t),placeholder:"Иванов Иван Иванович (необязательно)",size:"large",autocomplete:"name"},null,8,["modelValue"])]),_:1},8,["class"]),o(i,{label:"Email",prop:"email",class:f(c(g)("email"))},{default:n(()=>[o(s,{modelValue:r.email,"onUpdate:modelValue":e[1]||(e[1]=t=>r.email=t),type:"email",placeholder:"Введите email",size:"large",autocomplete:"email"},null,8,["modelValue"])]),_:1},8,["class"]),o(i,{label:"Пароль",prop:"password",class:f(c(g)("password"))},{default:n(()=>[o(s,{modelValue:r.password,"onUpdate:modelValue":e[2]||(e[2]=t=>r.password=t),type:"password",placeholder:"Введите пароль (минимум 8 символов, буквы и цифры)",size:"large","show-password":"",autocomplete:"new-password"},null,8,["modelValue"])]),_:1},8,["class"]),o(i,{label:"Подтверждение пароля",prop:"confirmPassword",class:f(c(g)("confirmPassword"))},{default:n(()=>[o(s,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=t=>r.confirmPassword=t),type:"password",placeholder:"Повторите пароль",size:"large","show-password":"",autocomplete:"new-password",onKeyup:K(V,["enter"])},null,8,["modelValue"])]),_:1},8,["class"]),o(i,null,{default:n(()=>[o(_,{type:"primary",size:"large",style:{width:"100%"},loading:c(h).loading,onClick:V},{default:n(()=>[...e[4]||(e[4]=[E(" Зарегистрироваться ",-1)])]),_:1},8,["loading"])]),_:1}),a.value.length?(m(),d("div",{key:0,class:f(["auth-form-error",{"auth-field-animate":w.value}]),role:"alert"},[e[5]||(e[5]=l("span",{class:"auth-form-error__icon","aria-hidden":"true"}," ! ",-1)),l("div",Z,[a.value.length===1?(m(),d(x,{key:0},[E(N(a.value[0]),1)],64)):(m(),d("ul",$,[(m(!0),d(x,null,O(a.value,(t,M)=>(m(),d("li",{key:M},N(t),1))),128))]))])],2)):I("",!0),l("div",ee,[e[7]||(e[7]=l("span",null,"Уже есть аккаунт?",-1)),o(v,{to:"/login"},{default:n(()=>[...e[6]||(e[6]=[E(" Войти ",-1)])]),_:1})])]),_:1},8,["model"])]),_:1})])}}},ne=X(re,[["__scopeId","data-v-f542b68b"]]);export{ne as default};
