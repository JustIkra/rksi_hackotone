import{l as U,m as E,n as D,p as I,c as d,d as s,w as l,r as u,e as K,o as m,y as j,x as G,a as i,z as w,u as _,A as L,f as b,F as P,B as z,C as O,E as W,D as H,G as J}from"./index-pQsDL8Mh.js";import{u as Q}from"./useFieldErrorAnimation-BWivhTj9.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"register-container"},Z={class:"auth-form-error__content"},$={key:1,class:"auth-form-error__list"},ee={class:"login-link"},re={__name:"RegisterView",setup(se){const C=K(),v=U(),h=E(null),r=D({email:"",password:"",confirmPassword:""}),k=["email","password","confirmPassword"],{getFormItemClass:y,handleValidationErrors:F,handleFieldValidate:x,triggerForFields:A,markExternalErrors:R}=Q(k),a=E([]),c=E(!1),S=()=>{c.value=!1,J(()=>{c.value=!0,setTimeout(()=>{c.value=!1},360)})},B={email:[{required:!0,message:"Введите email",trigger:"blur"},{type:"email",message:"Некорректный email",trigger:"blur"}],password:[{required:!0,message:"Введите пароль",trigger:"blur"},{min:8,message:"Пароль должен быть не менее 8 символов",trigger:"blur"}],confirmPassword:[{required:!0,validator:(p,e,o)=>{e===""?o(new Error("Подтвердите пароль")):e!==r.password?o(new Error("Пароли не совпадают")):o()},trigger:"blur"}]},N=(p,e)=>{x(p,e),e&&a.value.length&&(a.value=[])},V=async()=>{h.value&&(a.value=[],await h.value.validate(async(p,e)=>{if(!p){F(e);return}try{await v.register(r.email,r.password),W.success({message:"Регистрация успешна! Ожидайте одобрения администратора.",duration:5e3}),C.push("/login?message=pending")}catch(o){const t=o.normalizedError||H(o,v.error||"Ошибка регистрации");a.value=t.messages;const f=Object.keys(t.fieldErrors),g=f.length?f:k;R(g),A(g),S()}}))};return I(()=>[r.email,r.password,r.confirmPassword],()=>{a.value.length&&(a.value=[])}),(p,e)=>{const o=u("el-input"),t=u("el-form-item"),f=u("el-button"),g=u("router-link"),T=u("el-form"),q=u("el-card");return m(),d("div",Y,[s(q,{class:"register-card"},{header:l(()=>[...e[3]||(e[3]=[i("div",{class:"card-header"},[i("h2",null,"Регистрация"),i("p",null,"Создайте аккаунт для работы с системой")],-1)])]),default:l(()=>[s(T,{ref_key:"formRef",ref:h,model:r,rules:B,"label-position":"top",onSubmit:j(V,["prevent"]),onValidate:N},{default:l(()=>[s(t,{label:"Email",prop:"email",class:w(_(y)("email"))},{default:l(()=>[s(o,{modelValue:r.email,"onUpdate:modelValue":e[0]||(e[0]=n=>r.email=n),type:"email",placeholder:"Введите email",size:"large",autocomplete:"email"},null,8,["modelValue"])]),_:1},8,["class"]),s(t,{label:"Пароль",prop:"password",class:w(_(y)("password"))},{default:l(()=>[s(o,{modelValue:r.password,"onUpdate:modelValue":e[1]||(e[1]=n=>r.password=n),type:"password",placeholder:"Введите пароль (минимум 8 символов, буквы и цифры)",size:"large","show-password":"",autocomplete:"new-password"},null,8,["modelValue"])]),_:1},8,["class"]),s(t,{label:"Подтверждение пароля",prop:"confirmPassword",class:w(_(y)("confirmPassword"))},{default:l(()=>[s(o,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=n=>r.confirmPassword=n),type:"password",placeholder:"Повторите пароль",size:"large","show-password":"",autocomplete:"new-password",onKeyup:L(V,["enter"])},null,8,["modelValue"])]),_:1},8,["class"]),s(t,null,{default:l(()=>[s(f,{type:"primary",size:"large",style:{width:"100%"},loading:_(v).loading,onClick:V},{default:l(()=>[...e[4]||(e[4]=[b(" Зарегистрироваться ",-1)])]),_:1},8,["loading"])]),_:1}),a.value.length?(m(),d("div",{key:0,class:w(["auth-form-error",{"auth-field-animate":c.value}]),role:"alert"},[e[5]||(e[5]=i("span",{class:"auth-form-error__icon","aria-hidden":"true"}," ! ",-1)),i("div",Z,[a.value.length===1?(m(),d(P,{key:0},[b(z(a.value[0]),1)],64)):(m(),d("ul",$,[(m(!0),d(P,null,O(a.value,(n,M)=>(m(),d("li",{key:M},z(n),1))),128))]))])],2)):G("",!0),i("div",ee,[e[7]||(e[7]=i("span",null,"Уже есть аккаунт?",-1)),s(g,{to:"/login"},{default:l(()=>[...e[6]||(e[6]=[b(" Войти ",-1)])]),_:1})])]),_:1},8,["model"])]),_:1})])}}},ne=X(re,[["__scopeId","data-v-8bb3014f"]]);export{ne as default};
