import{l as M,m as E,n as D,p as I,c as d,d as a,w as o,r as u,e as K,o as m,y as j,x as G,a as i,z as f,u as c,A as L,f as k,F as b,B as z,C as O,E as W,D as H,G as J}from"./index-CllNYImy.js";import{u as Q}from"./useFieldErrorAnimation-k8w5GuGD.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"register-container"},Z={class:"auth-form-error__content"},$={key:1,class:"auth-form-error__list"},ee={class:"login-link"},re={__name:"RegisterView",setup(le){const P=K(),h=M(),V=E(null),r=D({fullName:"",email:"",password:"",confirmPassword:""}),N=["fullName","email","password","confirmPassword"],{getFormItemClass:g,handleValidationErrors:C,handleFieldValidate:F,triggerForFields:x,markExternalErrors:A}=Q(N),s=E([]),w=E(!1),R=()=>{w.value=!1,J(()=>{w.value=!0,setTimeout(()=>{w.value=!1},360)})},S={email:[{required:!0,message:"Введите email",trigger:"blur"},{type:"email",message:"Некорректный email",trigger:"blur"}],password:[{required:!0,message:"Введите пароль",trigger:"blur"},{min:8,message:"Пароль должен быть не менее 8 символов",trigger:"blur"}],confirmPassword:[{required:!0,validator:(p,e,l)=>{e===""?l(new Error("Подтвердите пароль")):e!==r.password?l(new Error("Пароли не совпадают")):l()},trigger:"blur"}]},B=(p,e)=>{F(p,e),e&&s.value.length&&(s.value=[])},y=async()=>{V.value&&(s.value=[],await V.value.validate(async(p,e)=>{if(!p){C(e);return}try{const l=r.fullName.trim()||null;await h.register(r.email,r.password,l),W.success({message:"Регистрация успешна! Ожидайте одобрения администратора.",duration:5e3}),P.push("/login?message=pending")}catch(l){const n=l.normalizedError||H(l,h.error||"Ошибка регистрации");s.value=n.messages;const _=Object.keys(n.fieldErrors),v=_.length?_:N;A(v),x(v),R()}}))};return I(()=>[r.fullName,r.email,r.password,r.confirmPassword],()=>{s.value.length&&(s.value=[])}),(p,e)=>{const l=u("el-input"),n=u("el-form-item"),_=u("el-button"),v=u("router-link"),T=u("el-form"),U=u("el-card");return m(),d("div",Y,[a(U,{class:"register-card"},{header:o(()=>[...e[4]||(e[4]=[i("div",{class:"card-header"},[i("h2",null,"Регистрация"),i("p",null,"Создайте аккаунт для работы с системой")],-1)])]),default:o(()=>[a(T,{ref_key:"formRef",ref:V,model:r,rules:S,"label-position":"top",onSubmit:j(y,["prevent"]),onValidate:B},{default:o(()=>[a(n,{label:"ФИО",prop:"fullName",class:f(c(g)("fullName"))},{default:o(()=>[a(l,{modelValue:r.fullName,"onUpdate:modelValue":e[0]||(e[0]=t=>r.fullName=t),placeholder:"Иванов Иван Иванович (необязательно)",size:"large",autocomplete:"name"},null,8,["modelValue"])]),_:1},8,["class"]),a(n,{label:"Email",prop:"email",class:f(c(g)("email"))},{default:o(()=>[a(l,{modelValue:r.email,"onUpdate:modelValue":e[1]||(e[1]=t=>r.email=t),type:"email",placeholder:"Введите email",size:"large",autocomplete:"email"},null,8,["modelValue"])]),_:1},8,["class"]),a(n,{label:"Пароль",prop:"password",class:f(c(g)("password"))},{default:o(()=>[a(l,{modelValue:r.password,"onUpdate:modelValue":e[2]||(e[2]=t=>r.password=t),type:"password",placeholder:"Введите пароль (минимум 8 символов, буквы и цифры)",size:"large","show-password":"",autocomplete:"new-password"},null,8,["modelValue"])]),_:1},8,["class"]),a(n,{label:"Подтверждение пароля",prop:"confirmPassword",class:f(c(g)("confirmPassword"))},{default:o(()=>[a(l,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=t=>r.confirmPassword=t),type:"password",placeholder:"Повторите пароль",size:"large","show-password":"",autocomplete:"new-password",onKeyup:L(y,["enter"])},null,8,["modelValue"])]),_:1},8,["class"]),a(n,null,{default:o(()=>[a(_,{type:"primary",size:"large",style:{width:"100%"},loading:c(h).loading,onClick:y},{default:o(()=>[...e[5]||(e[5]=[k(" Зарегистрироваться ",-1)])]),_:1},8,["loading"])]),_:1}),s.value.length?(m(),d("div",{key:0,class:f(["auth-form-error",{"auth-field-animate":w.value}]),role:"alert"},[e[6]||(e[6]=i("span",{class:"auth-form-error__icon","aria-hidden":"true"}," ! ",-1)),i("div",Z,[s.value.length===1?(m(),d(b,{key:0},[k(z(s.value[0]),1)],64)):(m(),d("ul",$,[(m(!0),d(b,null,O(s.value,(t,q)=>(m(),d("li",{key:q},z(t),1))),128))]))])],2)):G("",!0),i("div",ee,[e[8]||(e[8]=i("span",null,"Уже есть аккаунт?",-1)),a(v,{to:"/login"},{default:o(()=>[...e[7]||(e[7]=[k(" Войти ",-1)])]),_:1})])]),_:1},8,["model"])]),_:1})])}}},ne=X(re,[["__scopeId","data-v-96cfd406"]]);export{ne as default};
